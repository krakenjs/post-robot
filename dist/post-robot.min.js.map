{"version":3,"sources":["webpack://postRobot/webpack/universalModuleDefinition","webpack://postRobot/webpack/bootstrap","webpack://postRobot/./node_modules/@krakenjs/cross-domain-utils/dist/cross-domain-utils.js","webpack://postRobot/./node_modules/@krakenjs/zalgo-promise/index.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-safe-weakmap/dist/cross-domain-safe-weakmap.js","webpack://postRobot/./node_modules/@krakenjs/zalgo-promise/dist/zalgo-promise.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-utils/dist/esm/utils.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-utils/dist/esm/constants.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-safe-weakmap/dist/esm/util.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-safe-weakmap/dist/esm/weakmap.js","webpack://postRobot/./node_modules/@krakenjs/belter/dist/esm/util.js","webpack://postRobot/./node_modules/@krakenjs/cross-domain-safe-weakmap/dist/esm/native.js","webpack://postRobot/./src/global.ts","webpack://postRobot/./src/lib/hello.ts","webpack://postRobot/./src/conf/constants.ts","webpack://postRobot/./src/lib/windows.ts","webpack://postRobot/./node_modules/@krakenjs/belter/dist/esm/dom.js","webpack://postRobot/../universal-serialize/dist/esm/serialize.js","webpack://postRobot/../universal-serialize/dist/esm/common.js","webpack://postRobot/../universal-serialize/dist/esm/constants.js","webpack://postRobot/./node_modules/@krakenjs/belter/dist/esm/constants.js","webpack://postRobot/../universal-serialize/dist/esm/deserialize.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/function.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/error.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/promise.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/regex.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/date.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/array.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/object.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/string.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/number.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/boolean.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/null.js","webpack://postRobot/../universal-serialize/dist/esm/serializers/undefined.js","webpack://postRobot/./src/serialize/window.ts","webpack://postRobot/./src/bridge/common.ts","webpack://postRobot/./src/serialize/function.ts","webpack://postRobot/./src/serialize/serialize.ts","webpack://postRobot/./src/serialize/promise.ts","webpack://postRobot/./src/drivers/send/strategies.ts","webpack://postRobot/./src/drivers/send/index.ts","webpack://postRobot/./src/drivers/listeners.ts","webpack://postRobot/./src/drivers/receive/types.ts","webpack://postRobot/./src/drivers/receive/index.ts","webpack://postRobot/./src/public/on.ts","webpack://postRobot/./src/public/send.ts","webpack://postRobot/./src/conf/config.ts","webpack://postRobot/./src/setup.ts","webpack://postRobot/./src/types.ts","webpack://postRobot/./src/clean.ts","webpack://postRobot/./src/index.ts"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","hasOwnProperty","p","s","default","__webpack_exports__","isRegex","item","toString","getActualProtocol","getProtocol","isFileProtocol","isAboutProtocol","isMockProtocol","getParent","getOpener","canReadFromWindow","getActualDomain","getDomain","isBlankDomain","isActuallySameDomain","isSameDomain","assertSameDomain","getParents","isAncestorParent","getFrames","getAllChildFrames","getTop","getNextOpener","getUltimateTop","getAllFramesInWindow","getAllWindows","isTop","isFrameWindowClosed","isWindowClosed","linkFrameWindow","getUserAgent","getFrameByName","findChildFrameByName","findFrameByName","isParent","isOpener","getAncestor","getAncestors","isAncestor","isPopup","isIframe","isFullpage","getDistanceFromTop","getNthParent","getNthParentFromTop","isSameTopWindow","matchDomain","stringifyDomainPattern","getDomainFromUrl","onCloseWindow","isWindow","isBrowser","isCurrentDomain","isMockDomain","normalizeMockUrl","getFrameForWindow","closeWindow","PROTOCOL","WILDCARD","WINDOW_TYPE","MOCK","FILE","ABOUT","IFRAME","POPUP","IE_WIN_ACCESS_ERROR","win","window","location","protocol","mockDomain","split","parent","err","opener","Error","host","domain","startsWith","href","desc","getOwnPropertyDescriptor","result","push","child","childParent","includes","frames","len","length","frame","_i","_frame","_i3","_getFrames2","_i5","_getAllChildFrames2","top","_i7","_getAllChildFrames4","concat","contentWindow","parentNode","doc","ownerDocument","documentElement","contains","iframeWindows","iframeFrames","allowMock","closed","message","mockclosed","iframeIndex","collection","splice","navigator","mockUserAgent","userAgent","winFrames","_i9","childFrame","_i11","_getFrames4","namedFrame","frameParent","_i13","_getFrames6","results","ancestor","actualParent","_i15","_getFrames8","Boolean","anyMatch","collection1","collection2","_i17","item1","_i19","distance","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","pattern","origin","Array","isArray","match","JSON","stringify","some","subpattern","join","url","exec","slice","callback","delay","maxtime","timeout","check","clearTimeout","setTimeout","cancel","obj","Window","__cross_domain_utils_window_check__","frameElement","_i21","_document$querySelect2","document","querySelectorAll","parentElement","removeChild","close","require","e","a","u","f","indexOf","h","w","weakmap","keys","values","Math","random","WeakMap","freeze","set","prototype","_cleanupClosedWindows","delete","isSafeToReadWrite","writable","has","getOrSet","Promise","constructor","then","resolve","resolved","rejected","errorHandled","error","handlers","dispatching","stack","reject","dispatch","asyncReject","onSuccess","onError","promise","v","catch","finally","try","toPromise","TypeError","lazy","all","hash","map","onPossiblyUnhandledException","apply","isPromise","flush","safeIndexOf","objectIDs","CrossDomainSafeWeakMap","testWeakMap","testKey","hasNativeWeakMap","_proto","entry","index","undefined","getEmptyObject","getFunctionName","fn","__name__","displayName","setFunctionName","uniqueID","chars","replace","charAt","floor","str","btoa","encodeURIComponent","_m","p1","String","fromCharCode","parseInt","Buffer","from","base64encode","Date","toISOString","toLowerCase","serializeArgs","args","_subkey","val","uid","getObjectID","element","passed","Element","nodeType","style","_","isElement","memoizeGlobalIndex","memoizeGlobalIndexValidFrom","memoize","method","options","simpleCache","thisCache","_options$thisNamespac","thisNamespace","cacheTime","time","memoizeIndex","memoizedFunction","_len","arguments","_key","cache","cacheKey","_unused","cacheResult","now","reset","memoizePromise","memoizedPromiseFunction","_arguments","_this","_len2","_key2","stringifyError","level","newErr","clear","getGlobal","globalKey","__POST_ROBOT__","getObj","globalStore","defStore","store","storeKey","defVal","del","WildCard","getWildcard","global","WINDOW_WILDCARD","windowStore","winStore","getStore","getInstanceID","resolveHelloPromise","helloPromises","existingPromise","newPromise","ZalgoPromise","sayHello","send","instanceID","data","getWindowInstanceID","markWindowKnown","getBody","body","isDocumentReady","readyState","isDocumentInteractive","interval","setInterval","clearInterval","_SERIALIZER","currentScript","getCurrentScript","getStackTrace","stackDetails","scriptLocation","_i22","_Array$prototype$slic2","getElementsByTagName","reverse","script","src","inferCurrentScript","currentUID","isSerializedType","__type__","determineType","serializeType","type","__val__","getAttribute","ATTRIBUTES","hashedString","total","charCodeAt","abs","strHashStr","dataset","setAttribute","_DESERIALIZER","SERIALIZER","_ref","code","source","toJSON","defaultSerializers","DESERIALIZER","_ref2","RegExp","defaultDeserializers","cleanupProxyWindows","idToProxyWindow","id","shouldClean","getSerializedWindow","winPromise","windowNamePromise","windowTypePromise","noop","getName","getType","focus","isClosed","setLocation","opts","_ref3","target","_ref3$method","form","createElement","display","_i24","_Object$keys4","_body$key","input","appendChild","submit","submitForm","setName","sameDomain","ProxyWindow","serializedWindow","isProxyWindow","actualWindow","actualWindowPromise","getID","setWindow","isPopupPromise","getNamePromise","reopenPromise","open","focusPromise","getWindow","awaitWindow","matchWindow","proxyInstanceID","knownWindowInstanceID","unwrap","serialize","toProxyWindow","deserialize","addMethod","methodStore","proxyWindowMethods","lookupMethod","serializeFunction","destination","on","meth","methodSource","arg","__id__","serializeMessage","serializers","_serializers$type","serializer","serializePromise","deserializeMessage","deserializers","parse","_deserializers$type","deserializer","serializedPromise","deserializePromise","serializedFunction","getDeserializedFunction","crossDomainFunctionWrapper","fireAndForget","res","__origin__","__source__","deserializeFunction","SEND_MESSAGE_STRATEGIES","sendMessage","domainBuffer","buffer","serializedMessage","strategies","errors","strategyName","getResponseListener","deleteResponseListener","isResponseListenerErrored","getRequestListener","requestListeners","winQualifier","nameListeners","domainListeners","regex","listener","handleRequest","logName","sendResponse","ack","pathname","handler","handleError","handleAck","handleResponse","receiveMessage","event","receivedMessages","messages","parsedMessage","parseMessages","deserializeMessages","requestListener","addRequestListener","winCandidate","requestListenerPromise","actualWin","listenersCollection","existingListener","strDomain","winNameDomainRegexListeners","winNameDomainRegexListener","winNameListeners","winNameDomainListeners","errorHandler","once","postMessage","winOrProxyWin","domainMatcher","responseTimeout","childTimeout","validateOptions","getHelloPromise","awaitWindowHello","targetDomain","actualDomain","normalizedDomain","normalizeDomain","responseListener","addResponseListener","reqPromises","markResponseListenerErrored","totalAckTimeout","isWindowKnown","totalResTimeout","ackTimeout","resTimeout","cancelled","max","loop","internalSerializeMessage","internalDeserializeMessage","createProxyWindow","setup","initialized","addEventListener","sourceElement","originalEvent","messageListener","removeEventListener","listenForMessages","initHello","destroy","responseListeners","cancelResponseListeners","TYPES","cleanUpWindow"],"mappings":"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","file":"post-robot.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"postRobot\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postRobot\"] = factory();\n\telse\n\t\troot[\"postRobot\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","!function(root, factory) {\n    \"object\" == typeof exports && \"object\" == typeof module ? module.exports = factory() : \"function\" == typeof define && define.amd ? define(\"crossDomainUtils\", [], factory) : \"object\" == typeof exports ? exports.crossDomainUtils = factory() : root.crossDomainUtils = factory();\n}(\"undefined\" != typeof self ? self : this, (function() {\n    return function(modules) {\n        var installedModules = {};\n        function __webpack_require__(moduleId) {\n            if (installedModules[moduleId]) return installedModules[moduleId].exports;\n            var module = installedModules[moduleId] = {\n                i: moduleId,\n                l: !1,\n                exports: {}\n            };\n            modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n            module.l = !0;\n            return module.exports;\n        }\n        __webpack_require__.m = modules;\n        __webpack_require__.c = installedModules;\n        __webpack_require__.d = function(exports, name, getter) {\n            __webpack_require__.o(exports, name) || Object.defineProperty(exports, name, {\n                enumerable: !0,\n                get: getter\n            });\n        };\n        __webpack_require__.r = function(exports) {\n            \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(exports, Symbol.toStringTag, {\n                value: \"Module\"\n            });\n            Object.defineProperty(exports, \"__esModule\", {\n                value: !0\n            });\n        };\n        __webpack_require__.t = function(value, mode) {\n            1 & mode && (value = __webpack_require__(value));\n            if (8 & mode) return value;\n            if (4 & mode && \"object\" == typeof value && value && value.__esModule) return value;\n            var ns = Object.create(null);\n            __webpack_require__.r(ns);\n            Object.defineProperty(ns, \"default\", {\n                enumerable: !0,\n                value: value\n            });\n            if (2 & mode && \"string\" != typeof value) for (var key in value) __webpack_require__.d(ns, key, function(key) {\n                return value[key];\n            }.bind(null, key));\n            return ns;\n        };\n        __webpack_require__.n = function(module) {\n            var getter = module && module.__esModule ? function() {\n                return module.default;\n            } : function() {\n                return module;\n            };\n            __webpack_require__.d(getter, \"a\", getter);\n            return getter;\n        };\n        __webpack_require__.o = function(object, property) {\n            return {}.hasOwnProperty.call(object, property);\n        };\n        __webpack_require__.p = \"\";\n        return __webpack_require__(__webpack_require__.s = 1);\n    }([ , function(module, __webpack_exports__, __webpack_require__) {\n        \"use strict\";\n        __webpack_require__.r(__webpack_exports__);\n        __webpack_require__.d(__webpack_exports__, \"getActualProtocol\", (function() {\n            return getActualProtocol;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getProtocol\", (function() {\n            return getProtocol;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isFileProtocol\", (function() {\n            return isFileProtocol;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isAboutProtocol\", (function() {\n            return isAboutProtocol;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isMockProtocol\", (function() {\n            return isMockProtocol;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getParent\", (function() {\n            return getParent;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getOpener\", (function() {\n            return getOpener;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"canReadFromWindow\", (function() {\n            return canReadFromWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getActualDomain\", (function() {\n            return getActualDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getDomain\", (function() {\n            return getDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isBlankDomain\", (function() {\n            return isBlankDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isActuallySameDomain\", (function() {\n            return isActuallySameDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isSameDomain\", (function() {\n            return isSameDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"assertSameDomain\", (function() {\n            return assertSameDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getParents\", (function() {\n            return getParents;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isAncestorParent\", (function() {\n            return isAncestorParent;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getFrames\", (function() {\n            return getFrames;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getAllChildFrames\", (function() {\n            return getAllChildFrames;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getTop\", (function() {\n            return getTop;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getNextOpener\", (function() {\n            return getNextOpener;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getUltimateTop\", (function() {\n            return getUltimateTop;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getAllFramesInWindow\", (function() {\n            return getAllFramesInWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getAllWindows\", (function() {\n            return getAllWindows;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isTop\", (function() {\n            return isTop;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isFrameWindowClosed\", (function() {\n            return isFrameWindowClosed;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isWindowClosed\", (function() {\n            return isWindowClosed;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"linkFrameWindow\", (function() {\n            return linkFrameWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getUserAgent\", (function() {\n            return getUserAgent;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getFrameByName\", (function() {\n            return getFrameByName;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"findChildFrameByName\", (function() {\n            return findChildFrameByName;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"findFrameByName\", (function() {\n            return findFrameByName;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isParent\", (function() {\n            return isParent;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isOpener\", (function() {\n            return isOpener;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getAncestor\", (function() {\n            return getAncestor;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getAncestors\", (function() {\n            return getAncestors;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isAncestor\", (function() {\n            return isAncestor;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isPopup\", (function() {\n            return isPopup;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isIframe\", (function() {\n            return isIframe;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isFullpage\", (function() {\n            return isFullpage;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getDistanceFromTop\", (function() {\n            return getDistanceFromTop;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getNthParent\", (function() {\n            return getNthParent;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getNthParentFromTop\", (function() {\n            return getNthParentFromTop;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isSameTopWindow\", (function() {\n            return isSameTopWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"matchDomain\", (function() {\n            return matchDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"stringifyDomainPattern\", (function() {\n            return stringifyDomainPattern;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getDomainFromUrl\", (function() {\n            return getDomainFromUrl;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"onCloseWindow\", (function() {\n            return onCloseWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isWindow\", (function() {\n            return isWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isBrowser\", (function() {\n            return isBrowser;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isCurrentDomain\", (function() {\n            return isCurrentDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"isMockDomain\", (function() {\n            return isMockDomain;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"normalizeMockUrl\", (function() {\n            return normalizeMockUrl;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"getFrameForWindow\", (function() {\n            return getFrameForWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"closeWindow\", (function() {\n            return closeWindow;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"PROTOCOL\", (function() {\n            return PROTOCOL;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"WILDCARD\", (function() {\n            return WILDCARD;\n        }));\n        __webpack_require__.d(__webpack_exports__, \"WINDOW_TYPE\", (function() {\n            return WINDOW_TYPE;\n        }));\n        function isRegex(item) {\n            return \"[object RegExp]\" === {}.toString.call(item);\n        }\n        var PROTOCOL = {\n            MOCK: \"mock:\",\n            FILE: \"file:\",\n            ABOUT: \"about:\"\n        };\n        var WILDCARD = \"*\";\n        var WINDOW_TYPE = {\n            IFRAME: \"iframe\",\n            POPUP: \"popup\"\n        };\n        var IE_WIN_ACCESS_ERROR = \"Call was rejected by callee.\\r\\n\";\n        function getActualProtocol(win) {\n            void 0 === win && (win = window);\n            return win.location.protocol;\n        }\n        function getProtocol(win) {\n            void 0 === win && (win = window);\n            if (win.mockDomain) {\n                var protocol = win.mockDomain.split(\"//\")[0];\n                if (protocol) return protocol;\n            }\n            return getActualProtocol(win);\n        }\n        function isFileProtocol(win) {\n            void 0 === win && (win = window);\n            return getProtocol(win) === PROTOCOL.FILE;\n        }\n        function isAboutProtocol(win) {\n            void 0 === win && (win = window);\n            return getProtocol(win) === PROTOCOL.ABOUT;\n        }\n        function isMockProtocol(win) {\n            void 0 === win && (win = window);\n            return getProtocol(win) === PROTOCOL.MOCK;\n        }\n        function getParent(win) {\n            void 0 === win && (win = window);\n            if (win) try {\n                if (win.parent && win.parent !== win) return win.parent;\n            } catch (err) {}\n        }\n        function getOpener(win) {\n            void 0 === win && (win = window);\n            if (win && !getParent(win)) try {\n                return win.opener;\n            } catch (err) {}\n        }\n        function canReadFromWindow(win) {\n            try {\n                return !0;\n            } catch (err) {}\n            return !1;\n        }\n        function getActualDomain(win) {\n            void 0 === win && (win = window);\n            var location = win.location;\n            if (!location) throw new Error(\"Can not read window location\");\n            var protocol = getActualProtocol(win);\n            if (!protocol) throw new Error(\"Can not read window protocol\");\n            if (protocol === PROTOCOL.FILE) return PROTOCOL.FILE + \"//\";\n            if (protocol === PROTOCOL.ABOUT) {\n                var parent = getParent(win);\n                return parent && canReadFromWindow() ? getActualDomain(parent) : PROTOCOL.ABOUT + \"//\";\n            }\n            var host = location.host;\n            if (!host) throw new Error(\"Can not read window host\");\n            return protocol + \"//\" + host;\n        }\n        function getDomain(win) {\n            void 0 === win && (win = window);\n            var domain = getActualDomain(win);\n            return domain && win.mockDomain && win.mockDomain.startsWith(PROTOCOL.MOCK) ? win.mockDomain : domain;\n        }\n        function isBlankDomain(win) {\n            try {\n                if (!win.location.href) return !0;\n                if (\"about:blank\" === win.location.href) return !0;\n            } catch (err) {}\n            return !1;\n        }\n        function isActuallySameDomain(win) {\n            try {\n                if (win === window) return !0;\n            } catch (err) {}\n            try {\n                var desc = Object.getOwnPropertyDescriptor(win, \"location\");\n                if (desc && !1 === desc.enumerable) return !1;\n            } catch (err) {}\n            try {\n                if (isAboutProtocol(win) && canReadFromWindow()) return !0;\n            } catch (err) {}\n            try {\n                if (isMockProtocol(win) && canReadFromWindow()) return !0;\n            } catch (err) {}\n            try {\n                if (getActualDomain(win) === getActualDomain(window)) return !0;\n            } catch (err) {}\n            return !1;\n        }\n        function isSameDomain(win) {\n            if (!isActuallySameDomain(win)) return !1;\n            try {\n                if (win === window) return !0;\n                if (isAboutProtocol(win) && canReadFromWindow()) return !0;\n                if (getDomain(window) === getDomain(win)) return !0;\n            } catch (err) {}\n            return !1;\n        }\n        function assertSameDomain(win) {\n            if (!isSameDomain(win)) throw new Error(\"Expected window to be same domain\");\n            return win;\n        }\n        function getParents(win) {\n            var result = [];\n            try {\n                for (;win.parent !== win; ) {\n                    result.push(win.parent);\n                    win = win.parent;\n                }\n            } catch (err) {}\n            return result;\n        }\n        function isAncestorParent(parent, child) {\n            if (!parent || !child) return !1;\n            var childParent = getParent(child);\n            return childParent ? childParent === parent : !!getParents(child).includes(parent);\n        }\n        function getFrames(win) {\n            var result = [];\n            var frames;\n            try {\n                frames = win.frames;\n            } catch (err) {\n                frames = win;\n            }\n            var len;\n            try {\n                len = frames.length;\n            } catch (err) {}\n            if (0 === len) return result;\n            if (len) {\n                for (var i = 0; i < len; i++) {\n                    var frame = void 0;\n                    try {\n                        frame = frames[i];\n                    } catch (err) {\n                        continue;\n                    }\n                    result.push(frame);\n                }\n                return result;\n            }\n            for (var _i = 0; _i < 100; _i++) {\n                var _frame = void 0;\n                try {\n                    _frame = frames[_i];\n                } catch (err) {\n                    return result;\n                }\n                if (!_frame) return result;\n                result.push(_frame);\n            }\n            return result;\n        }\n        function getAllChildFrames(win) {\n            var result = [];\n            for (var _i3 = 0, _getFrames2 = getFrames(win); _i3 < _getFrames2.length; _i3++) {\n                var frame = _getFrames2[_i3];\n                result.push(frame);\n                for (var _i5 = 0, _getAllChildFrames2 = getAllChildFrames(frame); _i5 < _getAllChildFrames2.length; _i5++) result.push(_getAllChildFrames2[_i5]);\n            }\n            return result;\n        }\n        function getTop(win) {\n            void 0 === win && (win = window);\n            try {\n                if (win.top) return win.top;\n            } catch (err) {}\n            if (getParent(win) === win) return win;\n            try {\n                if (isAncestorParent(window, win) && window.top) return window.top;\n            } catch (err) {}\n            try {\n                if (isAncestorParent(win, window) && window.top) return window.top;\n            } catch (err) {}\n            for (var _i7 = 0, _getAllChildFrames4 = getAllChildFrames(win); _i7 < _getAllChildFrames4.length; _i7++) {\n                var frame = _getAllChildFrames4[_i7];\n                try {\n                    if (frame.top) return frame.top;\n                } catch (err) {}\n                if (getParent(frame) === frame) return frame;\n            }\n        }\n        function getNextOpener(win) {\n            void 0 === win && (win = window);\n            return getOpener(getTop(win) || win);\n        }\n        function getUltimateTop(win) {\n            void 0 === win && (win = window);\n            var opener = getNextOpener(win);\n            return opener ? getUltimateTop(opener) : top;\n        }\n        function getAllFramesInWindow(win) {\n            var top = getTop(win);\n            if (!top) throw new Error(\"Can not determine top window\");\n            var result = [].concat(getAllChildFrames(top), [ top ]);\n            result.includes(win) || (result = [].concat(result, [ win ], getAllChildFrames(win)));\n            return result;\n        }\n        function getAllWindows(win) {\n            void 0 === win && (win = window);\n            var frames = getAllFramesInWindow(win);\n            var opener = getNextOpener(win);\n            return opener ? [].concat(getAllWindows(opener), frames) : frames;\n        }\n        function isTop(win) {\n            return win === getTop(win);\n        }\n        function isFrameWindowClosed(frame) {\n            if (!frame.contentWindow) return !0;\n            if (!frame.parentNode) return !0;\n            var doc = frame.ownerDocument;\n            if (doc && doc.documentElement && !doc.documentElement.contains(frame)) {\n                var parent = frame;\n                for (;parent.parentNode && parent.parentNode !== parent; ) parent = parent.parentNode;\n                if (!parent.host || !doc.documentElement.contains(parent.host)) return !0;\n            }\n            return !1;\n        }\n        var iframeWindows = [];\n        var iframeFrames = [];\n        function isWindowClosed(win, allowMock) {\n            void 0 === allowMock && (allowMock = !0);\n            try {\n                if (win === window) return !1;\n            } catch (err) {\n                return !0;\n            }\n            try {\n                if (!win) return !0;\n            } catch (err) {\n                return !0;\n            }\n            try {\n                if (win.closed) return !0;\n            } catch (err) {\n                return !err || err.message !== IE_WIN_ACCESS_ERROR;\n            }\n            if (allowMock && isSameDomain(win)) try {\n                if (win.mockclosed) return !0;\n            } catch (err) {}\n            try {\n                if (!win.parent || !win.top) return !0;\n            } catch (err) {}\n            var iframeIndex = function(collection, item) {\n                for (var i = 0; i < collection.length; i++) try {\n                    if (collection[i] === item) return i;\n                } catch (err) {}\n                return -1;\n            }(iframeWindows, win);\n            if (-1 !== iframeIndex) {\n                var frame = iframeFrames[iframeIndex];\n                if (frame && isFrameWindowClosed(frame)) return !0;\n            }\n            return !1;\n        }\n        function linkFrameWindow(frame) {\n            !function() {\n                for (var i = 0; i < iframeWindows.length; i++) {\n                    var closed = !1;\n                    try {\n                        closed = iframeWindows[i].closed;\n                    } catch (err) {}\n                    if (closed) {\n                        iframeFrames.splice(i, 1);\n                        iframeWindows.splice(i, 1);\n                    }\n                }\n            }();\n            if (frame && frame.contentWindow) try {\n                iframeWindows.push(frame.contentWindow);\n                iframeFrames.push(frame);\n            } catch (err) {}\n        }\n        function getUserAgent(win) {\n            return (win = win || window).navigator.mockUserAgent || win.navigator.userAgent;\n        }\n        function getFrameByName(win, name) {\n            var winFrames = getFrames(win);\n            for (var _i9 = 0; _i9 < winFrames.length; _i9++) {\n                var childFrame = winFrames[_i9];\n                try {\n                    if (isSameDomain(childFrame) && childFrame.name === name && winFrames.includes(childFrame)) return childFrame;\n                } catch (err) {}\n            }\n            try {\n                if (winFrames.includes(win.frames[name])) return win.frames[name];\n            } catch (err) {}\n            try {\n                if (winFrames.includes(win[name])) return win[name];\n            } catch (err) {}\n        }\n        function findChildFrameByName(win, name) {\n            var frame = getFrameByName(win, name);\n            if (frame) return frame;\n            for (var _i11 = 0, _getFrames4 = getFrames(win); _i11 < _getFrames4.length; _i11++) {\n                var namedFrame = findChildFrameByName(_getFrames4[_i11], name);\n                if (namedFrame) return namedFrame;\n            }\n        }\n        function findFrameByName(win, name) {\n            return getFrameByName(win, name) || findChildFrameByName(getTop(win) || win, name);\n        }\n        function isParent(win, frame) {\n            var frameParent = getParent(frame);\n            if (frameParent) return frameParent === win;\n            for (var _i13 = 0, _getFrames6 = getFrames(win); _i13 < _getFrames6.length; _i13++) if (_getFrames6[_i13] === frame) return !0;\n            return !1;\n        }\n        function isOpener(parent, child) {\n            return parent === getOpener(child);\n        }\n        function getAncestor(win) {\n            void 0 === win && (win = window);\n            return getOpener(win = win || window) || getParent(win) || void 0;\n        }\n        function getAncestors(win) {\n            var results = [];\n            var ancestor = win;\n            for (;ancestor; ) (ancestor = getAncestor(ancestor)) && results.push(ancestor);\n            return results;\n        }\n        function isAncestor(parent, child) {\n            var actualParent = getAncestor(child);\n            if (actualParent) return actualParent === parent;\n            if (child === parent) return !1;\n            if (getTop(child) === child) return !1;\n            for (var _i15 = 0, _getFrames8 = getFrames(parent); _i15 < _getFrames8.length; _i15++) if (_getFrames8[_i15] === child) return !0;\n            return !1;\n        }\n        function isPopup(win) {\n            void 0 === win && (win = window);\n            return Boolean(getOpener(win));\n        }\n        function isIframe(win) {\n            void 0 === win && (win = window);\n            return Boolean(getParent(win));\n        }\n        function isFullpage(win) {\n            void 0 === win && (win = window);\n            return Boolean(!isIframe(win) && !isPopup(win));\n        }\n        function anyMatch(collection1, collection2) {\n            for (var _i17 = 0; _i17 < collection1.length; _i17++) {\n                var item1 = collection1[_i17];\n                for (var _i19 = 0; _i19 < collection2.length; _i19++) if (item1 === collection2[_i19]) return !0;\n            }\n            return !1;\n        }\n        function getDistanceFromTop(win) {\n            void 0 === win && (win = window);\n            var distance = 0;\n            var parent = win;\n            for (;parent; ) (parent = getParent(parent)) && (distance += 1);\n            return distance;\n        }\n        function getNthParent(win, n) {\n            void 0 === n && (n = 1);\n            var parent = win;\n            for (var i = 0; i < n; i++) {\n                if (!parent) return;\n                parent = getParent(parent);\n            }\n            return parent;\n        }\n        function getNthParentFromTop(win, n) {\n            void 0 === n && (n = 1);\n            return getNthParent(win, getDistanceFromTop(win) - n);\n        }\n        function isSameTopWindow(win1, win2) {\n            var top1 = getTop(win1) || win1;\n            var top2 = getTop(win2) || win2;\n            try {\n                if (top1 && top2) return top1 === top2;\n            } catch (err) {}\n            var allFrames1 = getAllFramesInWindow(win1);\n            var allFrames2 = getAllFramesInWindow(win2);\n            if (anyMatch(allFrames1, allFrames2)) return !0;\n            var opener1 = getOpener(top1);\n            var opener2 = getOpener(top2);\n            return opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2) || opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1), \n            !1;\n        }\n        function matchDomain(pattern, origin) {\n            if (\"string\" == typeof pattern) {\n                if (\"string\" == typeof origin) return pattern === WILDCARD || origin === pattern;\n                if (isRegex(origin)) return !1;\n                if (Array.isArray(origin)) return !1;\n            }\n            return isRegex(pattern) ? isRegex(origin) ? pattern.toString() === origin.toString() : !Array.isArray(origin) && Boolean(origin.match(pattern)) : !!Array.isArray(pattern) && (Array.isArray(origin) ? JSON.stringify(pattern) === JSON.stringify(origin) : !isRegex(origin) && pattern.some((function(subpattern) {\n                return matchDomain(subpattern, origin);\n            })));\n        }\n        function stringifyDomainPattern(pattern) {\n            return Array.isArray(pattern) ? \"(\" + pattern.join(\" | \") + \")\" : isRegex(pattern) ? \"RegExp(\" + pattern.toString() + \")\" : pattern.toString();\n        }\n        function getDomainFromUrl(url) {\n            return /^(https?|mock|file):\\/\\//.exec(url) ? url.split(\"/\").slice(0, 3).join(\"/\") : getDomain();\n        }\n        function onCloseWindow(win, callback, delay, maxtime) {\n            void 0 === delay && (delay = 1e3);\n            void 0 === maxtime && (maxtime = 1 / 0);\n            var timeout;\n            !function check() {\n                if (isWindowClosed(win)) {\n                    timeout && clearTimeout(timeout);\n                    return callback();\n                }\n                if (maxtime <= 0) clearTimeout(timeout); else {\n                    maxtime -= delay;\n                    timeout = setTimeout(check, delay);\n                }\n            }();\n            return {\n                cancel: function() {\n                    timeout && clearTimeout(timeout);\n                }\n            };\n        }\n        function isWindow(obj) {\n            try {\n                if (obj === window) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (\"[object Window]\" === {}.toString.call(obj)) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (window.Window && obj instanceof window.Window) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (obj && obj.self === obj) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (obj && obj.parent === obj) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (obj && obj.top === obj) return !0;\n            } catch (err) {\n                if (err && err.message === IE_WIN_ACCESS_ERROR) return !0;\n            }\n            try {\n                if (obj && \"__unlikely_value__\" === obj.__cross_domain_utils_window_check__) return !1;\n            } catch (err) {\n                return !0;\n            }\n            try {\n                if (\"postMessage\" in obj && \"self\" in obj && \"location\" in obj) return !0;\n            } catch (err) {}\n            return !1;\n        }\n        function isBrowser() {\n            return \"undefined\" != typeof window && void 0 !== window.location;\n        }\n        function isCurrentDomain(domain) {\n            return !!isBrowser() && getDomain() === domain;\n        }\n        function isMockDomain(domain) {\n            return domain.startsWith(PROTOCOL.MOCK);\n        }\n        function normalizeMockUrl(url) {\n            if (!isMockDomain(getDomainFromUrl(url))) return url;\n            throw new Error(\"Mock urls not supported out of test mode\");\n        }\n        function getFrameForWindow(win) {\n            if (isSameDomain(win)) return assertSameDomain(win).frameElement;\n            for (var _i21 = 0, _document$querySelect2 = document.querySelectorAll(\"iframe\"); _i21 < _document$querySelect2.length; _i21++) {\n                var frame = _document$querySelect2[_i21];\n                if (frame && frame.contentWindow && frame.contentWindow === win) return frame;\n            }\n        }\n        function closeWindow(win) {\n            if (isIframe(win)) {\n                var frame = getFrameForWindow(win);\n                if (frame && frame.parentElement) {\n                    frame.parentElement.removeChild(frame);\n                    return;\n                }\n            }\n            try {\n                win.close();\n            } catch (err) {}\n        }\n    } ]);\n}));","/* eslint flowtype/require-valid-file-annotation: off, import/no-commonjs: off */\nmodule.exports = require(\"./dist/zalgo-promise\");\n","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(\"xdsweakmap\",[],t):\"object\"==typeof exports?exports.xdsweakmap=t():e.xdsweakmap=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return{}.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=0)}([function(e,t,r){\"use strict\";r.r(t),r.d(t,\"WeakMap\",(function(){return p}));var n=\"Call was rejected by callee.\\r\\n\";function i(e){return void 0===e&&(e=window),e.location.protocol}function o(e){if(void 0===e&&(e=window),e.mockDomain){var t=e.mockDomain.split(\"//\")[0];if(t)return t}return i(e)}function a(e){return void 0===e&&(e=window),\"about:\"===o(e)}function c(e){try{return!0}catch(e){}return!1}function u(e){void 0===e&&(e=window);var t=e.location;if(!t)throw new Error(\"Can not read window location\");var r=i(e);if(!r)throw new Error(\"Can not read window protocol\");if(\"file:\"===r)return\"file://\";if(\"about:\"===r){var n=function(e){if(void 0===e&&(e=window),e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){}}(e);return n&&c()?u(n):\"about://\"}var o=t.host;if(!o)throw new Error(\"Can not read window host\");return r+\"//\"+o}function f(e){void 0===e&&(e=window);var t=u(e);return t&&e.mockDomain&&0===e.mockDomain.indexOf(\"mock:\")?e.mockDomain:t}var s=[],d=[];function h(e,t){void 0===t&&(t=!0);try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||e.message!==n}if(t&&function(e){if(!function(e){try{if(e===window)return!0}catch(e){}try{var t=Object.getOwnPropertyDescriptor(e,\"location\");if(t&&!1===t.enumerable)return!1}catch(e){}try{if(a(e)&&c())return!0}catch(e){}try{if(function(e){return void 0===e&&(e=window),\"mock:\"===o(e)}(e)&&c())return!0}catch(e){}try{if(u(e)===u(window))return!0}catch(e){}return!1}(e))return!1;try{if(e===window)return!0;if(a(e)&&c())return!0;if(f(window)===f(e))return!0}catch(e){}return!1}(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}var r=function(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}(s,e);if(-1!==r){var i=d[r];if(i&&function(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var t=e.ownerDocument;if(t&&t.documentElement&&!t.documentElement.contains(e)){for(var r=e;r.parentNode&&r.parentNode!==r;)r=r.parentNode;if(!r.host||!t.documentElement.contains(r.host))return!0}return!1}(i))return!0}return!1}function l(e){try{if(e===window)return!0}catch(e){if(e&&e.message===n)return!0}try{if(\"[object Window]\"==={}.toString.call(e))return!0}catch(e){if(e&&e.message===n)return!0}try{if(window.Window&&e instanceof window.Window)return!0}catch(e){if(e&&e.message===n)return!0}try{if(e&&e.self===e)return!0}catch(e){if(e&&e.message===n)return!0}try{if(e&&e.parent===e)return!0}catch(e){if(e&&e.message===n)return!0}try{if(e&&e.top===e)return!0}catch(e){if(e&&e.message===n)return!0}try{if(e&&\"__unlikely_value__\"===e.__cross_domain_utils_window_check__)return!1}catch(e){return!0}try{if(\"postMessage\"in e&&\"self\"in e&&\"location\"in e)return!0}catch(e){}return!1}function w(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}var p=function(){function e(){if(this.name=void 0,this.weakmap=void 0,this.keys=void 0,this.values=void 0,this.name=\"__weakmap_\"+(1e9*Math.random()>>>0)+\"__\",function(){if(\"undefined\"==typeof WeakMap)return!1;if(void 0===Object.freeze)return!1;try{var e=new WeakMap,t={};return Object.freeze(t),e.set(t,\"__testvalue__\"),\"__testvalue__\"===e.get(t)}catch(e){return!1}}())try{this.weakmap=new WeakMap}catch(e){}this.keys=[],this.values=[]}var t=e.prototype;return t._cleanupClosedWindows=function(){for(var e=this.weakmap,t=this.keys,r=0;r<t.length;r++){var n=t[r];if(l(n)&&h(n)){if(e)try{e.delete(n)}catch(e){}t.splice(r,1),this.values.splice(r,1),r-=1}}},t.isSafeToReadWrite=function(e){return!l(e)},t.set=function(e,t){if(!e)throw new Error(\"WeakMap expected key\");var r=this.weakmap;if(r)try{r.set(e,t)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var n=this.name,i=e[n];return void(i&&i[0]===e?i[1]=t:Object.defineProperty(e,n,{value:[e,t],writable:!0}))}catch(e){}this._cleanupClosedWindows();var o=this.keys,a=this.values,c=w(o,e);-1===c?(o.push(e),a.push(t)):a[c]=t},t.get=function(e){if(!e)throw new Error(\"WeakMap expected key\");var t=this.weakmap;if(t)try{if(t.has(e))return t.get(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return r&&r[0]===e?r[1]:void 0}catch(e){}this._cleanupClosedWindows();var n=w(this.keys,e);if(-1!==n)return this.values[n]},t.delete=function(e){if(!e)throw new Error(\"WeakMap expected key\");var t=this.weakmap;if(t)try{t.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];r&&r[0]===e&&(r[0]=r[1]=void 0)}catch(e){}this._cleanupClosedWindows();var n=this.keys,i=w(n,e);-1!==i&&(n.splice(i,1),this.values.splice(i,1))},t.has=function(e){if(!e)throw new Error(\"WeakMap expected key\");var t=this.weakmap;if(t)try{if(t.has(e))return!0}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return!(!r||r[0]!==e)}catch(e){}return this._cleanupClosedWindows(),-1!==w(this.keys,e)},t.getOrSet=function(e,t){if(this.has(e))return this.get(e);var r=t();return this.set(e,r),r},e}()}])}));\n//# sourceMappingURL=cross-domain-safe-weakmap.js.map","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(\"ZalgoPromise\",[],t):\"object\"==typeof exports?exports.ZalgoPromise=t():e.ZalgoPromise=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return{}.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=0)}([function(e,t,r){\"use strict\";function n(e){try{if(!e)return!1;if(\"undefined\"!=typeof Promise&&e instanceof Promise)return!0;if(\"undefined\"!=typeof window&&\"function\"==typeof window.Window&&e instanceof window.Window)return!1;if(\"undefined\"!=typeof window&&\"function\"==typeof window.constructor&&e instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(e);if(\"[object Window]\"===r||\"[object global]\"===r||\"[object DOMWindow]\"===r)return!1}if(\"function\"==typeof e.then)return!0}catch(e){return!1}return!1}r.r(t),r.d(t,\"ZalgoPromise\",(function(){return a}));var o,i=[],c=[],u=0;function s(){if(!u&&o){var e=o;o=null,e.resolve()}}function f(){u+=1}function l(){u-=1,s()}var a=function(){function e(e){var t=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],e){var r,n,o=!1,i=!1,c=!1;f();try{e((function(e){c?t.resolve(e):(o=!0,r=e)}),(function(e){c?t.reject(e):(i=!0,n=e)}))}catch(e){return l(),void this.reject(e)}l(),c=!0,o?this.resolve(r):i&&this.reject(n)}}var t=e.prototype;return t.resolve=function(e){if(this.resolved||this.rejected)return this;if(n(e))throw new Error(\"Can not resolve promise with another promise\");return this.resolved=!0,this.value=e,this.dispatch(),this},t.reject=function(e){var t=this;if(this.resolved||this.rejected)return this;if(n(e))throw new Error(\"Can not reject promise with another promise\");if(!e){var r=e&&\"function\"==typeof e.toString?e.toString():{}.toString.call(e);e=new Error(\"Expected reject to be called with Error, got \"+r)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout((function(){t.errorHandled||function(e,t){if(-1===i.indexOf(e)){i.push(e),setTimeout((function(){throw e}),1);for(var r=0;r<c.length;r++)c[r](e,t)}}(e,t)}),1),this.dispatch(),this},t.asyncReject=function(e){return this.errorHandled=!0,this.reject(e),this},t.dispatch=function(){var t=this.resolved,r=this.rejected,o=this.handlers;if(!this.dispatching&&(t||r)){this.dispatching=!0,f();for(var i=function(e,t){return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)}))},c=0;c<o.length;c++){var u=o[c],s=u.onSuccess,a=u.onError,h=u.promise,d=void 0;if(t)try{d=s?s(this.value):this.value}catch(e){h.reject(e);continue}else if(r){if(!a){h.reject(this.error);continue}try{d=a(this.error)}catch(e){h.reject(e);continue}}if(d instanceof e&&(d.resolved||d.rejected)){var v=d;v.resolved?h.resolve(v.value):h.reject(v.error),v.errorHandled=!0}else n(d)?d instanceof e&&(d.resolved||d.rejected)?d.resolved?h.resolve(d.value):h.reject(d.error):i(d,h):h.resolve(d)}o.length=0,this.dispatching=!1,l()}},t.then=function(t,r){if(t&&\"function\"!=typeof t&&!t.call)throw new Error(\"Promise.then expected a function for success handler\");if(r&&\"function\"!=typeof r&&!r.call)throw new Error(\"Promise.then expected a function for error handler\");var n=new e;return this.handlers.push({promise:n,onSuccess:t,onError:r}),this.errorHandled=!0,this.dispatch(),n},t.catch=function(e){return this.then(void 0,e)},t.finally=function(t){if(t&&\"function\"!=typeof t&&!t.call)throw new Error(\"Promise.finally expected a function\");return this.then((function(r){return e.try(t).then((function(){return r}))}),(function(r){return e.try(t).then((function(){throw r}))}))},t.timeout=function(e,t){var r=this;if(this.resolved||this.rejected)return this;var n=setTimeout((function(){r.resolved||r.rejected||r.reject(t||new Error(\"Promise timed out after \"+e+\"ms\"))}),e);return this.then((function(e){return clearTimeout(n),e}))},t.toPromise=function(){if(\"undefined\"==typeof Promise)throw new TypeError(\"Could not find Promise\");return Promise.resolve(this)},t.lazy=function(){return this.errorHandled=!0,this},e.resolve=function(t){return t instanceof e?t:n(t)?new e((function(e,r){return t.then(e,r)})):(new e).resolve(t)},e.reject=function(t){return(new e).reject(t)},e.asyncReject=function(t){return(new e).asyncReject(t)},e.all=function(t){var r=new e,o=t.length,i=[].slice();if(!o)return r.resolve(i),r;for(var c=function(e,t,n){return t.then((function(t){i[e]=t,0==(o-=1)&&r.resolve(i)}),(function(e){n.reject(e)}))},u=0;u<t.length;u++){var s=t[u];if(s instanceof e){if(s.resolved){i[u]=s.value,o-=1;continue}}else if(!n(s)){i[u]=s,o-=1;continue}c(u,e.resolve(s),r)}return 0===o&&r.resolve(i),r},e.hash=function(t){var r={},o=[],i=function(e){if(t.hasOwnProperty(e)){var i=t[e];n(i)?o.push(i.then((function(t){r[e]=t}))):r[e]=i}};for(var c in t)i(c);return e.all(o).then((function(){return r}))},e.map=function(t,r){return e.all(t.map(r))},e.onPossiblyUnhandledException=function(e){return function(e){return c.push(e),{cancel:function(){c.splice(c.indexOf(e),1)}}}(e)},e.try=function(t,r,n){if(t&&\"function\"!=typeof t&&!t.call)throw new Error(\"Promise.try expected a function\");var o;f();try{o=t.apply(r,n||[])}catch(t){return l(),e.reject(t)}return l(),e.resolve(o)},e.delay=function(t){return new e((function(e){setTimeout(e,t)}))},e.isPromise=function(t){return!!(t&&t instanceof e)||n(t)},e.flush=function(){return t=o=o||new e,s(),t;var t},e}()}])}));\n//# sourceMappingURL=zalgo-promise.js.map","import { isRegex, noop } from \"./util\";\nimport { PROTOCOL, WILDCARD } from \"./constants\";\nvar IE_WIN_ACCESS_ERROR = \"Call was rejected by callee.\\r\\n\";\nexport function getActualProtocol(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return win.location.protocol;\n}\nexport function getProtocol(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  // @ts-expect-error mockDomain does not exist on window\n  if (win.mockDomain) {\n    // @ts-expect-error mockDomain does not exist on window\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n    var protocol = win.mockDomain.split(\"//\")[0];\n    if (protocol) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return protocol;\n    }\n  }\n  return getActualProtocol(win);\n}\nexport function isFileProtocol(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return getProtocol(win) === PROTOCOL.FILE;\n}\nexport function isAboutProtocol(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return getProtocol(win) === PROTOCOL.ABOUT;\n}\nexport function isMockProtocol(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return getProtocol(win) === PROTOCOL.MOCK;\n}\nexport function getParent(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  if (!win) {\n    return;\n  }\n  try {\n    if (win.parent && win.parent !== win) {\n      return win.parent;\n    }\n  } catch (err) {\n    // pass\n  }\n}\nexport function getOpener(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  if (!win) {\n    return;\n  }\n\n  // Make sure we're not actually an iframe which has had window.open() called on us\n  if (getParent(win)) {\n    return;\n  }\n  try {\n    return win.opener;\n  } catch (err) {\n    // pass\n  }\n}\nexport function canReadFromWindow(win) {\n  try {\n    noop(win && win.location && win.location.href);\n    return true;\n  } catch (err) {\n    // pass\n  }\n  return false;\n}\nexport function getActualDomain(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  var location = win.location;\n  if (!location) {\n    throw new Error(\"Can not read window location\");\n  }\n  var protocol = getActualProtocol(win);\n  if (!protocol) {\n    throw new Error(\"Can not read window protocol\");\n  }\n  if (protocol === PROTOCOL.FILE) {\n    return PROTOCOL.FILE + \"//\";\n  }\n  if (protocol === PROTOCOL.ABOUT) {\n    // @ts-expect-error - trying to reassing to something that might be window\n    var parent = getParent(win);\n    if (parent && canReadFromWindow(parent)) {\n      return getActualDomain(parent);\n    }\n    return PROTOCOL.ABOUT + \"//\";\n  }\n  var host = location.host;\n  if (!host) {\n    throw new Error(\"Can not read window host\");\n  }\n  return protocol + \"//\" + host;\n}\nexport function getDomain(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  var domain = getActualDomain(win);\n  if (domain &&\n  // @ts-expect-error - mockDomain\n  win.mockDomain &&\n  // @ts-expect-error - mockDomain\n  win.mockDomain.startsWith(PROTOCOL.MOCK)) {\n    // @ts-expect-error - mockDomain\n    return win.mockDomain;\n  }\n  return domain;\n}\nexport function isBlankDomain(win) {\n  try {\n    if (!win.location.href) {\n      return true;\n    }\n    if (win.location.href === \"about:blank\") {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  return false;\n}\nexport function isActuallySameDomain(win) {\n  try {\n    if (win === window) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    var desc = Object.getOwnPropertyDescriptor(win, \"location\");\n    if (desc && desc.enumerable === false) {\n      return false;\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    if (isAboutProtocol(win) && canReadFromWindow(win)) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    if (isMockProtocol(win) && canReadFromWindow(win)) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    if (getActualDomain(win) === getActualDomain(window)) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  return false;\n}\nexport function isSameDomain(win) {\n  if (!isActuallySameDomain(win)) {\n    return false;\n  }\n  try {\n    if (win === window) {\n      return true;\n    }\n    if (isAboutProtocol(win) && canReadFromWindow(win)) {\n      return true;\n    }\n    if (getDomain(window) === getDomain(win)) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  return false;\n}\nexport function assertSameDomain(win) {\n  if (!isSameDomain(win)) {\n    throw new Error(\"Expected window to be same domain\");\n  }\n  return win;\n}\nexport function getParents(win) {\n  var result = [];\n  try {\n    while (win.parent !== win) {\n      result.push(win.parent);\n      win = win.parent;\n    }\n  } catch (err) {\n    // pass\n  }\n  return result;\n}\nexport function isAncestorParent(parent, child) {\n  if (!parent || !child) {\n    return false;\n  }\n  var childParent = getParent(child);\n  if (childParent) {\n    return childParent === parent;\n  }\n  if (getParents(child).includes(parent)) {\n    return true;\n  }\n  return false;\n}\nexport function getFrames(win) {\n  var result = [];\n  var frames;\n  try {\n    frames = win.frames;\n  } catch (err) {\n    frames = win;\n  }\n  var len;\n  try {\n    len = frames.length;\n  } catch (err) {\n    // pass\n  }\n  if (len === 0) {\n    return result;\n  }\n  if (len) {\n    for (var i = 0; i < len; i++) {\n      var frame = void 0;\n      try {\n        frame = frames[i];\n      } catch (err) {\n        continue;\n      }\n      result.push(frame);\n    }\n    return result;\n  }\n  for (var _i = 0; _i < 100; _i++) {\n    var _frame = void 0;\n    try {\n      _frame = frames[_i];\n    } catch (err) {\n      return result;\n    }\n    if (!_frame) {\n      return result;\n    }\n    result.push(_frame);\n  }\n  return result;\n}\nexport function getAllChildFrames(win) {\n  var result = [];\n  for (var _i3 = 0, _getFrames2 = getFrames(win); _i3 < _getFrames2.length; _i3++) {\n    var frame = _getFrames2[_i3];\n    result.push(frame);\n    for (var _i5 = 0, _getAllChildFrames2 = getAllChildFrames(frame); _i5 < _getAllChildFrames2.length; _i5++) {\n      var childFrame = _getAllChildFrames2[_i5];\n      result.push(childFrame);\n    }\n  }\n  return result;\n}\nexport function getTop(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  try {\n    if (win.top) {\n      return win.top;\n    }\n  } catch (err) {\n    // pass\n  }\n  if (getParent(win) === win) {\n    return win;\n  }\n  try {\n    if (isAncestorParent(window, win) && window.top) {\n      return window.top;\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    if (isAncestorParent(win, window) && window.top) {\n      return window.top;\n    }\n  } catch (err) {\n    // pass\n  }\n  for (var _i7 = 0, _getAllChildFrames4 = getAllChildFrames(win); _i7 < _getAllChildFrames4.length; _i7++) {\n    var frame = _getAllChildFrames4[_i7];\n    try {\n      if (frame.top) {\n        return frame.top;\n      }\n    } catch (err) {\n      // pass\n    }\n    if (getParent(frame) === frame) {\n      return frame;\n    }\n  }\n}\nexport function getNextOpener(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return getOpener(getTop(win) || win);\n}\nexport function getUltimateTop(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  var opener = getNextOpener(win);\n  if (opener) {\n    return getUltimateTop(opener);\n  }\n\n  // @ts-expect-error where does top come from here?\n  return top;\n}\nexport function getAllFramesInWindow(win) {\n  var top = getTop(win);\n  if (!top) {\n    throw new Error(\"Can not determine top window\");\n  }\n  var result = [].concat(getAllChildFrames(top), [top]);\n\n  // Win may be in shadow dom\n  if (!result.includes(win)) {\n    result = [].concat(result, [win], getAllChildFrames(win));\n  }\n  return result;\n}\nexport function getAllWindows(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  var frames = getAllFramesInWindow(win);\n  var opener = getNextOpener(win);\n  if (opener) {\n    return [].concat(getAllWindows(opener), frames);\n  } else {\n    return frames;\n  }\n}\nexport function isTop(win) {\n  return win === getTop(win);\n}\nexport function isFrameWindowClosed(frame) {\n  if (!frame.contentWindow) {\n    return true;\n  }\n  if (!frame.parentNode) {\n    return true;\n  }\n  var doc = frame.ownerDocument;\n  if (doc && doc.documentElement && !doc.documentElement.contains(frame)) {\n    var parent = frame;\n    while (parent.parentNode && parent.parentNode !== parent) {\n      // @ts-expect-error parentNode is missing from HTMLIFrameElement\n      parent = parent.parentNode;\n    }\n\n    // @ts-expect-error - host does not exist on type frame\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    if (!parent.host || !doc.documentElement.contains(parent.host)) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction safeIndexOf(collection, item) {\n  for (var i = 0; i < collection.length; i++) {\n    try {\n      if (collection[i] === item) {\n        return i;\n      }\n    } catch (err) {\n      // pass\n    }\n  }\n  return -1;\n}\nvar iframeWindows = [];\nvar iframeFrames = [];\nexport function isWindowClosed(win, allowMock) {\n  if (allowMock === void 0) {\n    allowMock = true;\n  }\n  try {\n    if (win === window) {\n      return false;\n    }\n  } catch (err) {\n    return true;\n  }\n  try {\n    if (!win) {\n      return true;\n    }\n  } catch (err) {\n    return true;\n  }\n  try {\n    if (win.closed) {\n      return true;\n    }\n  } catch (err) {\n    // I love you so much IE\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return false;\n    }\n    return true;\n  }\n  if (allowMock && isSameDomain(win)) {\n    try {\n      // @ts-expect-error win.mockclosed is our own added var on window\n      if (win.mockclosed) {\n        return true;\n      }\n    } catch (err) {\n      // pass\n    }\n  }\n\n  // Mobile safari\n  try {\n    if (!win.parent || !win.top) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n\n  // Yes, this actually happens in IE. win === win errors out when the window\n  // is from an iframe, and the iframe was removed from the page.\n  try {\n    noop(win === win); // eslint-disable-line no-self-compare\n  } catch (err) {\n    return true;\n  }\n\n  // IE orphaned frame\n  var iframeIndex = safeIndexOf(iframeWindows, win);\n  if (iframeIndex !== -1) {\n    var frame = iframeFrames[iframeIndex];\n    if (frame && isFrameWindowClosed(frame)) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction cleanIframes() {\n  for (var i = 0; i < iframeWindows.length; i++) {\n    var closed = false;\n    try {\n      closed = iframeWindows[i].closed;\n    } catch (err) {\n      // pass\n    }\n    if (closed) {\n      iframeFrames.splice(i, 1);\n      iframeWindows.splice(i, 1);\n    }\n  }\n}\nexport function linkFrameWindow(frame) {\n  cleanIframes();\n  if (frame && frame.contentWindow) {\n    try {\n      iframeWindows.push(frame.contentWindow);\n      iframeFrames.push(frame);\n    } catch (err) {\n      // pass\n    }\n  }\n}\nexport function getUserAgent(win) {\n  win = win || window;\n  // @ts-expect-error win.mockUserAgent is our own added var\n  return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\nexport function getFrameByName(win, name) {\n  var winFrames = getFrames(win);\n  for (var _i9 = 0; _i9 < winFrames.length; _i9++) {\n    var childFrame = winFrames[_i9];\n    try {\n      if (isSameDomain(childFrame) && childFrame.name === name && winFrames.includes(childFrame)) {\n        return childFrame;\n      }\n    } catch (err) {\n      // pass\n    }\n  }\n  try {\n    // @ts-expect-error win.frames is implicit any so no indexing\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    if (winFrames.includes(win.frames[name])) {\n      // @ts-expect-error win.frames is implicit any so no indexing\n      return win.frames[name];\n    }\n  } catch (err) {\n    // pass\n  }\n  try {\n    // @ts-expect-error win can't be indexed by name which is string\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    if (winFrames.includes(win[name])) {\n      // @ts-expect-error win can't be indexed by name which is string\n      return win[name];\n    }\n  } catch (err) {\n    // pass\n  }\n}\nexport function findChildFrameByName(win, name) {\n  var frame = getFrameByName(win, name);\n  if (frame) {\n    return frame;\n  }\n  for (var _i11 = 0, _getFrames4 = getFrames(win); _i11 < _getFrames4.length; _i11++) {\n    var childFrame = _getFrames4[_i11];\n    var namedFrame = findChildFrameByName(childFrame, name);\n    if (namedFrame) {\n      return namedFrame;\n    }\n  }\n}\nexport function findFrameByName(win, name) {\n  var frame = getFrameByName(win, name);\n  if (frame) {\n    return frame;\n  }\n  var top = getTop(win) || win;\n  return findChildFrameByName(top, name);\n}\nexport function isParent(win, frame) {\n  var frameParent = getParent(frame);\n  if (frameParent) {\n    return frameParent === win;\n  }\n  for (var _i13 = 0, _getFrames6 = getFrames(win); _i13 < _getFrames6.length; _i13++) {\n    var childFrame = _getFrames6[_i13];\n    if (childFrame === frame) {\n      return true;\n    }\n  }\n  return false;\n}\nexport function isOpener(parent, child) {\n  return parent === getOpener(child);\n}\nexport function getAncestor(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  win = win || window;\n  var opener = getOpener(win);\n  if (opener) {\n    return opener;\n  }\n  var parent = getParent(win);\n  if (parent) {\n    return parent;\n  }\n}\nexport function getAncestors(win) {\n  var results = [];\n  var ancestor = win;\n  while (ancestor) {\n    // @ts-expect-error type Window | undefined is not assignable to type Window\n    ancestor = getAncestor(ancestor);\n    if (ancestor) {\n      results.push(ancestor);\n    }\n  }\n  return results;\n}\nexport function isAncestor(parent, child) {\n  var actualParent = getAncestor(child);\n  if (actualParent) {\n    if (actualParent === parent) {\n      return true;\n    }\n    return false;\n  }\n  if (child === parent) {\n    return false;\n  }\n  if (getTop(child) === child) {\n    return false;\n  }\n  for (var _i15 = 0, _getFrames8 = getFrames(parent); _i15 < _getFrames8.length; _i15++) {\n    var frame = _getFrames8[_i15];\n    if (frame === child) {\n      return true;\n    }\n  }\n  return false;\n}\nexport function isPopup(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return Boolean(getOpener(win));\n}\nexport function isIframe(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return Boolean(getParent(win));\n}\nexport function isFullpage(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return Boolean(!isIframe(win) && !isPopup(win));\n}\nfunction anyMatch(collection1, collection2) {\n  for (var _i17 = 0; _i17 < collection1.length; _i17++) {\n    var item1 = collection1[_i17];\n    for (var _i19 = 0; _i19 < collection2.length; _i19++) {\n      var item2 = collection2[_i19];\n      if (item1 === item2) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\nexport function getDistanceFromTop(win) {\n  if (win === void 0) {\n    win = window;\n  }\n  var distance = 0;\n  var parent = win;\n  while (parent) {\n    // @ts-expect-error - trying to reassing to something that might be window\n    parent = getParent(parent);\n    if (parent) {\n      distance += 1;\n    }\n  }\n  return distance;\n}\nexport function getNthParent(win, n) {\n  if (n === void 0) {\n    n = 1;\n  }\n  var parent = win;\n  for (var i = 0; i < n; i++) {\n    if (!parent) {\n      return;\n    }\n\n    // @ts-expect-error - trying to reassign to something that might be window\n    parent = getParent(parent);\n  }\n  return parent;\n}\nexport function getNthParentFromTop(win, n) {\n  if (n === void 0) {\n    n = 1;\n  }\n  return getNthParent(win, getDistanceFromTop(win) - n);\n}\nexport function isSameTopWindow(win1, win2) {\n  var top1 = getTop(win1) || win1;\n  var top2 = getTop(win2) || win2;\n  try {\n    if (top1 && top2) {\n      if (top1 === top2) {\n        return true;\n      }\n      return false;\n    }\n  } catch (err) {\n    // pass\n  }\n  var allFrames1 = getAllFramesInWindow(win1);\n  var allFrames2 = getAllFramesInWindow(win2);\n  if (anyMatch(allFrames1, allFrames2)) {\n    return true;\n  }\n  var opener1 = getOpener(top1);\n  var opener2 = getOpener(top2);\n  if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n    return false;\n  }\n  if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n    return false;\n  }\n  return false;\n}\nexport function matchDomain(pattern, origin) {\n  if (typeof pattern === \"string\") {\n    if (typeof origin === \"string\") {\n      return pattern === WILDCARD || origin === pattern;\n    }\n    if (isRegex(origin)) {\n      return false;\n    }\n    if (Array.isArray(origin)) {\n      return false;\n    }\n  }\n  if (isRegex(pattern)) {\n    if (isRegex(origin)) {\n      return pattern.toString() === origin.toString();\n    }\n    if (Array.isArray(origin)) {\n      return false;\n    }\n\n    // @ts-expect-error - earlier already shortcutted the string case\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    return Boolean(origin.match(pattern));\n  }\n  if (Array.isArray(pattern)) {\n    if (Array.isArray(origin)) {\n      return JSON.stringify(pattern) === JSON.stringify(origin);\n    }\n    if (isRegex(origin)) {\n      return false;\n    }\n    return pattern.some(function (subpattern) {\n      return matchDomain(subpattern, origin);\n    });\n  }\n  return false;\n}\nexport function stringifyDomainPattern(pattern) {\n  if (Array.isArray(pattern)) {\n    return \"(\" + pattern.join(\" | \") + \")\";\n  } else if (isRegex(pattern)) {\n    return \"RegExp(\" + pattern.toString() + \")\";\n  } else {\n    return pattern.toString();\n  }\n}\nexport function getDomainFromUrl(url) {\n  var domain;\n  if (/^(https?|mock|file):\\/\\//.exec(url)) {\n    domain = url;\n  } else {\n    return getDomain();\n  }\n  domain = domain.split(\"/\").slice(0, 3).join(\"/\");\n  return domain;\n}\nexport function onCloseWindow(win, callback, delay, maxtime) {\n  if (delay === void 0) {\n    delay = 1000;\n  }\n  if (maxtime === void 0) {\n    maxtime = Infinity;\n  }\n  var timeout;\n  var check = function check() {\n    if (isWindowClosed(win)) {\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n      return callback();\n    }\n    if (maxtime <= 0) {\n      clearTimeout(timeout);\n    } else {\n      maxtime -= delay;\n      timeout = setTimeout(check, delay);\n    }\n  };\n  check();\n  return {\n    cancel: function cancel() {\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n    }\n  };\n}\n\n// eslint-disable-next-line complexity\nexport function isWindow(obj) {\n  try {\n    if (obj === window) {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    if (Object.prototype.toString.call(obj) === \"[object Window]\") {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    if (window.Window && obj instanceof window.Window) {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    // @ts-expect-error not complete sure that obj has self. needs guard\n    if (obj && obj.self === obj) {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    // @ts-expect-error not complete sure that obj has parent. needs guard\n    if (obj && obj.parent === obj) {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    // @ts-expect-error not complete sure that obj has top. needs guard\n    if (obj && obj.top === obj) {\n      return true;\n    }\n  } catch (err) {\n    if (err && err.message === IE_WIN_ACCESS_ERROR) {\n      return true;\n    }\n  }\n  try {\n    // @ts-expect-error this equality check is a self compare\n    // eslint-disable-next-line  @typescript-eslint/no-confusing-void-expression, no-self-compare\n    if (noop(obj === obj) === \"__unlikely_value__\") {\n      return false;\n    }\n  } catch (err) {\n    return true;\n  }\n  try {\n    if (obj &&\n    // @ts-expect-error more shenanigans\n    obj.__cross_domain_utils_window_check__ === \"__unlikely_value__\") {\n      return false;\n    }\n  } catch (err) {\n    return true;\n  }\n  try {\n    // @ts-expect-error needs guard\n    if (\"postMessage\" in obj && \"self\" in obj && \"location\" in obj) {\n      return true;\n    }\n  } catch (err) {\n    // pass\n  }\n  return false;\n}\nexport function isBrowser() {\n  return typeof window !== \"undefined\" && typeof window.location !== \"undefined\";\n}\nexport function isCurrentDomain(domain) {\n  if (!isBrowser()) {\n    return false;\n  }\n  return getDomain() === domain;\n}\nexport function isMockDomain(domain) {\n  return domain.startsWith(PROTOCOL.MOCK);\n}\nexport function normalizeMockUrl(url) {\n  if (!isMockDomain(getDomainFromUrl(url))) {\n    return url;\n  }\n\n  // @ts-expect-error - global\n  if (!__TEST__) {\n    throw new Error(\"Mock urls not supported out of test mode\");\n  }\n  return url.replace(/^mock:\\/\\/[^/]+/, getActualDomain(window));\n}\nexport function getFrameForWindow(win) {\n  if (isSameDomain(win)) {\n    // @ts-expect-error Type 'Element | null' is not assignable to type 'Element | HTMLElement | undefined'\n    return assertSameDomain(win).frameElement;\n  }\n\n  // @ts-expect-error not an array type, but is iterable so fine\n  for (var _i21 = 0, _document$querySelect2 = document.querySelectorAll(\"iframe\"); _i21 < _document$querySelect2.length; _i21++) {\n    var frame = _document$querySelect2[_i21];\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (frame && frame.contentWindow && frame.contentWindow === win) {\n      return frame;\n    }\n  }\n}\nexport function closeWindow(win) {\n  if (isIframe(win)) {\n    var frame = getFrameForWindow(win);\n    if (frame && frame.parentElement) {\n      frame.parentElement.removeChild(frame);\n      return;\n    }\n  }\n  try {\n    win.close();\n  } catch (err) {\n    // pass\n  }\n}","export var PROTOCOL = {\n  MOCK: \"mock:\",\n  FILE: \"file:\",\n  ABOUT: \"about:\"\n};\nexport var WILDCARD = \"*\";\nexport var WINDOW_TYPE = {\n  IFRAME: \"iframe\",\n  POPUP: \"popup\"\n};","export function safeIndexOf(collection, item) {\n  for (var i = 0; i < collection.length; i++) {\n    try {\n      if (collection[i] === item) {\n        return i;\n      }\n    } catch (err) {\n      // pass\n    }\n  }\n  return -1;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function noop() {\n  // pass\n}","import { isWindow, isWindowClosed } from \"@krakenjs/cross-domain-utils/dist/esm\";\nimport { hasNativeWeakMap } from \"./native\";\nimport { noop, safeIndexOf } from \"./util\";\nexport var CrossDomainSafeWeakMap = /*#__PURE__*/function () {\n  function CrossDomainSafeWeakMap() {\n    this.name = void 0;\n    this.weakmap = void 0;\n    this.keys = void 0;\n    this.values = void 0;\n    // eslint-disable-next-line no-bitwise\n    this.name = \"__weakmap_\" + (Math.random() * 1e9 >>> 0) + \"__\";\n    if (hasNativeWeakMap()) {\n      try {\n        this.weakmap = new WeakMap();\n      } catch (err) {\n        // pass\n      }\n    }\n    this.keys = [];\n    this.values = [];\n  }\n  var _proto = CrossDomainSafeWeakMap.prototype;\n  _proto._cleanupClosedWindows = function _cleanupClosedWindows() {\n    var weakmap = this.weakmap;\n    var keys = this.keys;\n    for (var i = 0; i < keys.length; i++) {\n      var value = keys[i];\n\n      // @ts-expect-error `isWindowClosed` takes window which V is not\n      if (isWindow(value) && isWindowClosed(value)) {\n        if (weakmap) {\n          try {\n            weakmap.delete(value);\n          } catch (err) {\n            // pass\n          }\n        }\n        keys.splice(i, 1);\n        this.values.splice(i, 1);\n        i -= 1;\n      }\n    }\n  };\n  _proto.isSafeToReadWrite = function isSafeToReadWrite(key) {\n    if (isWindow(key)) {\n      return false;\n    }\n    try {\n      noop(key && key.self);\n      noop(key && key[this.name]);\n    } catch (err) {\n      return false;\n    }\n    return true;\n  };\n  _proto.set = function set(key, value) {\n    if (!key) {\n      throw new Error(\"WeakMap expected key\");\n    }\n    var weakmap = this.weakmap;\n    if (weakmap) {\n      try {\n        weakmap.set(key, value);\n      } catch (err) {\n        delete this.weakmap;\n      }\n    }\n    if (this.isSafeToReadWrite(key)) {\n      try {\n        var name = this.name;\n        var entry = key[name];\n\n        // @ts-expect-error entry is implicitly an any so cant index\n        if (entry && entry[0] === key) {\n          // @ts-expect-error entry is implicitly an any so cant index\n          entry[1] = value;\n        } else {\n          Object.defineProperty(key, name, {\n            value: [key, value],\n            writable: true\n          });\n        }\n        return;\n      } catch (err) {\n        // pass\n      }\n    }\n    this._cleanupClosedWindows();\n    var keys = this.keys;\n    var values = this.values;\n    var index = safeIndexOf(keys, key);\n    if (index === -1) {\n      keys.push(key);\n      values.push(value);\n    } else {\n      values[index] = value;\n    }\n  };\n  _proto.get = function get(key) {\n    if (!key) {\n      throw new Error(\"WeakMap expected key\");\n    }\n    var weakmap = this.weakmap;\n    if (weakmap) {\n      try {\n        if (weakmap.has(key)) {\n          return weakmap.get(key);\n        }\n      } catch (err) {\n        delete this.weakmap;\n      }\n    }\n    if (this.isSafeToReadWrite(key)) {\n      try {\n        var entry = key[this.name];\n\n        // @ts-expect-error entry is implicitly an any so cant index\n        if (entry && entry[0] === key) {\n          // @ts-expect-error entry is implicitly an any so cant index\n          return entry[1];\n        }\n        return;\n      } catch (err) {\n        // pass\n      }\n    }\n    this._cleanupClosedWindows();\n    var keys = this.keys;\n    var index = safeIndexOf(keys, key);\n    if (index === -1) {\n      return;\n    }\n    return this.values[index];\n  };\n  _proto.delete = function _delete(key) {\n    if (!key) {\n      throw new Error(\"WeakMap expected key\");\n    }\n    var weakmap = this.weakmap;\n    if (weakmap) {\n      try {\n        weakmap.delete(key);\n      } catch (err) {\n        delete this.weakmap;\n      }\n    }\n    if (this.isSafeToReadWrite(key)) {\n      try {\n        var entry = key[this.name];\n\n        // @ts-expect-error entry is implicitly an any so cant index\n        if (entry && entry[0] === key) {\n          // @ts-expect-error entry is implicitly an any so cant index\n          entry[0] = entry[1] = undefined;\n        }\n      } catch (err) {\n        // pass\n      }\n    }\n    this._cleanupClosedWindows();\n    var keys = this.keys;\n    var index = safeIndexOf(keys, key);\n    if (index !== -1) {\n      keys.splice(index, 1);\n      this.values.splice(index, 1);\n    }\n  };\n  _proto.has = function has(key) {\n    if (!key) {\n      throw new Error(\"WeakMap expected key\");\n    }\n    var weakmap = this.weakmap;\n    if (weakmap) {\n      try {\n        if (weakmap.has(key)) {\n          return true;\n        }\n      } catch (err) {\n        delete this.weakmap;\n      }\n    }\n    if (this.isSafeToReadWrite(key)) {\n      try {\n        var entry = key[this.name];\n\n        // @ts-expect-error entry is implicitly an any so cant index\n        if (entry && entry[0] === key) {\n          return true;\n        }\n        return false;\n      } catch (err) {\n        // pass\n      }\n    }\n    this._cleanupClosedWindows();\n    var index = safeIndexOf(this.keys, key);\n    return index !== -1;\n  };\n  _proto.getOrSet = function getOrSet(key, getter) {\n    if (this.has(key)) {\n      // @ts-expect-error v | undefined is not assignable to v. need a guard check\n      return this.get(key);\n    }\n    var value = getter();\n    this.set(key, value);\n    return value;\n  };\n  return CrossDomainSafeWeakMap;\n}();","import _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport _wrapNativeSuper from \"@babel/runtime/helpers/esm/wrapNativeSuper\";\n/* eslint max-lines: 0 */\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { WeakMap } from \"@krakenjs/cross-domain-safe-weakmap/dist/esm\";\nexport function getEmptyObject() {\n  return {};\n}\nexport function isElement(element) {\n  var passed = false;\n  try {\n    if (element instanceof window.Element) {\n      passed = true;\n    } else if (element !== null && typeof element === \"object\" &&\n    // @ts-expect-error - not refined to element yet\n    element.nodeType === 1 &&\n    // @ts-expect-error - not refined to element yet\n    typeof element.style === \"object\" &&\n    // @ts-expect-error - not refined to element yet\n    typeof element.ownerDocument === \"object\") {\n      passed = true;\n    }\n  } catch (_) {\n    // we don't have an element\n  }\n  return passed;\n}\nexport function getFunctionName(\n// eslint-disable-next-line @typescript-eslint/ban-types\nfn) {\n  // @ts-expect-error __name__ and displayName are not properties of Functions\n  return fn.name || fn.__name__ || fn.displayName || \"anonymous\";\n}\nexport function setFunctionName(\n// eslint-disable-next-line @typescript-eslint/ban-types\nfn, name) {\n  try {\n    // @ts-expect-error function.name is readonly\n    delete fn.name;\n    // @ts-expect-error function.name is readonly\n    fn.name = name;\n  } catch (err) {\n    // pass\n  }\n\n  // @ts-expect-error function.__name__ is not real outside belter\n  fn.__name__ = fn.displayName = name;\n  return fn;\n}\nexport function base64encode(str) {\n  if (typeof btoa === \"function\") {\n    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (_m, p1) {\n      return String.fromCharCode(parseInt(p1, 16));\n    })).replace(/[=]/g, \"\");\n  }\n  if (typeof Buffer !== \"undefined\") {\n    return Buffer.from(str, \"utf8\").toString(\"base64\").replace(/[=]/g, \"\");\n  }\n  throw new Error(\"Can not find window.btoa or Buffer\");\n}\nexport function base64decode(str) {\n  if (typeof atob === \"function\") {\n    return decodeURIComponent(Array.prototype.map.call(atob(str), function (c) {\n      // eslint-disable-next-line prefer-template, @typescript-eslint/restrict-plus-operands\n      return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(\"\"));\n  }\n  if (typeof Buffer !== \"undefined\") {\n    return Buffer.from(str, \"base64\").toString(\"utf8\");\n  }\n  throw new Error(\"Can not find window.atob or Buffer\");\n}\nexport function uniqueID() {\n  var chars = \"0123456789abcdef\";\n  var randomID = \"xxxxxxxxxx\".replace(/./g, function () {\n    return chars.charAt(Math.floor(Math.random() * chars.length));\n  });\n  var timeID = base64encode(new Date().toISOString().slice(11, 19).replace(\"T\", \".\")).replace(/[^a-zA-Z0-9]/g, \"\").toLowerCase();\n  return \"uid_\" + randomID + \"_\" + timeID;\n}\nexport function getGlobal() {\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n\n  // @ts-expect-error usage of global\n  if (typeof __GLOBAL__ !== \"undefined\") {\n    // @ts-expect-error usage of global\n    // eslint-disable-next-line no-undef\n    return __GLOBAL__;\n  }\n  throw new Error(\"No global found\");\n}\nvar objectIDs;\nexport function getObjectID(obj) {\n  objectIDs = objectIDs || new WeakMap();\n  if (obj === null || obj === undefined || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    throw new Error(\"Invalid object\");\n  }\n  var uid = objectIDs.get(obj);\n  if (!uid) {\n    uid = typeof obj + \":\" + uniqueID();\n    objectIDs.set(obj, uid);\n  }\n  return uid;\n}\nfunction serializeArgs(args) {\n  try {\n    return JSON.stringify(Array.prototype.slice.call(args), function (_subkey, val) {\n      // Treat each distinct function as unique for purposes of memoization\n      // e.g. even if someFunction.stringify() is the same, we may use a different memoize cache\n      // if the actual function is different.\n      if (typeof val === \"function\") {\n        return \"memoize[\" + getObjectID(val) + \"]\";\n      }\n\n      // By default JSON.stringify(domElement) returns '{}'. This ensures that stays true even for non-standard\n      // elements (e.g. React-rendered dom elements) with custom properties\n      if (isElement(val)) {\n        return {};\n      }\n      return val;\n    });\n  } catch (err) {\n    throw new Error(\"Arguments not serializable -- can not be used to memoize\");\n  }\n}\nvar getDefaultMemoizeOptions = function getDefaultMemoizeOptions() {\n  return {};\n};\nvar memoizeGlobalIndex = 0;\nvar memoizeGlobalIndexValidFrom = 0;\nexport function memoize(method, options) {\n  if (options === void 0) {\n    options = getDefaultMemoizeOptions();\n  }\n  var _options = options,\n    _options$thisNamespac = _options.thisNamespace,\n    thisNamespace = _options$thisNamespac === void 0 ? false : _options$thisNamespac,\n    cacheTime = _options.time;\n  var simpleCache;\n  var thisCache;\n  var memoizeIndex = memoizeGlobalIndex;\n  memoizeGlobalIndex += 1;\n  var memoizedFunction = function memoizedFunction() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    if (memoizeIndex < memoizeGlobalIndexValidFrom) {\n      simpleCache = null;\n      thisCache = null;\n      memoizeIndex = memoizeGlobalIndex;\n      memoizeGlobalIndex += 1;\n    }\n    var cache;\n    if (thisNamespace) {\n      thisCache = thisCache || new WeakMap();\n      // @ts-expect-error this\n      cache = thisCache.getOrSet(this, getEmptyObject);\n    } else {\n      cache = simpleCache = simpleCache || {};\n    }\n    var cacheKey;\n    try {\n      cacheKey = serializeArgs(args);\n    } catch (_unused) {\n      // @ts-expect-error use rest parameter over arguments\n      // eslint-disable-next-line prefer-rest-params\n      return method.apply(this, arguments);\n    }\n\n    // @ts-expect-error need to use a generic for cache later\n    var cacheResult = cache[cacheKey];\n    if (cacheResult && cacheTime && Date.now() - cacheResult.time < cacheTime) {\n      // @ts-expect-error need to use a generic for cache later\n      delete cache[cacheKey];\n      cacheResult = null;\n    }\n    if (cacheResult) {\n      return cacheResult.value;\n    }\n    var time = Date.now();\n    // @ts-expect-error use rest parameter over arguments\n    // eslint-disable-next-line prefer-rest-params\n    var value = method.apply(this, arguments);\n    // @ts-expect-error need to use a generic for cache later\n    cache[cacheKey] = {\n      time: time,\n      value: value\n    };\n    return value;\n  };\n  memoizedFunction.reset = function () {\n    simpleCache = null;\n    thisCache = null;\n  };\n  var result = memoizedFunction;\n  // @ts-expect-error memoized function vs function\n  return setFunctionName(result, (options.name || getFunctionName(method)) + \"::memoized\");\n}\nmemoize.clear = function () {\n  memoizeGlobalIndexValidFrom = memoizeGlobalIndex;\n};\nexport function promiseIdentity(item) {\n  return ZalgoPromise.resolve(item);\n}\nexport function memoizePromise(method) {\n  var cache = {};\n  function memoizedPromiseFunction() {\n    var _arguments = arguments,\n      _this = this;\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    var key = serializeArgs(args);\n    if (cache.hasOwnProperty(key)) {\n      // @ts-expect-error need to use a generic for cache later\n      return cache[key];\n    }\n\n    // @ts-expect-error this line just has all sorts of problems\n    // eslint-disable-next-line prefer-rest-params\n    cache[key] = ZalgoPromise.try(function () {\n      return method.apply(_this, _arguments);\n    }).finally(function () {\n      // @ts-expect-error need to use a generic for cache later\n      delete cache[key];\n    });\n\n    // @ts-expect-error need to use a generic for cache later\n    return cache[key];\n  }\n  memoizedPromiseFunction.reset = function () {\n    cache = {};\n  };\n\n  // @ts-expect-error function vs memoized function\n  return setFunctionName(memoizedPromiseFunction, getFunctionName(method) + \"::promiseMemoized\");\n}\nvar getDefaultPromisifyOptions = function getDefaultPromisifyOptions() {\n  return {};\n};\nexport function promisify(method, options) {\n  if (options === void 0) {\n    options = getDefaultPromisifyOptions();\n  }\n  function promisifiedFunction() {\n    // @ts-expect-error use rest parameter over arguments also something with this\n    // eslint-disable-next-line prefer-rest-params\n    return ZalgoPromise.try(method, this, arguments);\n  }\n  if (options.name) {\n    promisifiedFunction.displayName = options.name + \":promisified\";\n  }\n\n  // @ts-expect-error function vs memoized function\n  return setFunctionName(promisifiedFunction, getFunctionName(method) + \"::promisified\");\n}\nexport function inlineMemoize(\n// eslint-disable-next-line @typescript-eslint/no-shadow\nmethod,\n// eslint-disable-next-line @typescript-eslint/no-shadow\nlogic, args) {\n  if (args === void 0) {\n    args = [];\n  }\n  // @ts-expect-error __inline_memoize_cache__ does not exist\n  var cache = method.__inline_memoize_cache__ =\n  // @ts-expect-error __inline_memoize_cache__ does not exist\n  method.__inline_memoize_cache__ || {};\n  var key = serializeArgs(args);\n  if (cache.hasOwnProperty(key)) {\n    return cache[key];\n  }\n  var result = cache[key] = logic.apply(void 0, args);\n  return result;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function noop() {\n  // pass\n}\nexport function once(method) {\n  var called = false;\n  var onceFunction = function onceFunction() {\n    if (!called) {\n      called = true;\n      // @ts-expect-error use rest parameter over arguments\n      // eslint-disable-next-line prefer-rest-params\n      return method.apply(this, arguments);\n    }\n  };\n\n  // @ts-expect-error function vs memoized function\n  return setFunctionName(onceFunction, getFunctionName(method) + \"::once\");\n}\nexport function hashStr(str) {\n  var hash = 0;\n  for (var i = 0; i < str.length; i++) {\n    hash += str[i].charCodeAt(0) * Math.pow(i % 10 + 1, 5);\n  }\n  return Math.floor(Math.pow(Math.sqrt(hash), 5));\n}\nexport function strHashStr(str) {\n  var hash = \"\";\n  for (var i = 0; i < str.length; i++) {\n    var total = str[i].charCodeAt(0) * i;\n    if (str[i + 1]) {\n      total += str[i + 1].charCodeAt(0) * (i - 1);\n    }\n    hash += String.fromCharCode(97 + Math.abs(total) % 26);\n  }\n  return hash;\n}\nexport function match(str, pattern) {\n  var regmatch = str.match(pattern);\n  if (regmatch) {\n    return regmatch[1];\n  }\n}\nexport function awaitKey(obj, key) {\n  return new ZalgoPromise(function (resolve) {\n    var value = obj[key];\n    if (value) {\n      resolve(value);\n      return;\n    }\n    delete obj[key];\n    Object.defineProperty(obj, key, {\n      configurable: true,\n      set: function set(item) {\n        value = item;\n        if (value) {\n          resolve(value);\n        }\n      },\n      get: function get() {\n        return value;\n      }\n    });\n  });\n}\nexport function stringifyError(err, level) {\n  if (level === void 0) {\n    level = 1;\n  }\n  if (level >= 3) {\n    return \"stringifyError stack overflow\";\n  }\n  try {\n    if (!err) {\n      return \"<unknown error: \" + Object.prototype.toString.call(err) + \">\";\n    }\n    if (typeof err === \"string\") {\n      return err;\n    }\n    if (err instanceof Error) {\n      var stack = err && err.stack;\n      var message = err && err.message;\n      if (stack && message) {\n        if (stack.includes(message)) {\n          return stack;\n        } else {\n          return message + \"\\n\" + stack;\n        }\n      } else if (stack) {\n        return stack;\n      } else if (message) {\n        return message;\n      }\n    }\n    if (err && err.toString && typeof err.toString === \"function\") {\n      // stringify of err will be [object Object]\n      // eslint-disable-next-line  @typescript-eslint/no-base-to-string\n      return err.toString();\n    }\n    return Object.prototype.toString.call(err);\n  } catch (newErr) {\n    return \"Error while stringifying error: \" + stringifyError(newErr, level + 1);\n  }\n}\nexport function stringifyErrorMessage(err) {\n  var defaultMessage = \"<unknown error: \" + Object.prototype.toString.call(err) + \">\";\n  if (!err) {\n    return defaultMessage;\n  }\n  if (err instanceof Error) {\n    return err.message || defaultMessage;\n  }\n  if (typeof err.message === \"string\") {\n    return err.message || defaultMessage;\n  }\n  return defaultMessage;\n}\nexport function stringify(item) {\n  if (typeof item === \"string\") {\n    return item;\n  }\n  if (item && item.toString && typeof item.toString === \"function\") {\n    // stringify of item will be [object Object]\n    // eslint-disable-next-line @typescript-eslint/no-base-to-string\n    return item.toString();\n  }\n  return Object.prototype.toString.call(item);\n}\nexport function domainMatches(hostname, domain) {\n  hostname = hostname.split(\"://\")[1];\n  var index = hostname.indexOf(domain);\n  return index !== -1 && hostname.slice(index) === domain;\n}\nexport function patchMethod(obj, name, handler) {\n  var original = obj[name];\n  obj[name] = function patchedMethod() {\n    var _arguments2 = arguments,\n      _this2 = this;\n    return handler({\n      context: this,\n      // eslint-disable-next-line prefer-rest-params\n      args: Array.prototype.slice.call(arguments),\n      original: original,\n      // @ts-expect-error arguments in an arrow function\n      // eslint-disable-next-line prefer-rest-params\n      callOriginal: function callOriginal() {\n        return original.apply(_this2, _arguments2);\n      }\n    });\n  };\n}\nexport function extend(obj, source) {\n  if (!source) {\n    return obj;\n  }\n  if (Object.assign) {\n    return Object.assign(obj, source);\n  }\n  for (var key in source) {\n    if (source.hasOwnProperty(key)) {\n      // @ts-expect-error need to use a generic for cache later\n      obj[key] = source[key];\n    }\n  }\n  return obj;\n}\nexport function values(obj) {\n  if (Object.values) {\n    return Object.values(obj);\n  }\n  var result = [];\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      result.push(obj[key]);\n    }\n  }\n  return result;\n}\nexport var memoizedValues = memoize(values);\nexport function perc(pixels, percentage) {\n  return Math.round(pixels * percentage / 100);\n}\nexport function min() {\n  return Math.min.apply(Math, arguments);\n}\nexport function max() {\n  return Math.max.apply(Math, arguments);\n}\nexport function roundUp(num, nearest) {\n  var remainder = num % nearest;\n  return remainder ? num - remainder + nearest : num;\n}\nexport function regexMap(str, regexp, handler) {\n  var results = [];\n  // @ts-expect-error no overload matches the cal of regexMapMatcher\n  str.replace(regexp, function regexMapMatcher(item) {\n    // @ts-expect-error use rest parameter over arguments\n    // eslint-disable-next-line\n    results.push(handler ? handler.apply(null, arguments) : item);\n  });\n\n  // @ts-expect-error results doesnt match return value\n  return results;\n}\nexport function svgToBase64(svg) {\n  return \"data:image/svg+xml;base64,\" + base64encode(svg);\n}\nexport function objFilter(obj, filter) {\n  if (filter === void 0) {\n    filter = Boolean;\n  }\n  var result = {};\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key) || !filter(obj[key], key)) {\n      continue;\n    }\n\n    // @ts-expect-error string indexer\n    result[key] = obj[key];\n  }\n  return result;\n}\nexport function identity(item) {\n  return item;\n}\nexport function regexTokenize(text, regexp) {\n  var result = [];\n  text.replace(regexp, function (token) {\n    result.push(token);\n    return \"\";\n  });\n  return result;\n}\nexport function promiseDebounce(method, delay) {\n  if (delay === void 0) {\n    delay = 50;\n  }\n  var promise;\n  // eslint-disable-next-line no-undef\n  var timeout;\n  var promiseDebounced = function promiseDebounced() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    var localPromise = promise = promise || new ZalgoPromise();\n    timeout = setTimeout(function () {\n      promise = null;\n      timeout = null;\n      ZalgoPromise.try(method).then(function (result) {\n        // @ts-expect-error T or ZalgoPromise<T> when T has no resolve\n        void localPromise.resolve(result);\n      }, function (err) {\n        void localPromise.reject(err);\n      });\n    }, delay);\n    return localPromise;\n  };\n\n  // @ts-expect-error function vs memoized function\n  return setFunctionName(promiseDebounced, getFunctionName(method) + \"::promiseDebounced\");\n}\nexport function safeInterval(method, time) {\n  // eslint-disable-next-line no-undef\n  var timeout;\n  function loop() {\n    timeout = setTimeout(function () {\n      method();\n      loop();\n    }, time);\n  }\n  loop();\n  return {\n    cancel: function cancel() {\n      clearTimeout(timeout);\n    }\n  };\n}\nexport function isInteger(str) {\n  return Boolean(/^[0-9]+$/.exec(str));\n}\nexport function isFloat(str) {\n  return Boolean(/^[0-9]+\\.[0-9]+$/.exec(str));\n}\nexport function serializePrimitive(value) {\n  return value.toString();\n}\nexport function deserializePrimitive(value) {\n  if (value === \"true\") {\n    return true;\n  } else if (value === \"false\") {\n    return false;\n  } else if (isInteger(value)) {\n    return parseInt(value, 10);\n  } else if (isFloat(value)) {\n    return parseFloat(value);\n  } else {\n    return value;\n  }\n}\nexport function dotify(obj, prefix, newobj) {\n  if (prefix === void 0) {\n    prefix = \"\";\n  }\n  if (newobj === void 0) {\n    newobj = {};\n  }\n  prefix = prefix ? prefix + \".\" : prefix;\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key) || obj[key] === undefined || obj[key] === null || typeof obj[key] === \"function\") {\n      continue;\n    } else if (obj[key] && Array.isArray(obj[key]) && obj[key].length && obj[key].every(function (val) {\n      return typeof val !== \"object\";\n    })) {\n      newobj[\"\" + prefix + key + \"[]\"] = obj[key].join(\",\");\n    } else if (obj[key] && typeof obj[key] === \"object\") {\n      newobj = dotify(obj[key], \"\" + prefix + key, newobj);\n    } else {\n      newobj[\"\" + prefix + key] = serializePrimitive(obj[key]);\n    }\n  }\n  return newobj;\n}\nexport function undotify(obj) {\n  var result = {};\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key) || typeof obj[key] !== \"string\") {\n      continue;\n    }\n    var value = obj[key];\n    if (/^.+\\[\\]$/.exec(key)) {\n      key = key.slice(0, -2);\n      // @ts-expect-error unknown type split\n      value = value.split(\",\").map(deserializePrimitive);\n    } else {\n      // @ts-expect-error unknown type\n      value = deserializePrimitive(value);\n    }\n    var keyResult = result;\n    var parts = key.split(\".\");\n    for (var i = 0; i < parts.length; i++) {\n      var part = parts[i];\n      var isLast = i + 1 === parts.length;\n      var isIndex = !isLast && isInteger(parts[i + 1]);\n      if (part === \"constructor\" || part === \"prototype\" || part === \"__proto__\") {\n        throw new Error(\"Disallowed key: \" + part);\n      }\n      if (isLast) {\n        // @ts-expect-error string indexer\n        keyResult[part] = value;\n      } else {\n        // @ts-expect-error string indexer\n        keyResult = keyResult[part] = keyResult[part] || (isIndex ? [] : {});\n      }\n    }\n  }\n  return result;\n}\nexport function eventEmitter() {\n  var triggered = {};\n  var handlers = {};\n  var emitter = {\n    on: function on(eventName, handler) {\n      // @ts-expect-error string index\n      var handlerList = handlers[eventName] = handlers[eventName] || [];\n      handlerList.push(handler);\n      var cancelled = false;\n      return {\n        cancel: function cancel() {\n          if (!cancelled) {\n            cancelled = true;\n            handlerList.splice(handlerList.indexOf(handler), 1);\n          }\n        }\n      };\n    },\n    once: function once(eventName, handler) {\n      var listener = emitter.on(eventName, function () {\n        listener.cancel();\n        handler();\n      });\n      return listener;\n    },\n    trigger: function trigger(eventName) {\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n      // @ts-expect-error string index\n      var handlerList = handlers[eventName];\n      var promises = [];\n      if (handlerList) {\n        var _loop = function _loop(_i2) {\n          var handler = handlerList[_i2];\n          promises.push(ZalgoPromise.try(function () {\n            return handler.apply(void 0, args);\n          }));\n        };\n        for (var _i2 = 0; _i2 < handlerList.length; _i2++) {\n          _loop(_i2);\n        }\n      }\n      return ZalgoPromise.all(promises).then(noop);\n    },\n    triggerOnce: function triggerOnce(eventName) {\n      // @ts-expect-error string index\n      if (triggered[eventName]) {\n        return ZalgoPromise.resolve();\n      }\n\n      // @ts-expect-error string index\n      triggered[eventName] = true;\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      return emitter.trigger.apply(emitter, [eventName].concat(args));\n    },\n    reset: function reset() {\n      handlers = {};\n    }\n  };\n  return emitter;\n}\nexport function camelToDasherize(string) {\n  return string.replace(/([A-Z])/g, function (g) {\n    return \"-\" + g.toLowerCase();\n  });\n}\nexport function dasherizeToCamel(string) {\n  return string.replace(/-([a-z])/g, function (g) {\n    return g[1].toUpperCase();\n  });\n}\nexport function capitalizeFirstLetter(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}\nexport function get(item, path, def) {\n  if (!path) {\n    return def;\n  }\n  var pathParts = path.split(\".\");\n\n  // Loop through each section of our key path\n  for (var i = 0; i < pathParts.length; i++) {\n    // If we have an object, we can get the key\n    if (typeof item === \"object\" && item !== null) {\n      item = item[pathParts[i]]; // Otherwise, we should return the default (undefined if not provided)\n    } else {\n      return def;\n    }\n  }\n\n  // If our final result is undefined, we should return the default\n  return item === undefined ? def : item;\n}\nexport function safeTimeout(method, time) {\n  var interval = safeInterval(function () {\n    time -= 100;\n    if (time <= 0) {\n      interval.cancel();\n      method();\n    }\n  }, 100);\n}\nexport function defineLazyProp(obj, key, getter) {\n  if (Array.isArray(obj)) {\n    if (typeof key !== \"number\") {\n      throw new TypeError(\"Array key must be number\");\n    }\n  } else if (typeof obj === \"object\" && obj !== null) {\n    if (typeof key !== \"string\") {\n      throw new TypeError(\"Object key must be string\");\n    }\n  }\n  Object.defineProperty(obj, key, {\n    configurable: true,\n    enumerable: true,\n    get: function get() {\n      // @ts-expect-error delete on a dynamic key\n      delete obj[key];\n      var value = getter();\n      // @ts-expect-error string indexer\n      obj[key] = value;\n      return value;\n    },\n    set: function set(value) {\n      // @ts-expect-error delete on a dynamic key\n      delete obj[key];\n      // @ts-expect-error string indexer\n      obj[key] = value;\n    }\n  });\n}\nexport function arrayFrom(item) {\n  return Array.prototype.slice.call(item);\n}\nexport function isObject(item) {\n  return typeof item === \"object\" && item !== null;\n}\nexport function isObjectObject(obj) {\n  return isObject(obj) && Object.prototype.toString.call(obj) === \"[object Object]\";\n}\nexport function isPlainObject(obj) {\n  if (!isObjectObject(obj)) {\n    return false;\n  }\n\n  // @ts-expect-error obj is unknown\n  var constructor = obj.constructor;\n  if (typeof constructor !== \"function\") {\n    return false;\n  }\n  var prototype = constructor.prototype;\n  if (!isObjectObject(prototype)) {\n    return false;\n  }\n  if (!prototype.hasOwnProperty(\"isPrototypeOf\")) {\n    return false;\n  }\n  return true;\n}\nexport function replaceObject(item, replacer, fullKey) {\n  if (fullKey === void 0) {\n    fullKey = \"\";\n  }\n  if (Array.isArray(item)) {\n    var length = item.length;\n    var result = [];\n    var _loop2 = function _loop2(i) {\n      defineLazyProp(result, i, function () {\n        var itemKey = fullKey ? fullKey + \".\" + i : \"\" + i;\n        var el = item[i];\n        var child = replacer(el, i, itemKey);\n        if (isPlainObject(child) || Array.isArray(child)) {\n          // @ts-expect-error  child is unknown type\n          child = replaceObject(child, replacer, itemKey);\n        }\n        return child;\n      });\n    };\n    for (var i = 0; i < length; i++) {\n      _loop2(i);\n    }\n\n    // @ts-expect-error unknown[] is not assignable to T\n    return result;\n  } else if (isPlainObject(item)) {\n    var _result = {};\n    var _loop3 = function _loop3(key) {\n      if (!item.hasOwnProperty(key)) {\n        return \"continue\";\n      }\n      defineLazyProp(_result, key, function () {\n        var itemKey = fullKey ? fullKey + \".\" + key : \"\" + key;\n        var el = item[key];\n        var child = replacer(el, key, itemKey);\n        if (isPlainObject(child) || Array.isArray(child)) {\n          // @ts-expect-error child is unknown type\n          child = replaceObject(child, replacer, itemKey);\n        }\n        return child;\n      });\n    };\n    for (var key in item) {\n      var _ret = _loop3(key);\n      if (_ret === \"continue\") continue;\n    }\n\n    // @ts-expect-error unknown[] is not assignable to T\n    return _result;\n  } else {\n    throw new Error(\"Pass an object or array\");\n  }\n}\nexport function copyProp(source, target, name, def) {\n  if (source.hasOwnProperty(name)) {\n    var descriptor = Object.getOwnPropertyDescriptor(source, name);\n    // @ts-expect-error - Type 'undefined' is not assignable to type 'PropertyDescriptor'\n    Object.defineProperty(target, name, descriptor);\n  } else {\n    target[name] = def;\n  }\n}\nexport function regex(pattern, string, start) {\n  if (start === void 0) {\n    start = 0;\n  }\n  if (typeof pattern === \"string\") {\n    // eslint-disable-next-line security/detect-non-literal-regexp\n    pattern = new RegExp(pattern);\n  }\n  var result = string.slice(start).match(pattern);\n  if (!result || result.index === undefined) {\n    return;\n  }\n  var index = result.index;\n  var regmatch = result[0];\n  return {\n    text: regmatch,\n    groups: result.slice(1),\n    start: start + index,\n    end: start + index + regmatch.length,\n    length: regmatch.length,\n    replace: function replace(text) {\n      if (!regmatch) {\n        return \"\";\n      }\n      return \"\" + regmatch.slice(0, start + index) + text + regmatch.slice(index + regmatch.length);\n    }\n  };\n}\nexport function regexAll(pattern, string) {\n  var matches = [];\n  var start = 0;\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    var regmatch = regex(pattern, string, start);\n    if (!regmatch) {\n      break;\n    }\n    matches.push(regmatch);\n    // @ts-expect-error end does not exist on match\n    start = match.end;\n  }\n  return matches;\n}\nexport function isDefined(value) {\n  return value !== null && value !== undefined;\n}\nexport function cycle(method) {\n  return ZalgoPromise.try(method).then(function () {\n    return cycle(method);\n  });\n}\nexport function debounce(method, time) {\n  if (time === void 0) {\n    time = 100;\n  }\n  // eslint-disable-next-line no-undef\n  var timeout;\n  var debounceWrapper = function debounceWrapper() {\n    var _arguments3 = arguments,\n      _this3 = this;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      // @ts-expect-error use rest parameter over arguments\n      // eslint-disable-next-line\n      return method.apply(_this3, _arguments3);\n    }, time);\n  };\n\n  // @ts-expect-error this is a problematic helper\n  return setFunctionName(debounceWrapper, getFunctionName(method) + \"::debounced\");\n}\nexport function isRegex(item) {\n  return Object.prototype.toString.call(item) === \"[object RegExp]\";\n}\nexport var weakMapMemoize = function weakMapMemoize(method) {\n  var weakmap = new WeakMap();\n  return function weakmapMemoized(arg) {\n    var _this4 = this;\n    // @ts-expect-error unknown is not assignable to R\n    return weakmap.getOrSet(arg, function () {\n      return method.call(_this4, arg);\n    });\n  };\n};\nexport var weakMapMemoizePromise = function weakMapMemoizePromise(method) {\n  var weakmap = new WeakMap();\n  return function weakmapMemoizedPromise(arg) {\n    var _this5 = this;\n    // @ts-expect-error unknown is not assignable to ZalgoPromise<R>\n    return weakmap.getOrSet(arg, function () {\n      return (\n        // @ts-expect-error this has no type annotation\n        method.call(_this5, arg).finally(function () {\n          weakmap.delete(arg);\n        })\n      );\n    });\n  };\n};\nexport function getOrSet(obj, key, getter) {\n  if (obj.hasOwnProperty(key)) {\n    return obj[key];\n  }\n  var val = getter();\n  // @ts-expect-error string indexer\n  obj[key] = val;\n  return val;\n}\nexport function cleanup(obj) {\n  var tasks = [];\n  var cleaned = false;\n  var cleanErr;\n  var cleaner = {\n    set: function set(name, item) {\n      if (!cleaned) {\n        obj[name] = item;\n        cleaner.register(function () {\n          delete obj[name];\n        });\n      }\n      return item;\n    },\n    register: function register(method) {\n      var task = once(function () {\n        return method(cleanErr);\n      });\n      if (cleaned) {\n        method(cleanErr);\n      } else {\n        tasks.push(task);\n      }\n      return {\n        cancel: function cancel() {\n          var index = tasks.indexOf(task);\n          if (index !== -1) {\n            tasks.splice(index, 1);\n          }\n        }\n      };\n    },\n    all: function all(err) {\n      cleanErr = err;\n      var results = [];\n      cleaned = true;\n      while (tasks.length) {\n        var task = tasks.shift();\n        // @ts-expect-error - shift is possible to be undefined\n        results.push(task());\n      }\n      return ZalgoPromise.all(results).then(noop);\n    }\n  };\n  return cleaner;\n}\nexport function tryCatch(fn) {\n  var result;\n  var error;\n  try {\n    result = fn();\n  } catch (err) {\n    error = err;\n  }\n  return {\n    result: result,\n    error: error\n  };\n}\nexport function removeFromArray(arr, item) {\n  var index = arr.indexOf(item);\n  if (index !== -1) {\n    arr.splice(index, 1);\n  }\n}\nexport function assertExists(name, thing) {\n  if (thing === null || typeof thing === \"undefined\") {\n    throw new Error(\"Expected \" + name + \" to be present\");\n  }\n  return thing;\n}\nexport function unique(arr) {\n  var result = {};\n  for (var _i4 = 0; _i4 < arr.length; _i4++) {\n    var item = arr[_i4];\n    result[item] = true;\n  }\n  return Object.keys(result);\n}\nexport var constHas = function constHas(constant, value) {\n  return memoizedValues(constant).includes(value);\n};\nexport function dedupeErrors(handler) {\n  var seenErrors = [];\n  var seenStringifiedErrors = {};\n  return function (err) {\n    if (seenErrors.includes(err)) {\n      return;\n    }\n    seenErrors.push(err);\n    var stringifiedError = stringifyError(err);\n\n    // @ts-expect-error string key\n    if (seenStringifiedErrors[stringifiedError]) {\n      return;\n    }\n\n    // @ts-expect-error string key\n    seenStringifiedErrors[stringifiedError] = true;\n    return handler(err);\n  };\n}\nexport var ExtendableError = /*#__PURE__*/function (_Error) {\n  _inheritsLoose(ExtendableError, _Error);\n  function ExtendableError(message) {\n    var _this6;\n    _this6 = _Error.call(this, message) || this;\n    _this6.name = _this6.constructor.name;\n    if (typeof Error.captureStackTrace === \"function\") {\n      Error.captureStackTrace(_assertThisInitialized(_this6), _this6.constructor);\n    } else {\n      _this6.stack = new Error(message).stack;\n    }\n    return _this6;\n  }\n  return ExtendableError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));","export function hasNativeWeakMap() {\n  if (typeof WeakMap === \"undefined\") {\n    return false;\n  }\n  if (typeof Object.freeze === \"undefined\") {\n    return false;\n  }\n  try {\n    var testWeakMap = new WeakMap();\n    var testKey = {};\n    var testValue = \"__testvalue__\";\n    Object.freeze(testKey);\n    testWeakMap.set(testKey, testValue);\n    if (testWeakMap.get(testKey) === testValue) {\n      return true;\n    }\n    return false;\n  } catch (err) {\n    return false;\n  }\n}","import type {\n  CrossDomainWindowType,\n  SameDomainWindowType,\n} from \"@krakenjs/cross-domain-utils\";\nimport \"@krakenjs/cross-domain-utils\";\nimport { WeakMap } from \"@krakenjs/cross-domain-safe-weakmap\";\nimport { getOrSet, getCurrentScriptUID } from \"@krakenjs/belter\";\nexport function getGlobalKey(): string {\n  if (__POST_ROBOT__.__SCRIPT_NAMESPACE__) {\n    return `${__POST_ROBOT__.__GLOBAL_KEY__}_${getCurrentScriptUID()}`;\n  } else {\n    return __POST_ROBOT__.__GLOBAL_KEY__;\n  }\n}\n\nexport function getGlobal(\n  win: SameDomainWindowType = window\n): Record<string, any> {\n  const globalKey = getGlobalKey();\n\n  if (win !== window) {\n    return win[globalKey];\n  }\n\n  const global: Record<string, any> = (win[globalKey] = win[globalKey] || {});\n  return global;\n}\n\nexport function deleteGlobal() {\n  const globalKey = getGlobalKey();\n  delete window[globalKey];\n}\n\ntype ObjectGetter = () => Record<string, any>;\n\nconst getObj: ObjectGetter = () => ({});\n\ntype GetOrSet<T> = ((arg0: string, arg1: () => T) => T) &\n  ((arg0: string, arg1: () => void) => void);\ntype GlobalStore<T> = {\n  get: ((arg0: string, arg1: T) => T) &\n    ((arg0: string, arg1: void) => T | void);\n  set: (arg0: string, arg1: T) => T;\n  has: (arg0: string) => boolean;\n  del: (arg0: string) => void;\n  getOrSet: GetOrSet<T>;\n  reset: () => void;\n  keys: () => readonly string[];\n};\nexport function globalStore<T extends unknown>(\n  key = \"store\",\n  defStore: ObjectGetter = getObj\n): GlobalStore<T> {\n  return getOrSet(getGlobal(), key, () => {\n    let store = defStore();\n    return {\n      has: (storeKey) => {\n        return store.hasOwnProperty(storeKey);\n      },\n      get: (storeKey, defVal) => {\n        // $FlowFixMe\n        return store.hasOwnProperty(storeKey) ? store[storeKey] : defVal;\n      },\n      set: (storeKey, val) => {\n        store[storeKey] = val;\n        return val;\n      },\n      del: (storeKey) => {\n        delete store[storeKey];\n      },\n      getOrSet: (storeKey, getter) => {\n        // $FlowFixMe\n        return getOrSet(store, storeKey, getter);\n      },\n      reset: () => {\n        store = defStore();\n      },\n      keys: () => {\n        return Object.keys(store);\n      },\n    };\n  });\n}\n\nexport class WildCard {}\nexport function getWildcard(): WildCard {\n  const global = getGlobal();\n  global.WINDOW_WILDCARD = global.WINDOW_WILDCARD || new WildCard();\n  return global.WINDOW_WILDCARD;\n}\n\ntype WindowStore<T> = {\n  get: ((arg0: CrossDomainWindowType | WildCard, arg1: T) => T) &\n    ((arg0: CrossDomainWindowType | WildCard, arg1: void) => T | void);\n  set: (arg0: CrossDomainWindowType | WildCard, arg1: T) => T;\n  has: (arg0: CrossDomainWindowType | WildCard) => boolean;\n  del: (arg0: CrossDomainWindowType | WildCard) => void;\n  getOrSet: (arg0: CrossDomainWindowType | WildCard, arg1: () => T) => T;\n};\nexport function windowStore<T>(\n  key = \"store\",\n  defStore: ObjectGetter = getObj\n): WindowStore<T> {\n  return globalStore(\"windowStore\").getOrSet(key, () => {\n    const winStore = new WeakMap();\n\n    const getStore = (win: CrossDomainWindowType | WildCard): ObjectGetter => {\n      return winStore.getOrSet(win, defStore);\n    };\n\n    return {\n      has: (win) => {\n        const store = getStore(win);\n        return store.hasOwnProperty(key);\n      },\n      get: (win, defVal) => {\n        const store = getStore(win);\n        // $FlowFixMe\n        return store.hasOwnProperty(key) ? store[key] : defVal;\n      },\n      set: (win, val) => {\n        const store = getStore(win);\n        store[key] = val;\n        return val;\n      },\n      del: (win) => {\n        const store = getStore(win);\n        delete store[key];\n      },\n      getOrSet: (win, getter) => {\n        const store = getStore(win);\n        return getOrSet(store, key, getter);\n      },\n    };\n  });\n}\n","import type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport { getAncestor } from \"@krakenjs/cross-domain-utils\";\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { uniqueID } from \"@krakenjs/belter\";\nimport { MESSAGE_NAME, WILDCARD } from \"../conf\";\nimport { windowStore, globalStore, getGlobal } from \"../global\";\nimport type { OnType, SendType, CancelableType } from \"../types\";\n\nfunction getInstanceID(): string {\n  return globalStore(\"instance\").getOrSet(\"instanceID\", uniqueID);\n}\n\nfunction getHelloPromise(win: CrossDomainWindowType): ZalgoPromise<{\n  domain: string;\n}> {\n  const helloPromises = windowStore(\"helloPromises\");\n  return helloPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nfunction resolveHelloPromise(\n  win: CrossDomainWindowType,\n  { domain }\n): ZalgoPromise<{\n  domain: string;\n}> {\n  const helloPromises = windowStore(\"helloPromises\");\n  const existingPromise = helloPromises.get(win);\n\n  if (existingPromise) {\n    existingPromise.resolve({\n      domain,\n    });\n  }\n\n  const newPromise = ZalgoPromise.resolve({\n    domain,\n  });\n  helloPromises.set(win, newPromise);\n  return newPromise;\n}\n\nfunction listenForHello({ on }: { on: OnType }): CancelableType {\n  return on(\n    MESSAGE_NAME.HELLO,\n    {\n      domain: WILDCARD,\n    },\n    ({ source, origin }) => {\n      resolveHelloPromise(source, {\n        domain: origin,\n      });\n      return {\n        instanceID: getInstanceID(),\n      };\n    }\n  );\n}\n\nexport function sayHello(\n  win: CrossDomainWindowType,\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): ZalgoPromise<{\n  win: CrossDomainWindowType;\n  domain: string;\n  instanceID: string;\n}> {\n  return send(\n    win,\n    MESSAGE_NAME.HELLO,\n    {\n      instanceID: getInstanceID(),\n    },\n    {\n      domain: WILDCARD,\n      timeout: -1,\n    }\n  ).then(({ origin, data: { instanceID } }) => {\n    resolveHelloPromise(win, {\n      domain: origin,\n    });\n    return {\n      win,\n      domain: origin,\n      instanceID,\n    };\n  });\n}\n\nexport function getWindowInstanceID(\n  win: CrossDomainWindowType,\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): ZalgoPromise<string> {\n  return windowStore(\"windowInstanceIDPromises\").getOrSet(win, () => {\n    return sayHello(win, {\n      send,\n    }).then(({ instanceID }) => instanceID);\n  });\n}\n\nexport function initHello({\n  on,\n  send,\n}: {\n  on: OnType;\n  send: SendType;\n}): CancelableType {\n  return globalStore(\"builtinListeners\").getOrSet(\"helloListener\", () => {\n    const listener = listenForHello({\n      on,\n    });\n    const parent = getAncestor();\n\n    if (parent) {\n      sayHello(parent, {\n        send,\n      }).catch((err) => {\n        // $FlowFixMe\n        if (__TEST__ && getGlobal(parent)) {\n          throw err;\n        }\n      });\n    }\n\n    return listener;\n  });\n}\n\nexport function awaitWindowHello(\n  win: CrossDomainWindowType,\n  timeout = 5000,\n  name = \"Window\"\n): ZalgoPromise<{\n  domain: string;\n}> {\n  let promise = getHelloPromise(win);\n\n  if (timeout !== -1) {\n    promise = promise.timeout(\n      timeout,\n      new Error(`${name} did not load after ${timeout}ms`)\n    );\n  }\n\n  return promise;\n}\n","export const MESSAGE_TYPE = {\n  REQUEST: \"postrobot_message_request\" as const,\n  RESPONSE: \"postrobot_message_response\" as const,\n  ACK: \"postrobot_message_ack\" as const,\n};\nexport const MESSAGE_ACK = {\n  SUCCESS: \"success\" as const,\n  ERROR: \"error\" as const,\n};\nexport const MESSAGE_NAME = {\n  METHOD: \"postrobot_method\" as const,\n  HELLO: \"postrobot_hello\" as const,\n  OPEN_TUNNEL: \"postrobot_open_tunnel\" as const,\n};\nexport const SEND_STRATEGY = {\n  POST_MESSAGE: \"postrobot_post_message\" as const,\n  BRIDGE: \"postrobot_bridge\" as const,\n  GLOBAL: \"postrobot_global\" as const,\n};\nexport const BRIDGE_NAME_PREFIX = \"__postrobot_bridge__\";\nexport const POSTROBOT_PROXY = \"__postrobot_proxy__\";\nexport const WILDCARD = \"*\";\nexport const SERIALIZATION_TYPE = {\n  CROSS_DOMAIN_ZALGO_PROMISE: \"cross_domain_zalgo_promise\" as const,\n  CROSS_DOMAIN_FUNCTION: \"cross_domain_function\" as const,\n  CROSS_DOMAIN_WINDOW: \"cross_domain_window\" as const,\n};\nexport const METHOD = {\n  GET: \"get\" as const,\n  POST: \"post\" as const,\n};\n","import type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport \"@krakenjs/cross-domain-utils\";\nimport { windowStore } from \"../global\";\nexport function markWindowKnown(win: CrossDomainWindowType) {\n  const knownWindows = windowStore(\"knownWindows\");\n  knownWindows.set(win, true);\n}\n\nexport function isWindowKnown(win: CrossDomainWindowType): boolean {\n  const knownWindows = windowStore(\"knownWindows\");\n  return knownWindows.get(win, false);\n}\n","import _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\n/* eslint max-lines: off */\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { linkFrameWindow, isWindowClosed, assertSameDomain } from \"@krakenjs/cross-domain-utils/dist/esm\";\nimport { WeakMap } from \"@krakenjs/cross-domain-safe-weakmap/dist/esm\";\nimport { isElement, inlineMemoize, memoize, noop, stringify, capitalizeFirstLetter, once, extend, safeInterval, uniqueID, arrayFrom, ExtendableError, strHashStr } from \"./util\";\nimport { isDevice } from \"./device\";\nimport { KEY_CODES, ATTRIBUTES, UID_HASH_LENGTH } from \"./constants\";\nexport function getBody() {\n  var body = document.body;\n  if (!body) {\n    throw new Error(\"Body element not found\");\n  }\n  return body;\n}\nexport function isDocumentReady() {\n  return Boolean(document.body) && document.readyState === \"complete\";\n}\nexport function isDocumentInteractive() {\n  return Boolean(document.body) && document.readyState === \"interactive\";\n}\nexport function urlEncode(str) {\n  return encodeURIComponent(str);\n}\nexport function waitForWindowReady() {\n  return inlineMemoize(waitForWindowReady, function () {\n    return new ZalgoPromise(function (resolve) {\n      if (isDocumentReady()) {\n        resolve();\n      }\n      window.addEventListener(\"load\", function () {\n        resolve();\n      });\n    });\n  });\n}\nexport var waitForDocumentReady = memoize(function () {\n  return new ZalgoPromise(function (resolve) {\n    if (isDocumentReady() || isDocumentInteractive()) {\n      resolve();\n      return;\n    }\n    var interval = setInterval(function () {\n      if (isDocumentReady() || isDocumentInteractive()) {\n        clearInterval(interval);\n        resolve();\n      }\n    }, 10);\n  });\n});\nexport function waitForDocumentBody() {\n  return ZalgoPromise.try(function () {\n    if (document.body) {\n      return document.body;\n    }\n    return waitForDocumentReady().then(function () {\n      if (document.body) {\n        return document.body;\n      }\n      throw new Error(\"Document ready but document.body not present\");\n    });\n  });\n}\nexport function parseQuery(queryString) {\n  return inlineMemoize(parseQuery, function () {\n    var params = {};\n    if (!queryString) {\n      return params;\n    }\n    if (!queryString.includes(\"=\")) {\n      return params;\n    }\n    for (var _i2 = 0, _queryString$split2 = queryString.split(\"&\"); _i2 < _queryString$split2.length; _i2++) {\n      var pair = _queryString$split2[_i2];\n      // @ts-expect-error pair.split is a string[] not string so this isnt a safe assignment\n      pair = pair.split(\"=\");\n      if (pair[0] && pair[1]) {\n        // @ts-expect-error we need to clean this lhs up\n        params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n      }\n    }\n    return params;\n  }, [queryString]);\n}\nexport function getQueryParam(name) {\n  return parseQuery(window.location.search.slice(1))[name];\n}\nexport function urlWillRedirectPage(url) {\n  if (!url.includes(\"#\")) {\n    return true;\n  }\n  if (url.startsWith(\"#\")) {\n    return false;\n  }\n  if (url.split(\"#\")[0] === window.location.href.split(\"#\")[0]) {\n    return false;\n  }\n  return true;\n}\nexport function formatQuery(obj) {\n  if (obj === void 0) {\n    obj = {};\n  }\n  return Object.keys(obj).filter(function (key) {\n    return typeof obj[key] === \"string\" || typeof obj[key] === \"boolean\";\n  }).map(function (key) {\n    var val = obj[key];\n    if (typeof val !== \"string\" && typeof val !== \"boolean\") {\n      throw new TypeError(\"Invalid type for query\");\n    }\n    return urlEncode(key) + \"=\" + urlEncode(val.toString());\n  }).join(\"&\");\n}\nexport function extendQuery(originalQuery, props) {\n  if (props === void 0) {\n    props = {};\n  }\n  if (!props || !Object.keys(props).length) {\n    return originalQuery;\n  }\n  return formatQuery(_extends({}, parseQuery(originalQuery), props));\n}\nexport function extendUrl(url, options) {\n  var query = options.query || {};\n  var hash = options.hash || {};\n  var originalUrl;\n  var originalQuery;\n  var originalHash;\n  // eslint-disable-next-line prefer-const\n  var _url$split = url.split(\"#\");\n  originalUrl = _url$split[0];\n  originalHash = _url$split[1];\n  var _originalUrl$split = originalUrl.split(\"?\");\n  originalUrl = _originalUrl$split[0];\n  originalQuery = _originalUrl$split[1];\n  var queryString = extendQuery(originalQuery, query);\n  var hashString = extendQuery(originalHash, hash);\n  if (queryString) {\n    originalUrl = originalUrl + \"?\" + queryString;\n  }\n  if (hashString) {\n    originalUrl = originalUrl + \"#\" + hashString;\n  }\n  return originalUrl;\n}\nexport function redirect(url, win) {\n  if (win === void 0) {\n    win = window;\n  }\n  return new ZalgoPromise(function (resolve) {\n    win.location = url;\n    if (!urlWillRedirectPage(url)) {\n      resolve();\n    }\n  });\n}\nexport function hasMetaViewPort() {\n  var meta = document.querySelector(\"meta[name=viewport]\");\n  if (isDevice() && window.screen.width < 660 && !meta) {\n    return false;\n  }\n  return true;\n}\nexport function isElementVisible(el) {\n  return Boolean(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n}\nexport function getPerformance() {\n  return inlineMemoize(getPerformance, function () {\n    var performance = window.performance;\n    if (performance && performance.now && performance.timing && performance.timing.connectEnd && performance.timing.navigationStart && Math.abs(performance.now() - Date.now()) > 1000 && performance.now() - (performance.timing.connectEnd - performance.timing.navigationStart) > 0) {\n      return performance;\n    }\n  });\n}\nexport function enablePerformance() {\n  return Boolean(getPerformance());\n}\nexport function getPageRenderTime() {\n  return waitForDocumentReady().then(function () {\n    var performance = getPerformance();\n    if (!performance) {\n      return;\n    }\n    var timing = performance.timing;\n    if (timing.connectEnd && timing.domInteractive) {\n      return timing.domInteractive - timing.connectEnd;\n    }\n  });\n}\nexport function htmlEncode(html) {\n  if (html === void 0) {\n    html = \"\";\n  }\n  return html.toString().replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\").replace(/\\//g, \"&#x2F;\");\n}\nexport function isBrowser() {\n  return typeof window !== \"undefined\" && window.location !== undefined;\n}\nexport function querySelectorAll(selector, doc) {\n  if (doc === void 0) {\n    doc = window.document;\n  }\n  // $FlowFixMe[method-unbinding]\n  return Array.prototype.slice.call(doc.querySelectorAll(selector));\n}\n\n/**\n * Sets up event handlers for click events and\n * enter/space keypresses.\n * @callback handler\n * @param {HTMLElement} element\n * @param {handler} handler\n */\nexport function onClick(element, handler) {\n  element.addEventListener(\"touchstart\", noop, {\n    passive: true\n  });\n  element.addEventListener(\"click\", handler);\n  element.addEventListener(\"keypress\", function (event) {\n    if (event.keyCode === KEY_CODES.ENTER || event.keyCode === KEY_CODES.SPACE) {\n      handler(event);\n    }\n  });\n}\nexport function getScript(_ref) {\n  var _ref$host = _ref.host,\n    host = _ref$host === void 0 ? window.location.host : _ref$host,\n    path = _ref.path,\n    _ref$reverse = _ref.reverse,\n    reverse = _ref$reverse === void 0 ? false : _ref$reverse;\n  return inlineMemoize(getScript, function () {\n    var url = \"\" + host + path;\n    // $FlowFixMe[method-unbinding]\n    var scripts = Array.prototype.slice.call(document.getElementsByTagName(\"script\"));\n    if (reverse) {\n      scripts.reverse();\n    }\n    for (var _i4 = 0; _i4 < scripts.length; _i4++) {\n      var script = scripts[_i4];\n      if (!script.src) {\n        continue;\n      }\n      var src = script.src.replace(/^https?:\\/\\//, \"\").split(\"?\")[0];\n      if (src === url) {\n        return script;\n      }\n    }\n  }, [path]);\n}\nexport function isLocalStorageEnabled() {\n  return inlineMemoize(isLocalStorageEnabled, function () {\n    try {\n      if (typeof window === \"undefined\") {\n        return false;\n      }\n      if (window.localStorage) {\n        var value = Math.random().toString();\n        window.localStorage.setItem(\"__test__localStorage__\", value);\n        var result = window.localStorage.getItem(\"__test__localStorage__\");\n        window.localStorage.removeItem(\"__test__localStorage__\");\n        if (value === result) {\n          return true;\n        }\n      }\n    } catch (err) {\n      // pass\n    }\n    return false;\n  });\n}\nexport function getBrowserLocales() {\n  var nav = window.navigator;\n  var locales = nav.languages ? [].concat(nav.languages) : [];\n  if (nav.language) {\n    locales.push(nav.language);\n  }\n\n  // @ts-expect-error Property 'userLanguage' does not exist on type 'Navigator'.ts(2339)\n  if (nav.userLanguage) {\n    // @ts-expect-error Property 'userLanguage' does not exist on type 'Navigator'.ts(2339)\n    locales.push(nav.userLanguage);\n  }\n  return locales.map(function (locale) {\n    if (locale && /^[a-z]{2}[-_][A-Z]{2}$/.exec(locale)) {\n      var _locale$split = locale.split(/[-_]/),\n        lang = _locale$split[0],\n        country = _locale$split[1];\n      return {\n        country: country,\n        lang: lang\n      };\n    }\n    if (locale && /^[a-z]{2}$/.exec(locale)) {\n      return {\n        lang: locale\n      };\n    }\n\n    // TSTODO: can we remove this null?\n    return null;\n  }).filter(Boolean);\n}\nexport function appendChild(container, child) {\n  container.appendChild(child);\n}\nexport function getElementSafe(id, doc) {\n  if (doc === void 0) {\n    doc = document;\n  }\n  if (isElement(id)) {\n    // @ts-expect-error - no idea what we are doing here\n    return id;\n  }\n  if (typeof id === \"string\") {\n    // @ts-expect-error id can be null or undefined still\n    return doc.querySelector(id);\n  }\n}\nexport function getElement(id, doc) {\n  if (doc === void 0) {\n    doc = document;\n  }\n  var element = getElementSafe(id, doc);\n  if (element) {\n    return element;\n  }\n  throw new Error(\"Can not find element: \" + stringify(id));\n}\nexport function elementReady(id) {\n  return new ZalgoPromise(function (resolve, reject) {\n    var name = stringify(id);\n    var el = getElementSafe(id);\n    if (el) {\n      resolve(el);\n      return;\n    }\n    if (isDocumentReady()) {\n      reject(new Error(\"Document is ready and element \" + name + \" does not exist\"));\n      return;\n    }\n    var interval = setInterval(function () {\n      el = getElementSafe(id);\n      if (el) {\n        resolve(el);\n        clearInterval(interval);\n        return;\n      }\n      if (isDocumentReady()) {\n        clearInterval(interval);\n        reject(new Error(\"Document is ready and element \" + name + \" does not exist\"));\n      }\n    }, 10);\n  });\n}\nexport var PopupOpenError = /*#__PURE__*/function (_ExtendableError) {\n  _inheritsLoose(PopupOpenError, _ExtendableError);\n  function PopupOpenError() {\n    return _ExtendableError.apply(this, arguments) || this;\n  }\n  return PopupOpenError;\n}(ExtendableError);\nexport function popup(url, options) {\n  // $FlowFixMe\n  options = options || {};\n  var _options = options,\n    _options$closeOnUnloa = _options.closeOnUnload,\n    closeOnUnload = _options$closeOnUnloa === void 0 ? 1 : _options$closeOnUnloa,\n    _options$name = _options.name,\n    name = _options$name === void 0 ? \"\" : _options$name,\n    width = _options.width,\n    height = _options.height;\n  var top = 0;\n  var left = 0;\n  if (width) {\n    if (window.outerWidth) {\n      left = Math.round((window.outerWidth - width) / 2) + window.screenX;\n    } else if (window.screen.width) {\n      left = Math.round((window.screen.width - width) / 2);\n    }\n  }\n  if (height) {\n    if (window.outerHeight) {\n      top = Math.round((window.outerHeight - height) / 2) + window.screenY;\n    } else if (window.screen.height) {\n      top = Math.round((window.screen.height - height) / 2);\n    }\n  }\n  delete options.closeOnUnload;\n  delete options.name;\n  if (width && height) {\n    // $FlowFixMe\n    options = _extends({\n      top: top,\n      left: left,\n      width: width,\n      height: height,\n      status: 1,\n      toolbar: 0,\n      menubar: 0,\n      resizable: 1,\n      scrollbars: 1\n    }, options);\n  }\n  var params = Object.keys(options).map(function (key) {\n    // @ts-expect-error cant see index for some reason\n    if (options[key] !== null && options[key] !== undefined) {\n      // @ts-expect-error cant see index for some reason\n      return key + \"=\" + stringify(options[key]);\n    }\n  }).filter(Boolean).join(\",\");\n  var win;\n  try {\n    // @ts-expect-error window.open can be null but we didn't account for that\n    // eslint-disable-next-line security/detect-non-literal-fs-filename\n    win = window.open(url, name, params);\n  } catch (err) {\n    throw new PopupOpenError(\"Can not open popup window - \" + (err.stack || err.message));\n  }\n  if (isWindowClosed(win)) {\n    var err = new PopupOpenError(\"Can not open popup window - blocked\");\n    throw err;\n  }\n  if (closeOnUnload) {\n    // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n    window.addEventListener(\"unload\", function () {\n      return win.close();\n    });\n  }\n  return win;\n}\nexport function writeToWindow(win, html) {\n  try {\n    win.document.open();\n    win.document.write(html);\n    win.document.close();\n  } catch (err) {\n    try {\n      // @ts-expect-error string is not assignable to window.location\n      win.location = \"javascript: document.open(); document.write(\" + JSON.stringify(html) + \"); document.close();\";\n    } catch (err2) {\n      // pass\n    }\n  }\n}\nexport function writeElementToWindow(win, el) {\n  var tag = el.tagName.toLowerCase();\n  if (tag !== \"html\") {\n    throw new Error(\"Expected element to be html, got \" + tag);\n  }\n  var documentElement = win.document.documentElement;\n  for (var _i6 = 0, _arrayFrom2 = arrayFrom(documentElement.children); _i6 < _arrayFrom2.length; _i6++) {\n    var child = _arrayFrom2[_i6];\n    // @ts-expect-error HTMLCollection element is not same as node\n    documentElement.removeChild(child);\n  }\n  for (var _i8 = 0, _arrayFrom4 = arrayFrom(el.children); _i8 < _arrayFrom4.length; _i8++) {\n    var _child = _arrayFrom4[_i8];\n    // @ts-expect-error HTMLCollection element is not same as node\n    documentElement.appendChild(_child);\n  }\n}\nexport function setStyle(el, styleText, doc) {\n  if (doc === void 0) {\n    doc = window.document;\n  }\n  // @ts-expect-error styleSheet does not exist on HTMLElement\n  if (el.styleSheet) {\n    // @ts-expect-error styleSheet does not exist on HTMLElement\n    el.styleSheet.cssText = styleText;\n  } else {\n    el.appendChild(doc.createTextNode(styleText));\n  }\n}\nvar awaitFrameLoadPromises;\nexport function awaitFrameLoad(frame) {\n  awaitFrameLoadPromises = awaitFrameLoadPromises || new WeakMap();\n  if (awaitFrameLoadPromises.has(frame)) {\n    var _promise = awaitFrameLoadPromises.get(frame);\n    if (_promise) {\n      return _promise;\n    }\n  }\n  var promise = new ZalgoPromise(function (resolve, reject) {\n    frame.addEventListener(\"load\", function () {\n      linkFrameWindow(frame);\n      resolve(frame);\n    });\n    frame.addEventListener(\"error\", function (err) {\n      if (frame.contentWindow) {\n        resolve(frame);\n      } else {\n        reject(err);\n      }\n    });\n  });\n  awaitFrameLoadPromises.set(frame, promise);\n  return promise;\n}\nexport function awaitFrameWindow(frame) {\n  return awaitFrameLoad(frame).then(function (loadedFrame) {\n    if (!loadedFrame.contentWindow) {\n      throw new Error(\"Could not find window in iframe\");\n    }\n    return loadedFrame.contentWindow;\n  });\n}\nvar getDefaultCreateElementOptions = function getDefaultCreateElementOptions() {\n  return {};\n};\nexport function createElement(\n// eslint-disable-next-line @typescript-eslint/default-param-last\ntag,\n// eslint-disable-next-line @typescript-eslint/default-param-last\noptions, container) {\n  if (tag === void 0) {\n    tag = \"div\";\n  }\n  if (options === void 0) {\n    options = getDefaultCreateElementOptions();\n  }\n  tag = tag.toLowerCase();\n  var element = document.createElement(tag);\n  if (options.style) {\n    extend(element.style, options.style);\n  }\n  if (options.class) {\n    element.className = options.class.join(\" \");\n  }\n  if (options.id) {\n    element.setAttribute(\"id\", options.id);\n  }\n  if (options.attributes) {\n    for (var _i10 = 0, _Object$keys2 = Object.keys(options.attributes); _i10 < _Object$keys2.length; _i10++) {\n      var key = _Object$keys2[_i10];\n      element.setAttribute(key, options.attributes[key]);\n    }\n  }\n  if (options.styleSheet) {\n    setStyle(element, options.styleSheet);\n  }\n  if (container) {\n    appendChild(container, element);\n  }\n  if (options.html) {\n    if (tag === \"iframe\") {\n      // @ts-expect-error contentWindow does not exist on HTMLElement\n      if (!container || !element.contentWindow) {\n        throw new Error(\"Iframe html can not be written unless container provided and iframe in DOM\");\n      }\n\n      // @ts-expect-error contentWindow does not exist on HTMLElement\n      writeToWindow(element.contentWindow, options.html);\n    } else {\n      element.innerHTML = options.html;\n    }\n  }\n  return element;\n}\nvar getDefaultIframeOptions = function getDefaultIframeOptions() {\n  return {};\n};\nvar getDefaultStringMap = function getDefaultStringMap() {\n  return {};\n};\nexport function iframe(\n// eslint-disable-next-line @typescript-eslint/default-param-last\noptions, container) {\n  if (options === void 0) {\n    options = getDefaultIframeOptions();\n  }\n  var attributes = options.attributes || getDefaultStringMap();\n  var style = options.style || getDefaultStringMap();\n  var newAttributes = _extends({\n    allowTransparency: \"true\"\n  }, attributes);\n  var newStyle = _extends({\n    backgroundColor: \"transparent\",\n    border: \"none\"\n  }, style);\n\n  // @ts-expect-error - createElement takes 3 args not 2\n  var frame = createElement(\"iframe\", {\n    attributes: newAttributes,\n    style: newStyle,\n    html: options.html,\n    class: options.class\n  });\n  var isIE = /MSIE|Edge/i.exec(window.navigator.userAgent);\n  if (!frame.hasAttribute(\"id\")) {\n    frame.setAttribute(\"id\", uniqueID());\n  }\n  void awaitFrameLoad(frame);\n  if (container) {\n    var el = getElement(container);\n    el.appendChild(frame);\n  }\n  if (options.url || isIE) {\n    frame.setAttribute(\"src\", options.url || \"about:blank\");\n  }\n  return frame;\n}\nexport function addEventListener(obj, event, handler) {\n  obj.addEventListener(event, handler);\n  return {\n    cancel: function cancel() {\n      obj.removeEventListener(event, handler);\n    }\n  };\n}\nexport function bindEvents(element, eventNames, handler) {\n  handler = once(handler);\n  for (var _i12 = 0; _i12 < eventNames.length; _i12++) {\n    var eventName = eventNames[_i12];\n    element.addEventListener(eventName, handler);\n  }\n  return {\n    cancel: once(function () {\n      for (var _i14 = 0; _i14 < eventNames.length; _i14++) {\n        var _eventName = eventNames[_i14];\n        element.removeEventListener(_eventName, handler);\n      }\n    })\n  };\n}\nvar VENDOR_PREFIXES = [\"webkit\", \"moz\", \"ms\", \"o\"];\nexport function setVendorCSS(element, name, value) {\n  // @ts-expect-error indexer as string\n  element.style[name] = value;\n  var capitalizedName = capitalizeFirstLetter(name);\n  for (var _i16 = 0; _i16 < VENDOR_PREFIXES.length; _i16++) {\n    var prefix = VENDOR_PREFIXES[_i16];\n    // @ts-expect-error indexer as string\n    element.style[\"\" + prefix + capitalizedName] = value;\n  }\n}\nvar ANIMATION_START_EVENTS = [\"animationstart\", \"webkitAnimationStart\", \"oAnimationStart\", \"MSAnimationStart\"];\nvar ANIMATION_END_EVENTS = [\"animationend\", \"webkitAnimationEnd\", \"oAnimationEnd\", \"MSAnimationEnd\"];\nexport function animate(element, name, clean, timeout) {\n  if (timeout === void 0) {\n    timeout = 1000;\n  }\n  return new ZalgoPromise(function (resolve, reject) {\n    var el = getElement(element);\n    if (!el) {\n      resolve();\n      return;\n    }\n    var hasStarted = false;\n    // eslint-disable-next-line prefer-const, no-undef\n    var startTimeout;\n    // eslint-disable-next-line no-undef\n    var endTimeout;\n    // eslint-disable-next-line prefer-const\n    var startEvent;\n    // eslint-disable-next-line prefer-const\n    var endEvent;\n    function cleanUp() {\n      clearTimeout(startTimeout);\n      clearTimeout(endTimeout);\n      startEvent.cancel();\n      endEvent.cancel();\n    }\n    startEvent = bindEvents(el, ANIMATION_START_EVENTS, function (event) {\n      // @ts-expect-error animationName does not exist on event\n      if (event.target !== el || event.animationName !== name) {\n        return;\n      }\n      clearTimeout(startTimeout);\n      event.stopPropagation();\n      startEvent.cancel();\n      hasStarted = true;\n      endTimeout = setTimeout(function () {\n        cleanUp();\n        resolve();\n      }, timeout);\n    });\n    endEvent = bindEvents(el, ANIMATION_END_EVENTS, function (event) {\n      // @ts-expect-error animationName does not exist on event\n      if (event.target !== el || event.animationName !== name) {\n        return;\n      }\n      cleanUp();\n      if (\n      // @ts-expect-error animationName does not exist on event\n      typeof event.animationName === \"string\" &&\n      // @ts-expect-error animationName does not exist on event\n      event.animationName !== name) {\n        reject( // @ts-expect-error animationName does not exist on event\n        \"Expected animation name to be \" + name + \", found \" + event.animationName);\n        return;\n      }\n      resolve();\n    });\n    setVendorCSS(el, \"animationName\", name);\n    startTimeout = setTimeout(function () {\n      if (!hasStarted) {\n        cleanUp();\n        resolve();\n      }\n    }, 200);\n    if (clean) {\n      clean(cleanUp);\n    }\n  });\n}\nexport function makeElementVisible(element) {\n  element.style.setProperty(\"visibility\", \"\");\n}\nexport function makeElementInvisible(element) {\n  element.style.setProperty(\"visibility\", \"hidden\", \"important\");\n}\nexport function showElement(element) {\n  element.style.setProperty(\"display\", \"\");\n}\nexport function hideElement(element) {\n  element.style.setProperty(\"display\", \"none\", \"important\");\n}\nexport function destroyElement(element) {\n  if (element && element.parentNode) {\n    element.parentNode.removeChild(element);\n  }\n}\nexport function showAndAnimate(element, name, clean) {\n  var animation = animate(element, name, clean);\n  showElement(element);\n  return animation;\n}\nexport function animateAndHide(element, name, clean) {\n  return animate(element, name, clean).then(function () {\n    hideElement(element);\n  });\n}\nexport function addClass(element, name) {\n  element.classList.add(name);\n}\nexport function removeClass(element, name) {\n  element.classList.remove(name);\n}\nexport function isElementClosed(el) {\n  if (!el || !el.parentNode || !el.ownerDocument || !el.ownerDocument.documentElement || !el.ownerDocument.documentElement.contains(el)) {\n    return true;\n  }\n  return false;\n}\nexport function watchElementForClose(element, handler) {\n  handler = once(handler);\n  var cancelled = false;\n  var mutationObservers = [];\n  // eslint-disable-next-line prefer-const\n  var interval;\n  // eslint-disable-next-line prefer-const\n  var sacrificialFrame;\n  var sacrificialFrameWin;\n  var cancel = function cancel() {\n    cancelled = true;\n    for (var _i18 = 0; _i18 < mutationObservers.length; _i18++) {\n      var observer = mutationObservers[_i18];\n      observer.disconnect();\n    }\n    if (interval) {\n      interval.cancel();\n    }\n    if (sacrificialFrameWin) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      sacrificialFrameWin.removeEventListener(\"unload\", elementClosed);\n    }\n    if (sacrificialFrame) {\n      destroyElement(sacrificialFrame);\n    }\n  };\n  var elementClosed = function elementClosed() {\n    if (!cancelled) {\n      handler();\n      cancel();\n    }\n  };\n  if (isElementClosed(element)) {\n    elementClosed();\n    return {\n      cancel: cancel\n    };\n  }\n\n  // Strategy 1: Mutation observer\n  if (window.MutationObserver) {\n    var mutationElement = element.parentElement;\n    while (mutationElement) {\n      var mutationObserver = new window.MutationObserver(function () {\n        if (isElementClosed(element)) {\n          elementClosed();\n        }\n      });\n      mutationObserver.observe(mutationElement, {\n        childList: true\n      });\n      mutationObservers.push(mutationObserver);\n      mutationElement = mutationElement.parentElement;\n    }\n  }\n\n  // Strategy 2: Sacrificial iframe\n  sacrificialFrame = document.createElement(\"iframe\");\n  sacrificialFrame.setAttribute(\"name\", \"__detect_close_\" + uniqueID() + \"__\");\n  sacrificialFrame.style.display = \"none\";\n  void awaitFrameWindow(sacrificialFrame).then(function (frameWin) {\n    sacrificialFrameWin = assertSameDomain(frameWin);\n    sacrificialFrameWin.addEventListener(\"unload\", elementClosed);\n  });\n  element.appendChild(sacrificialFrame);\n\n  // Strategy 3: Poller\n  var check = function check() {\n    if (isElementClosed(element)) {\n      elementClosed();\n    }\n  };\n  interval = safeInterval(check, 1000);\n  return {\n    cancel: cancel\n  };\n}\nexport function fixScripts(el, doc) {\n  if (doc === void 0) {\n    doc = window.document;\n  }\n  for (var _i20 = 0, _querySelectorAll2 = querySelectorAll(\"script\", el); _i20 < _querySelectorAll2.length; _i20++) {\n    var script = _querySelectorAll2[_i20];\n    var parentNode = script.parentNode;\n    if (!parentNode) {\n      continue;\n    }\n    var newScript = doc.createElement(\"script\");\n    // @ts-expect-error textContent can be null\n    newScript.text = script.textContent;\n    parentNode.replaceChild(newScript, script);\n  }\n}\nexport function onResize(el, handler, _temp) {\n  var _ref2 = _temp === void 0 ? {} : _temp,\n    _ref2$width = _ref2.width,\n    width = _ref2$width === void 0 ? true : _ref2$width,\n    _ref2$height = _ref2.height,\n    height = _ref2$height === void 0 ? true : _ref2$height,\n    _ref2$interval = _ref2.interval,\n    interval = _ref2$interval === void 0 ? 100 : _ref2$interval,\n    _ref2$win = _ref2.win,\n    win = _ref2$win === void 0 ? window : _ref2$win;\n  var currentWidth = el.offsetWidth;\n  var currentHeight = el.offsetHeight;\n  var canceled = false;\n  handler({\n    width: currentWidth,\n    height: currentHeight\n  });\n  var check = function check() {\n    if (canceled || !isElementVisible(el)) {\n      return;\n    }\n    var newWidth = el.offsetWidth;\n    var newHeight = el.offsetHeight;\n    if (width && newWidth !== currentWidth || height && newHeight !== currentHeight) {\n      handler({\n        width: newWidth,\n        height: newHeight\n      });\n    }\n    currentWidth = newWidth;\n    currentHeight = newHeight;\n  };\n  var observer;\n  var timeout;\n  win.addEventListener(\"resize\", check);\n\n  // @ts-expect-error Property 'ResizeObserver' does not exist on type 'SameDomainWindowType'.ts(2339)\n  if (typeof win.ResizeObserver !== \"undefined\") {\n    // @ts-expect-error Property 'ResizeObserver' does not exist on type 'SameDomainWindowType'.ts(2339)\n    observer = new win.ResizeObserver(check);\n    observer.observe(el);\n    timeout = safeInterval(check, interval * 10);\n    // @ts-expect-error Property 'MutationObserver' does not exist on type 'SameDomainWindowType'.ts(2339)\n  } else if (typeof win.MutationObserver !== \"undefined\") {\n    // @ts-expect-error Property 'MutationObserver' does not exist on type 'SameDomainWindowType'.ts(2339)\n    observer = new win.MutationObserver(check);\n    observer.observe(el, {\n      // @ts-expect-error attributes is not a valid property of MutationObserver\n      attributes: true,\n      childList: true,\n      subtree: true,\n      characterData: false\n    });\n    timeout = safeInterval(check, interval * 10);\n  } else {\n    timeout = safeInterval(check, interval);\n  }\n  return {\n    cancel: function cancel() {\n      canceled = true;\n      observer.disconnect();\n      window.removeEventListener(\"resize\", check);\n      timeout.cancel();\n    }\n  };\n}\nexport function getResourceLoadTime(url) {\n  var performance = getPerformance();\n  if (!performance) {\n    return;\n  }\n\n  // $FlowFixMe[method-unbinding]\n  if (typeof performance.getEntries !== \"function\") {\n    return;\n  }\n  var entries = performance.getEntries();\n  for (var i = 0; i < entries.length; i++) {\n    var entry = entries[i];\n    if (entry && entry.name && entry.name.startsWith(url) && typeof entry.duration === \"number\") {\n      return Math.floor(entry.duration);\n    }\n  }\n}\nexport function isShadowElement(element) {\n  while (element.parentNode) {\n    element = element.parentNode;\n  }\n\n  // 'element' will evaluate to '[object Object]' when stringified.\n  // eslint-disable-next-line @typescript-eslint/no-base-to-string\n  return element.toString() === \"[object ShadowRoot]\";\n}\nexport function getShadowRoot(element) {\n  while (element.parentNode) {\n    element = element.parentNode;\n  }\n  if (isShadowElement(element)) {\n    return element;\n  }\n}\nexport function getShadowHost(element) {\n  var shadowRoot = getShadowRoot(element);\n\n  // @ts-expect-error host does not exist on node\n  if (shadowRoot && shadowRoot.host) {\n    // @ts-expect-error host does not exist on node\n    return shadowRoot.host;\n  }\n}\nexport function insertShadowSlot(element) {\n  var shadowHost = getShadowHost(element);\n  if (!shadowHost) {\n    throw new Error(\"Element is not in shadow dom\");\n  }\n  var slotName = \"shadow-slot-\" + uniqueID();\n  var slot = document.createElement(\"slot\");\n  slot.setAttribute(\"name\", slotName);\n  element.appendChild(slot);\n  var slotProvider = document.createElement(\"div\");\n  slotProvider.setAttribute(\"slot\", slotName);\n  shadowHost.appendChild(slotProvider);\n  if (isShadowElement(shadowHost)) {\n    return insertShadowSlot(slotProvider);\n  }\n  return slotProvider;\n}\nexport function preventClickFocus(el) {\n  var onFocus = function onFocus(event) {\n    el.removeEventListener(\"focus\", onFocus);\n    event.preventDefault();\n    el.blur();\n    return false;\n  };\n  el.addEventListener(\"mousedown\", function () {\n    el.addEventListener(\"focus\", onFocus);\n    setTimeout(function () {\n      el.removeEventListener(\"focus\", onFocus);\n    }, 1);\n  });\n}\nexport function getStackTrace() {\n  try {\n    throw new Error(\"_\");\n  } catch (err) {\n    return err.stack || \"\";\n  }\n}\nfunction inferCurrentScript() {\n  try {\n    var stack = getStackTrace();\n    var stackDetails = /.*at [^(]*\\((.*):(.+):(.+)\\)$/gi.exec(stack);\n    var scriptLocation = stackDetails && stackDetails[1];\n    if (!scriptLocation) {\n      return;\n    }\n    for (var _i22 = 0, _Array$prototype$slic2 = Array.prototype.slice.call(document.getElementsByTagName(\"script\")).reverse(); _i22 < _Array$prototype$slic2.length; _i22++) {\n      var script = _Array$prototype$slic2[_i22];\n      if (script.src && script.src === scriptLocation) {\n        return script;\n      }\n    }\n  } catch (err) {\n    // pass\n  }\n}\nvar currentScript = typeof document !== \"undefined\" ? document.currentScript : null;\nexport var getCurrentScript = memoize(function () {\n  if (currentScript) {\n    return currentScript;\n  }\n  currentScript = inferCurrentScript();\n  if (currentScript) {\n    return currentScript;\n  }\n  throw new Error(\"Can not determine current script\");\n});\nvar currentUID = uniqueID();\nexport var getCurrentScriptUID = memoize(function () {\n  var script;\n  try {\n    script = getCurrentScript();\n  } catch (err) {\n    return currentUID;\n  }\n  var uid = script.getAttribute(ATTRIBUTES.UID);\n  if (uid && typeof uid === \"string\") {\n    return uid;\n  }\n  uid = script.getAttribute(ATTRIBUTES.UID + \"-auto\");\n  if (uid && typeof uid === \"string\") {\n    return uid;\n  }\n  if (script.src) {\n    var _script = script,\n      src = _script.src,\n      dataset = _script.dataset;\n    var stringToHash = JSON.stringify({\n      src: src,\n      dataset: dataset\n    });\n    var hashedString = strHashStr(stringToHash);\n    var hashResult = hashedString.slice(hashedString.length - UID_HASH_LENGTH);\n    uid = \"uid_\" + hashResult;\n  } else {\n    uid = uniqueID();\n  }\n  script.setAttribute(ATTRIBUTES.UID + \"-auto\", uid);\n  return uid;\n});\nexport function submitForm(_ref3) {\n  var url = _ref3.url,\n    target = _ref3.target,\n    body = _ref3.body,\n    _ref3$method = _ref3.method,\n    method = _ref3$method === void 0 ? \"post\" : _ref3$method;\n  var form = document.createElement(\"form\");\n  form.setAttribute(\"target\", target);\n  form.setAttribute(\"method\", method);\n  form.setAttribute(\"action\", url);\n  form.style.display = \"none\";\n  if (body) {\n    for (var _i24 = 0, _Object$keys4 = Object.keys(body); _i24 < _Object$keys4.length; _i24++) {\n      var _body$key;\n      var key = _Object$keys4[_i24];\n      var input = document.createElement(\"input\");\n      input.setAttribute(\"name\", key);\n      input.setAttribute(\"value\", (_body$key = body[key]) == null ? void 0 : _body$key.toString());\n      form.appendChild(input);\n    }\n  }\n  getBody().appendChild(form);\n  form.submit();\n  getBody().removeChild(form);\n}","var _SERIALIZER;\nimport { TYPE } from \"./constants\";\nimport { determineType, isSerializedType } from \"./common\";\nimport { serializeFunction, serializeError, serializePromise, serializeRegex, serializeDate, serializeArray, serializeObject, serializeString, serializeNumber, serializeBoolean, serializeNull, serializeUndefined } from \"./serializers\";\nvar SERIALIZER = (_SERIALIZER = {}, _SERIALIZER[TYPE.FUNCTION] = serializeFunction, _SERIALIZER[TYPE.ERROR] = serializeError, _SERIALIZER[TYPE.PROMISE] = serializePromise, _SERIALIZER[TYPE.REGEX] = serializeRegex, _SERIALIZER[TYPE.DATE] = serializeDate, _SERIALIZER[TYPE.ARRAY] = serializeArray, _SERIALIZER[TYPE.OBJECT] = serializeObject, _SERIALIZER[TYPE.STRING] = serializeString, _SERIALIZER[TYPE.NUMBER] = serializeNumber, _SERIALIZER[TYPE.BOOLEAN] = serializeBoolean, _SERIALIZER[TYPE.NULL] = serializeNull, _SERIALIZER[TYPE.UNDEFINED] = serializeUndefined, _SERIALIZER);\nvar defaultSerializers = {};\nexport function serialize(obj, serializers) {\n  if (serializers === void 0) {\n    serializers = defaultSerializers;\n  }\n  function replacer(key) {\n    var _serializers$type;\n    // @ts-expect-error - this has unknown caller\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access, security/detect-object-injection\n    var val = this[key];\n\n    // @ts-expect-error = this has unknown caller\n    if (isSerializedType(this)) {\n      return val;\n    }\n    var type = determineType(val);\n    if (!type) {\n      return val;\n    }\n\n    // dynamic code execution\n    // eslint-disable-next-line security/detect-object-injection\n    var serializer = (_serializers$type = serializers[type]) != null ? _serializers$type : SERIALIZER[type];\n    if (!serializer) {\n      return val;\n    }\n\n    // @ts-expect-error val is of type any\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return serializer(val, key);\n  }\n  var result = JSON.stringify(obj, replacer);\n  if (typeof result === \"undefined\") {\n    return TYPE.UNDEFINED;\n  }\n  return result;\n}","import { TYPE } from \"./constants\";\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isSerializedType(item) {\n  return typeof item === \"object\" && item !== null &&\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  typeof item.__type__ === \"string\";\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function determineType(val) {\n  if (typeof val === \"undefined\") {\n    return TYPE.UNDEFINED;\n  }\n  if (val === null) {\n    return TYPE.NULL;\n  }\n  if (Array.isArray(val)) {\n    return TYPE.ARRAY;\n  }\n  if (typeof val === \"function\") {\n    return TYPE.FUNCTION;\n  }\n  if (typeof val === \"object\") {\n    if (val instanceof Error) {\n      return TYPE.ERROR;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (typeof val.then === \"function\") {\n      return TYPE.PROMISE;\n    }\n    if (Object.prototype.toString.call(val) === \"[object RegExp]\") {\n      return TYPE.REGEX;\n    }\n    if (Object.prototype.toString.call(val) === \"[object Date]\") {\n      return TYPE.DATE;\n    }\n    return TYPE.OBJECT;\n  }\n  if (typeof val === \"string\") {\n    return TYPE.STRING;\n  }\n  if (typeof val === \"number\") {\n    return TYPE.NUMBER;\n  }\n  if (typeof val === \"boolean\") {\n    return TYPE.BOOLEAN;\n  }\n}\nexport function serializeType(type, val) {\n  return {\n    __type__: type,\n    __val__: val\n  };\n}","export var TYPE = {\n  FUNCTION: \"function\",\n  ERROR: \"error\",\n  PROMISE: \"promise\",\n  REGEX: \"regex\",\n  DATE: \"date\",\n  ARRAY: \"array\",\n  OBJECT: \"object\",\n  STRING: \"string\",\n  NUMBER: \"number\",\n  BOOLEAN: \"boolean\",\n  NULL: \"null\",\n  UNDEFINED: \"undefined\"\n};","export var KEY_CODES = {\n  ENTER: 13,\n  SPACE: 32\n};\nexport var ATTRIBUTES = {\n  UID: \"data-uid\"\n};\nexport var UID_HASH_LENGTH = 30;","var _DESERIALIZER;\nimport { TYPE } from \"./constants\";\nimport { determineType, isSerializedType } from \"./common\";\nimport { deserializeFunction, deserializeError, deserializePromise, deserializeRegex, deserializeDate, deserializeArray, deserializeObject, deserializeString, deserializeNumber, deserializeBoolean, deserializeNull, deserializeUndefined } from \"./serializers\";\nvar DESERIALIZER = (_DESERIALIZER = {}, _DESERIALIZER[TYPE.FUNCTION] = deserializeFunction, _DESERIALIZER[TYPE.ERROR] = deserializeError, _DESERIALIZER[TYPE.PROMISE] = deserializePromise, _DESERIALIZER[TYPE.REGEX] = deserializeRegex, _DESERIALIZER[TYPE.DATE] = deserializeDate, _DESERIALIZER[TYPE.ARRAY] = deserializeArray, _DESERIALIZER[TYPE.OBJECT] = deserializeObject, _DESERIALIZER[TYPE.STRING] = deserializeString, _DESERIALIZER[TYPE.NUMBER] = deserializeNumber, _DESERIALIZER[TYPE.BOOLEAN] = deserializeBoolean, _DESERIALIZER[TYPE.NULL] = deserializeNull, _DESERIALIZER[TYPE.UNDEFINED] = deserializeUndefined, _DESERIALIZER);\nvar defaultDeserializers = {};\nexport function deserialize(str, deserializers) {\n  if (deserializers === void 0) {\n    deserializers = defaultDeserializers;\n  }\n  if (str === TYPE.UNDEFINED) {\n    // the lib allows undefined returns but doesnt expect type assertions for it. need fixing\n    // @ts-expect-error - we need to update the definitiona of this to allow for undefined because of this but itll take a lot of work\n    return;\n  }\n  function replacer(key, val) {\n    var _deserializers$type;\n    // @ts-expect-error - function this has unknown caller\n    if (isSerializedType(this)) {\n      return val;\n    }\n    var type;\n    var value;\n    if (isSerializedType(val)) {\n      type = val.__type__;\n      value = val.__val__;\n    } else {\n      type = determineType(val);\n      value = val;\n    }\n    if (!type) {\n      return value;\n    }\n\n    // dynamic code execution\n    // eslint-disable-next-line security/detect-object-injection\n    var deserializer = (_deserializers$type = deserializers[type]) != null ? _deserializers$type : DESERIALIZER[type];\n    if (!deserializer) {\n      return value;\n    }\n    return deserializer(value, key);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  return JSON.parse(str, replacer);\n}","export function serializeFunction() {\n  // pass\n}\nexport function deserializeFunction() {\n  throw new Error(\"Function serialization is not implemented; nothing to deserialize\");\n}","import { serializeType } from \"../common\";\nimport { TYPE } from \"../constants\";\nimport { serializeObject } from \"./object\";\nexport function serializeError(_ref) {\n  var message = _ref.message,\n    stack = _ref.stack,\n    code = _ref.code,\n    data = _ref.data;\n  return serializeType(TYPE.ERROR, {\n    message: message,\n    stack: stack,\n    code: code,\n    data: data\n  });\n}\nexport function deserializeError(_ref2) {\n  var message = _ref2.message,\n    stack = _ref2.stack,\n    code = _ref2.code,\n    data = _ref2.data;\n  var error = new Error(message);\n  error.code = code;\n  if (data) {\n    error.data = serializeObject(data);\n  }\n\n  // stack and error are both potentially undefined\n  // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  error.stack = stack + \"\\n\\n\" + error.stack;\n  return error;\n}","export function serializePromise() {\n  // pass\n}\nexport function deserializePromise() {\n  throw new Error(\"Promise serialization is not implemented; nothing to deserialize\");\n}","import { serializeType } from \"../common\";\nimport { TYPE } from \"../constants\";\nexport function serializeRegex(val) {\n  return serializeType(TYPE.REGEX, val.source);\n}\nexport function deserializeRegex(val) {\n  // eslint-disable-next-line security/detect-non-literal-regexp\n  return new RegExp(val);\n}","import { serializeType } from \"../common\";\nimport { TYPE } from \"../constants\";\nexport function serializeDate(val) {\n  return serializeType(TYPE.DATE, val.toJSON());\n}\nexport function deserializeDate(val) {\n  return new Date(val);\n}","export function serializeArray(val) {\n  return val;\n}\nexport function deserializeArray(val) {\n  return val;\n}","export function serializeObject(val) {\n  return val;\n}\nexport function deserializeObject(val) {\n  return val;\n}","export function serializeString(val) {\n  return val;\n}\nexport function deserializeString(val) {\n  return val;\n}","export function serializeNumber(val) {\n  return val;\n}\nexport function deserializeNumber(val) {\n  return val;\n}","export function serializeBoolean(val) {\n  return val;\n}\nexport function deserializeBoolean(val) {\n  return val;\n}","export function serializeNull(val) {\n  return val;\n}\nexport function deserializeNull(val) {\n  return val;\n}","import { serializeType } from \"../common\";\nimport { TYPE } from \"../constants\";\nexport function serializeUndefined(val) {\n  return serializeType(TYPE.UNDEFINED, val);\n}\nexport function deserializeUndefined() {\n  // pass\n}","import type { $Values } from \"utility-types\";\n\n/* eslint no-use-before-define: off */\nimport type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport {\n  isSameDomain,\n  isWindowClosed,\n  closeWindow,\n  getOpener,\n  WINDOW_TYPE,\n  isWindow,\n  assertSameDomain,\n  getFrameForWindow,\n} from \"@krakenjs/cross-domain-utils\";\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { uniqueID, memoizePromise, noop, submitForm } from \"@krakenjs/belter\";\nimport type { CustomSerializedType } from \"@krakenjs/universal-serialize\";\nimport { serializeType } from \"@krakenjs/universal-serialize\";\nimport { SERIALIZATION_TYPE, METHOD } from \"../conf\";\nimport { windowStore, globalStore } from \"../global\";\nimport { getWindowInstanceID } from \"../lib\";\nimport { linkWindow } from \"../bridge\";\nimport type { SendType } from \"../types\";\n\nfunction cleanupProxyWindows() {\n  const idToProxyWindow = globalStore(\"idToProxyWindow\");\n\n  for (const id of idToProxyWindow.keys()) {\n    // $FlowFixMe\n    if (idToProxyWindow.get(id).shouldClean()) {\n      idToProxyWindow.del(id);\n    }\n  }\n}\n\ntype SetLocationOptions = {\n  method?: $Values<typeof METHOD>;\n  body?: Record<string, string | boolean>;\n};\ntype SerializedWindowType = {\n  id: string;\n  getType: () => ZalgoPromise<$Values<typeof WINDOW_TYPE>>;\n  close: () => ZalgoPromise<void>;\n  focus: () => ZalgoPromise<void>;\n  isClosed: () => ZalgoPromise<boolean>;\n  setLocation: (url: string, opts?: SetLocationOptions) => ZalgoPromise<void>;\n  getName: () => ZalgoPromise<string | null | undefined>;\n  setName: (arg0: string) => ZalgoPromise<void>;\n  getInstanceID: () => ZalgoPromise<string>;\n};\n\nfunction getSerializedWindow(\n  winPromise: ZalgoPromise<CrossDomainWindowType>,\n  {\n    send,\n    id = uniqueID(),\n  }: {\n    send: SendType;\n    id?: string;\n  }\n): SerializedWindowType {\n  let windowNamePromise = winPromise.then((win) => {\n    if (isSameDomain(win)) {\n      return assertSameDomain(win).name;\n    }\n  });\n  const windowTypePromise = winPromise.then((window) => {\n    if (!isWindowClosed(window)) {\n      return getOpener(window) ? WINDOW_TYPE.POPUP : WINDOW_TYPE.IFRAME;\n    } else {\n      throw new Error(`Window is closed, can not determine type`);\n    }\n  });\n  windowNamePromise.catch(noop);\n  windowTypePromise.catch(noop);\n\n  const getName = () =>\n    winPromise.then((win) => {\n      if (isWindowClosed(win)) {\n        return;\n      }\n\n      if (isSameDomain(win)) {\n        return assertSameDomain(win).name;\n      }\n\n      return windowNamePromise;\n    });\n\n  const getDefaultSetLocationOptions = () => {\n    // $FlowFixMe\n    return {};\n  };\n\n  const setLocation = (\n    href: string,\n    opts: SetLocationOptions = getDefaultSetLocationOptions()\n  ) =>\n    winPromise.then((win) => {\n      const domain = `${window.location.protocol}//${window.location.host}`;\n      const { method = METHOD.GET, body } = opts;\n\n      if (href.startsWith(\"/\")) {\n        href = `${domain}${href}`;\n      } else if (!/^https?:\\/\\//.exec(href) && !href.startsWith(domain)) {\n        throw new Error(\n          `Expected url to be http or https url, or absolute path, got ${JSON.stringify(\n            href\n          )}`\n        );\n      }\n\n      if (method === METHOD.POST) {\n        return getName().then((name) => {\n          if (!name) {\n            throw new Error(`Can not post to window without target name`);\n          }\n\n          submitForm({\n            url: href,\n            target: name,\n            method,\n            body,\n          });\n        });\n      } else if (method === METHOD.GET) {\n        if (isSameDomain(win)) {\n          try {\n            if (win.location && typeof win.location.replace === \"function\") {\n              // $FlowFixMe\n              win.location.replace(href);\n              return;\n            }\n          } catch (err) {\n            // pass\n          }\n        }\n\n        win.location = href;\n      } else {\n        throw new Error(`Unsupported method: ${method}`);\n      }\n    });\n\n  return {\n    id,\n    getType: () => {\n      return windowTypePromise;\n    },\n    getInstanceID: memoizePromise(() =>\n      winPromise.then((win) =>\n        getWindowInstanceID(win, {\n          send,\n        })\n      )\n    ),\n    close: () => winPromise.then(closeWindow),\n    getName,\n    focus: () =>\n      winPromise.then((win) => {\n        win.focus();\n      }),\n    isClosed: () =>\n      winPromise.then((win) => {\n        return isWindowClosed(win);\n      }),\n    setLocation,\n    setName: (name) =>\n      winPromise.then((win) => {\n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n          linkWindow({\n            win,\n            name,\n          });\n        }\n\n        const sameDomain = isSameDomain(win);\n        const frame = getFrameForWindow(win);\n\n        if (!sameDomain) {\n          throw new Error(`Can not set name for cross-domain window: ${name}`);\n        }\n\n        assertSameDomain(win).name = name;\n\n        if (frame) {\n          frame.setAttribute(\"name\", name);\n        }\n\n        windowNamePromise = ZalgoPromise.resolve(name);\n      }),\n  };\n}\n\nexport class ProxyWindow {\n  id: string;\n  isProxyWindow: true = true;\n  serializedWindow: SerializedWindowType;\n  actualWindow: CrossDomainWindowType | null | undefined;\n  actualWindowPromise: ZalgoPromise<CrossDomainWindowType>;\n  send: SendType;\n  name: string;\n\n  constructor({\n    send,\n    win,\n    serializedWindow,\n  }: {\n    win?: CrossDomainWindowType;\n    serializedWindow?: SerializedWindowType;\n    send: SendType;\n  }) {\n    this.actualWindowPromise = new ZalgoPromise();\n    this.serializedWindow =\n      serializedWindow ||\n      getSerializedWindow(this.actualWindowPromise, {\n        send,\n      });\n    globalStore(\"idToProxyWindow\").set(this.getID(), this);\n\n    if (win) {\n      this.setWindow(win, {\n        send,\n      });\n    }\n  }\n\n  getID(): string {\n    return this.serializedWindow.id;\n  }\n\n  getType(): ZalgoPromise<$Values<typeof WINDOW_TYPE>> {\n    return this.serializedWindow.getType();\n  }\n\n  isPopup(): ZalgoPromise<boolean> {\n    return this.getType().then((type) => {\n      return type === WINDOW_TYPE.POPUP;\n    });\n  }\n\n  setLocation(\n    href: string,\n    opts?: SetLocationOptions\n  ): ZalgoPromise<ProxyWindow> {\n    return this.serializedWindow.setLocation(href, opts).then(() => this);\n  }\n\n  getName(): ZalgoPromise<string | null | undefined> {\n    return this.serializedWindow.getName();\n  }\n\n  setName(name: string): ZalgoPromise<ProxyWindow> {\n    return this.serializedWindow.setName(name).then(() => this);\n  }\n\n  close(): ZalgoPromise<ProxyWindow> {\n    return this.serializedWindow.close().then(() => this);\n  }\n\n  focus(): ZalgoPromise<ProxyWindow> {\n    const isPopupPromise = this.isPopup();\n    const getNamePromise = this.getName();\n    const reopenPromise = ZalgoPromise.hash({\n      isPopup: isPopupPromise,\n      name: getNamePromise,\n    }).then(({ isPopup, name }) => {\n      if (isPopup && name) {\n        window.open(\"\", name, \"noopener\");\n      }\n    });\n    const focusPromise = this.serializedWindow.focus();\n    return ZalgoPromise.all([reopenPromise, focusPromise]).then(() => this);\n  }\n\n  isClosed(): ZalgoPromise<boolean> {\n    return this.serializedWindow.isClosed();\n  }\n\n  getWindow(): CrossDomainWindowType | null | undefined {\n    return this.actualWindow;\n  }\n\n  setWindow(\n    win: CrossDomainWindowType,\n    {\n      send,\n    }: {\n      send: SendType;\n    }\n  ) {\n    this.actualWindow = win;\n    this.actualWindowPromise.resolve(this.actualWindow);\n    this.serializedWindow = getSerializedWindow(this.actualWindowPromise, {\n      send,\n      id: this.getID(),\n    });\n    windowStore(\"winToProxyWindow\").set(win, this);\n  }\n\n  awaitWindow(): ZalgoPromise<CrossDomainWindowType> {\n    return this.actualWindowPromise;\n  }\n\n  matchWindow(\n    win: CrossDomainWindowType,\n    {\n      send,\n    }: {\n      send: SendType;\n    }\n  ): ZalgoPromise<boolean> {\n    return ZalgoPromise.try(() => {\n      if (this.actualWindow) {\n        return win === this.actualWindow;\n      }\n\n      return ZalgoPromise.hash({\n        proxyInstanceID: this.getInstanceID(),\n        knownWindowInstanceID: getWindowInstanceID(win, {\n          send,\n        }),\n      }).then(({ proxyInstanceID, knownWindowInstanceID }) => {\n        const match = proxyInstanceID === knownWindowInstanceID;\n\n        if (match) {\n          this.setWindow(win, {\n            send,\n          });\n        }\n\n        return match;\n      });\n    });\n  }\n\n  unwrap(): CrossDomainWindowType | ProxyWindow {\n    return this.actualWindow || this;\n  }\n\n  getInstanceID(): ZalgoPromise<string> {\n    return this.serializedWindow.getInstanceID();\n  }\n\n  shouldClean(): boolean {\n    return Boolean(this.actualWindow && isWindowClosed(this.actualWindow));\n  }\n\n  serialize(): SerializedWindowType {\n    return this.serializedWindow;\n  }\n\n  static unwrap(\n    win: CrossDomainWindowType | ProxyWindow\n  ): CrossDomainWindowType | ProxyWindow {\n    return ProxyWindow.isProxyWindow(win) // $FlowFixMe\n      ? win.unwrap()\n      : win;\n  }\n\n  static serialize(\n    win: CrossDomainWindowType | ProxyWindow,\n    {\n      send,\n    }: {\n      send: SendType;\n    }\n  ): SerializedWindowType {\n    cleanupProxyWindows();\n    return ProxyWindow.toProxyWindow(win, {\n      send,\n    }).serialize();\n  }\n\n  static deserialize(\n    serializedWindow: SerializedWindowType,\n    {\n      send,\n    }: {\n      send: SendType;\n    }\n  ): ProxyWindow {\n    cleanupProxyWindows();\n    return (\n      globalStore(\"idToProxyWindow\").get(serializedWindow.id) ||\n      new ProxyWindow({\n        serializedWindow,\n        send,\n      })\n    );\n  }\n\n  static isProxyWindow(obj: CrossDomainWindowType | ProxyWindow): boolean {\n    // $FlowFixMe\n    return Boolean(obj && !isWindow(obj) && obj.isProxyWindow);\n  }\n\n  static toProxyWindow(\n    win: CrossDomainWindowType | ProxyWindow,\n    {\n      send,\n    }: {\n      send: SendType;\n    }\n  ): ProxyWindow {\n    cleanupProxyWindows();\n\n    if (ProxyWindow.isProxyWindow(win)) {\n      // $FlowFixMe\n      return win;\n    }\n\n    // $FlowFixMe\n    const actualWindow: CrossDomainWindowType = win;\n    return (\n      windowStore(\"winToProxyWindow\").get(actualWindow) ||\n      new ProxyWindow({\n        win: actualWindow,\n        send,\n      })\n    );\n  }\n}\nexport type SerializedWindow = CustomSerializedType<\n  typeof SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW,\n  SerializedWindowType\n>;\nexport function serializeWindow(\n  destination: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher,\n  win: CrossDomainWindowType,\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): SerializedWindow {\n  return serializeType(\n    SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW,\n    ProxyWindow.serialize(win, {\n      send,\n    })\n  );\n}\n\nexport function deserializeWindow(\n  source: CrossDomainWindowType | ProxyWindow,\n  origin: string,\n  win: SerializedWindowType,\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): ProxyWindow {\n  return ProxyWindow.deserialize(win, {\n    send,\n  });\n}\n","import { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport {\n  getDomain,\n  isSameDomain,\n  isOpener,\n  isSameTopWindow,\n  matchDomain,\n  getUserAgent,\n  getDomainFromUrl,\n} from \"@krakenjs/cross-domain-utils\";\nimport { noop } from \"@krakenjs/belter\";\nimport { BRIDGE_NAME_PREFIX } from \"../conf\";\nimport { windowStore } from \"../global\";\nexport function needsBridgeForBrowser(): boolean {\n  if (getUserAgent(window).match(/MSIE|trident|edge\\/12|edge\\/13/i)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function needsBridgeForWin(win: CrossDomainWindowType): boolean {\n  if (!isSameTopWindow(window, win)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function needsBridgeForDomain(\n  domain: string | null | undefined,\n  win: CrossDomainWindowType | null | undefined\n): boolean {\n  if (domain) {\n    if (getDomain() !== getDomainFromUrl(domain)) {\n      return true;\n    }\n  } else if (win) {\n    if (!isSameDomain(win)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function needsBridge({\n  win,\n  domain,\n}: {\n  win?: CrossDomainWindowType;\n  domain?: string;\n}): boolean {\n  if (!needsBridgeForBrowser()) {\n    return false;\n  }\n\n  if (domain && !needsBridgeForDomain(domain, win)) {\n    return false;\n  }\n\n  if (win && !needsBridgeForWin(win)) {\n    return false;\n  }\n\n  return true;\n}\n\nexport function getBridgeName(domain: string): string {\n  domain = domain || getDomainFromUrl(domain);\n  const sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, \"_\");\n  const id = `${BRIDGE_NAME_PREFIX}_${sanitizedDomain}`;\n  return id;\n}\n\nexport function isBridge(): boolean {\n  return Boolean(window.name && window.name === getBridgeName(getDomain()));\n}\n\nexport const documentBodyReady = new ZalgoPromise<HTMLBodyElement>(\n  (resolve) => {\n    if (window.document && window.document.body) {\n      return resolve(window.document.body);\n    }\n\n    const interval = setInterval(() => {\n      if (window.document && window.document.body) {\n        clearInterval(interval);\n        return resolve(window.document.body);\n      }\n    }, 10);\n  }\n);\nexport function registerRemoteWindow(win: CrossDomainWindowType) {\n  const remoteWindowPromises = windowStore(\"remoteWindowPromises\");\n  remoteWindowPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nexport function findRemoteWindow(\n  win: CrossDomainWindowType\n): ZalgoPromise<\n  (\n    remoteWin: CrossDomainWindowType,\n    message: string,\n    remoteDomain: string\n  ) => void\n> {\n  const remoteWindowPromises = windowStore(\"remoteWindowPromises\");\n  const remoteWinPromise = remoteWindowPromises.get(win);\n\n  if (!remoteWinPromise) {\n    throw new Error(`Remote window promise not found`);\n  }\n\n  return remoteWinPromise;\n}\n\ntype SendMessageType = {\n  (arg0: string): void;\n  fireAndForget: (arg0: string) => void;\n};\nexport function registerRemoteSendMessage(\n  win: CrossDomainWindowType,\n  domain: string,\n  sendMessage: SendMessageType\n) {\n  const sendMessageWrapper = (\n    remoteWin: CrossDomainWindowType,\n    remoteDomain: string,\n    message: string\n  ) => {\n    if (remoteWin !== win) {\n      throw new Error(`Remote window does not match window`);\n    }\n\n    if (!matchDomain(remoteDomain, domain)) {\n      throw new Error(\n        `Remote domain ${remoteDomain} does not match domain ${domain}`\n      );\n    }\n\n    sendMessage.fireAndForget(message);\n  };\n\n  findRemoteWindow(win).resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(\n  win: CrossDomainWindowType,\n  err: Error\n) {\n  findRemoteWindow(win).reject(err).catch(noop);\n}\n\nexport function sendBridgeMessage(\n  win: CrossDomainWindowType,\n  domain: string,\n  message: string\n): ZalgoPromise<void> {\n  const messagingChild = isOpener(window, win);\n  const messagingParent = isOpener(win, window);\n\n  if (!messagingChild && !messagingParent) {\n    throw new Error(\n      `Can only send messages to and from parent and popup windows`\n    );\n  }\n\n  return findRemoteWindow(win).then((sendMessage) => {\n    return sendMessage(win, domain, message);\n  });\n}\n","import type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport { matchDomain, getDomain } from \"@krakenjs/cross-domain-utils\";\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { uniqueID, isRegex, arrayFrom } from \"@krakenjs/belter\";\nimport type { CustomSerializedType } from \"@krakenjs/universal-serialize\";\nimport { serializeType } from \"@krakenjs/universal-serialize\";\nimport { MESSAGE_NAME, WILDCARD, SERIALIZATION_TYPE } from \"../conf\";\nimport { windowStore, globalStore } from \"../global\";\nimport type { OnType, SendType, CancelableType } from \"../types\";\nimport { ProxyWindow } from \"./window\";\ntype StoredMethod = {\n  name: string;\n  domain: DomainMatcher;\n  val: (...args: any[]) => any;\n  source: CrossDomainWindowType | ProxyWindow;\n};\n\nfunction addMethod(\n  id: string,\n  val: (...args: any[]) => any,\n  name: string,\n  source: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher\n) {\n  const methodStore = windowStore(\"methodStore\");\n  const proxyWindowMethods = globalStore(\"proxyWindowMethods\");\n\n  if (ProxyWindow.isProxyWindow(source)) {\n    proxyWindowMethods.set(id, {\n      val,\n      name,\n      domain,\n      source,\n    });\n  } else {\n    proxyWindowMethods.del(id);\n    // $FlowFixMe\n    const methods = methodStore.getOrSet(source, () => ({}));\n    methods[id] = {\n      domain,\n      name,\n      val,\n      source,\n    };\n  }\n}\n\nfunction lookupMethod(\n  source: CrossDomainWindowType,\n  id: string\n): StoredMethod | null | undefined {\n  const methodStore = windowStore(\"methodStore\");\n  const proxyWindowMethods = globalStore(\"proxyWindowMethods\");\n  const methods = methodStore.getOrSet(source, () => ({}));\n  return methods[id] || proxyWindowMethods.get(id);\n}\n\nfunction stringifyArguments(args: readonly unknown[] = []): string {\n  return arrayFrom(args)\n    .map((arg) => {\n      if (typeof arg === \"string\") {\n        return `'${arg}'`;\n      }\n\n      if (arg === undefined) {\n        return \"undefined\";\n      }\n\n      if (arg === null) {\n        return \"null\";\n      }\n\n      if (typeof arg === \"boolean\") {\n        return arg.toString();\n      }\n\n      if (Array.isArray(arg)) {\n        return \"[ ... ]\";\n      }\n\n      if (typeof arg === \"object\") {\n        return \"{ ... }\";\n      }\n\n      if (typeof arg === \"function\") {\n        return \"() => { ... }\";\n      }\n\n      return `<${typeof arg}>`;\n    })\n    .join(\", \");\n}\n\nfunction listenForFunctionCalls({\n  on,\n  send,\n}: {\n  on: OnType;\n  send: SendType;\n}): CancelableType {\n  return globalStore(\"builtinListeners\").getOrSet(\"functionCalls\", () => {\n    return on(\n      MESSAGE_NAME.METHOD,\n      {\n        domain: WILDCARD,\n      },\n      ({\n        source,\n        origin,\n        data,\n      }: {\n        source: CrossDomainWindowType;\n        origin: string;\n        data: Record<string, any>;\n      }) => {\n        const { id, name } = data;\n        const meth = lookupMethod(source, id);\n\n        if (!meth) {\n          throw new Error(\n            `Could not find method '${name}' with id: ${data.id} in ${getDomain(\n              window\n            )}`\n          );\n        }\n\n        const { source: methodSource, domain, val } = meth;\n        return ZalgoPromise.try(() => {\n          if (!matchDomain(domain, origin)) {\n            throw new Error(\n              `Method '${data.name}' domain ${JSON.stringify(\n                // $FlowFixMe\n                isRegex(meth.domain) ? meth.domain.source : meth.domain\n              )} does not match origin ${origin} in ${getDomain(window)}`\n            );\n          }\n\n          if (ProxyWindow.isProxyWindow(methodSource)) {\n            // $FlowFixMe\n            return methodSource\n              .matchWindow(source, {\n                send,\n              })\n              .then((match) => {\n                if (!match) {\n                  throw new Error(\n                    `Method call '${\n                      data.name\n                    }' failed - proxy window does not match source in ${getDomain(\n                      window\n                    )}`\n                  );\n                }\n              });\n          }\n        })\n          .then(\n            () => {\n              return val.apply(\n                {\n                  source,\n                  origin,\n                },\n                data.args\n              );\n            },\n            (err) => {\n              return ZalgoPromise.try(() => {\n                if (val.onError) {\n                  return val.onError(err);\n                }\n              }).then(() => {\n                // $FlowFixMe\n                if (err.stack) {\n                  // $FlowFixMe\n                  err.stack = `Remote call to ${name}(${stringifyArguments(\n                    data.args // $FlowFixMe\n                  )}) failed\\n\\n${err.stack}`;\n                }\n\n                throw err;\n              });\n            }\n          )\n          .then((result) => {\n            return {\n              result,\n              id,\n              name,\n            };\n          });\n      }\n    );\n  });\n}\n\nexport type SerializedFunction = CustomSerializedType<\n  typeof SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION,\n  {\n    id: string;\n    name: string;\n  }\n>;\n// eslint-disable-next-line flowtype/require-exact-type\ntype SerializableFunction<T> = {\n  (): ZalgoPromise<T> | T;\n  __id__?: string;\n  __name__?: string;\n};\nexport function serializeFunction<T>(\n  destination: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher,\n  val: SerializableFunction<T>,\n  key: string,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): SerializedFunction {\n  listenForFunctionCalls({\n    on,\n    send,\n  });\n  const id = val.__id__ || uniqueID();\n  destination = ProxyWindow.unwrap(destination);\n  let name = val.__name__ || val.name || key;\n\n  if (\n    typeof name === \"string\" &&\n    typeof name.indexOf === \"function\" &&\n    name.startsWith(\"anonymous::\")\n  ) {\n    name = name.replace(\"anonymous::\", `${key}::`);\n  }\n\n  if (ProxyWindow.isProxyWindow(destination)) {\n    addMethod(id, val, name, destination, domain);\n    // $FlowFixMe\n    destination.awaitWindow().then((win) => {\n      addMethod(id, val, name, win, domain);\n    });\n  } else {\n    addMethod(id, val, name, destination, domain);\n  }\n\n  return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, {\n    id,\n    name,\n  });\n}\n\nexport function deserializeFunction<T>(\n  source: CrossDomainWindowType | ProxyWindow,\n  origin: string,\n  {\n    id,\n    name,\n  }: {\n    id: string;\n    name: string;\n  },\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): (...args: readonly unknown[]) => ZalgoPromise<T> {\n  const getDeserializedFunction = (opts: Record<string, any> = {}) => {\n    function crossDomainFunctionWrapper<X extends unknown>(): ZalgoPromise<X> {\n      let originalStack;\n\n      if (__DEBUG__) {\n        originalStack = new Error(`Original call to ${name}():`).stack;\n      }\n\n      return ProxyWindow.toProxyWindow(source, {\n        send,\n      })\n        .awaitWindow()\n        .then((win) => {\n          const meth = lookupMethod(win, id);\n\n          if (meth && meth.val !== crossDomainFunctionWrapper) {\n            return meth.val.apply(\n              {\n                source: window,\n                origin: getDomain(),\n              },\n              arguments\n            );\n          } else {\n            // $FlowFixMe[method-unbinding]\n            const args = Array.prototype.slice.call(arguments);\n\n            if (opts.fireAndForget) {\n              return send(\n                win,\n                MESSAGE_NAME.METHOD,\n                {\n                  id,\n                  name,\n                  args,\n                },\n                {\n                  domain: origin,\n                  fireAndForget: true,\n                }\n              );\n            } else {\n              return send(\n                win,\n                MESSAGE_NAME.METHOD,\n                {\n                  id,\n                  name,\n                  args,\n                },\n                {\n                  domain: origin,\n                  fireAndForget: false,\n                }\n              ).then((res) => res.data.result);\n            }\n          }\n        })\n        .catch((err) => {\n          // $FlowFixMe\n          if (__DEBUG__ && originalStack && err.stack) {\n            // $FlowFixMe\n            err.stack = `Remote call to ${name}(${stringifyArguments(\n              arguments // $FlowFixMe\n            )}) failed\\n\\n${err.stack}\\n\\n${originalStack}`;\n          }\n\n          throw err;\n        });\n    }\n\n    crossDomainFunctionWrapper.__name__ = name;\n    crossDomainFunctionWrapper.__origin__ = origin;\n    crossDomainFunctionWrapper.__source__ = source;\n    crossDomainFunctionWrapper.__id__ = id;\n    crossDomainFunctionWrapper.origin = origin;\n    return crossDomainFunctionWrapper;\n  };\n\n  const crossDomainFunctionWrapper = getDeserializedFunction();\n  crossDomainFunctionWrapper.fireAndForget = getDeserializedFunction({\n    fireAndForget: true,\n  });\n  return crossDomainFunctionWrapper;\n}\n","import type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport { isWindow } from \"@krakenjs/cross-domain-utils\";\nimport type { Thenable } from \"@krakenjs/universal-serialize\";\nimport { TYPE, serialize, deserialize } from \"@krakenjs/universal-serialize\";\nimport { SERIALIZATION_TYPE } from \"../conf\";\nimport type { OnType, SendType } from \"../types\";\nimport type { SerializedFunction } from \"./function\";\nimport { serializeFunction, deserializeFunction } from \"./function\";\nimport type { SerializedPromise } from \"./promise\";\nimport { serializePromise, deserializePromise } from \"./promise\";\nimport type { SerializedWindow } from \"./window\";\nimport { serializeWindow, deserializeWindow, ProxyWindow } from \"./window\";\nexport function serializeMessage<T extends unknown>(\n  destination: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher,\n  obj: T,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): string {\n  return serialize(obj, {\n    [TYPE.PROMISE]: (val: Thenable, key: string): SerializedPromise =>\n      serializePromise(destination, domain, val, key, {\n        on,\n        send,\n      }),\n    [TYPE.FUNCTION]: (\n      val: (...args: any[]) => any,\n      key: string\n    ): SerializedFunction =>\n      serializeFunction(destination, domain, val, key, {\n        on,\n        send,\n      }),\n    [TYPE.OBJECT]: (\n      val: CrossDomainWindowType\n    ): Record<string, any> | SerializedWindow => {\n      return isWindow(val) || ProxyWindow.isProxyWindow(val)\n        ? serializeWindow(destination, domain, val, {\n            send,\n          })\n        : val;\n    },\n  });\n}\n\nexport function deserializeMessage<T extends unknown>(\n  source: CrossDomainWindowType | ProxyWindow,\n  origin: string,\n  message: string,\n  {\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): T {\n  return deserialize(message, {\n    [SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE]: (serializedPromise) =>\n      deserializePromise(source, origin, serializedPromise),\n    [SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION]: (serializedFunction) =>\n      deserializeFunction(source, origin, serializedFunction, {\n        send,\n      }),\n    [SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW]: (serializedWindow) =>\n      deserializeWindow(source, origin, serializedWindow, {\n        send,\n      }),\n  });\n}\n","import type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport \"@krakenjs/cross-domain-utils\";\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type {\n  CustomSerializedType,\n  Thenable,\n} from \"@krakenjs/universal-serialize\";\nimport { serializeType } from \"@krakenjs/universal-serialize\";\nimport { SERIALIZATION_TYPE } from \"../conf\";\nimport type { OnType, SendType } from \"../types\";\nimport type { SerializedFunction } from \"./function\";\nimport { serializeFunction } from \"./function\";\nimport type { ProxyWindow } from \"./window\";\nexport type SerializedPromise = CustomSerializedType<\n  typeof SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE,\n  {\n    then: SerializedFunction;\n  }\n>;\nexport function serializePromise(\n  destination: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher,\n  val: Thenable,\n  key: string,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): SerializedPromise {\n  return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n    then: serializeFunction(\n      destination,\n      domain,\n      (resolve, reject) => val.then(resolve, reject),\n      key,\n      {\n        on,\n        send,\n      }\n    ),\n  });\n}\n\nexport function deserializePromise<T>(\n  source: CrossDomainWindowType | ProxyWindow,\n  origin: string,\n  {\n    then,\n  }: {\n    then: (...args: any[]) => any;\n  }\n): ZalgoPromise<T> {\n  return new ZalgoPromise(then);\n}\n","import type { $Values } from \"utility-types\";\nimport type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport {\n  isSameDomain,\n  isSameTopWindow,\n  isActuallySameDomain,\n  getActualDomain,\n  getDomain,\n  PROTOCOL,\n} from \"@krakenjs/cross-domain-utils\";\nimport { SEND_STRATEGY, WILDCARD } from \"../../conf\";\nimport { needsGlobalMessagingForBrowser } from \"../../lib\";\nimport { getGlobal } from \"../../global\";\nimport {\n  sendBridgeMessage,\n  needsBridgeForBrowser,\n  isBridge,\n} from \"../../bridge\";\ntype SendStrategies = Record<\n  $Values<typeof SEND_STRATEGY>,\n  (arg0: CrossDomainWindowType, arg1: string, arg2: string) => void\n>;\nexport const SEND_MESSAGE_STRATEGIES: SendStrategies = {};\n\nSEND_MESSAGE_STRATEGIES[SEND_STRATEGY.POST_MESSAGE] = (\n  win: CrossDomainWindowType,\n  serializedMessage: string,\n  domain: string\n) => {\n  if (domain.startsWith(PROTOCOL.FILE)) {\n    domain = WILDCARD;\n  }\n\n  if (__TEST__) {\n    if (\n      needsGlobalMessagingForBrowser() &&\n      isSameTopWindow(window, win) === false\n    ) {\n      return;\n    }\n\n    if (domain.startsWith(PROTOCOL.MOCK)) {\n      if (!isActuallySameDomain(win)) {\n        throw new Error(\n          `Attempting to send message to mock domain ${domain}, but window is actually cross-domain`\n        );\n      }\n\n      // $FlowFixMe\n      const windowDomain = getDomain(win);\n\n      if (windowDomain !== domain) {\n        throw new Error(\n          `Mock domain target ${domain} does not match window domain ${windowDomain}`\n        );\n      }\n\n      // $FlowFixMe\n      domain = getActualDomain(win);\n    }\n  }\n\n  win.postMessage(serializedMessage, domain);\n};\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n  SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.BRIDGE] = (\n    win: CrossDomainWindowType,\n    serializedMessage: string,\n    domain: string\n  ) => {\n    if (!needsBridgeForBrowser() && !isBridge()) {\n      throw new Error(`Bridge not needed for browser`);\n    }\n\n    if (isSameDomain(win)) {\n      throw new Error(\n        `Post message through bridge disabled between same domain windows`\n      );\n    }\n\n    if (isSameTopWindow(window, win) !== false) {\n      throw new Error(\n        `Can only use bridge to communicate between two different windows, not between frames`\n      );\n    }\n\n    sendBridgeMessage(win, domain, serializedMessage);\n  };\n}\n\nif (\n  __POST_ROBOT__.__IE_POPUP_SUPPORT__ ||\n  __POST_ROBOT__.__GLOBAL_MESSAGE_SUPPORT__\n) {\n  SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.GLOBAL] = (\n    win: CrossDomainWindowType,\n    serializedMessage: string\n  ) => {\n    if (!needsGlobalMessagingForBrowser()) {\n      throw new Error(`Global messaging not needed for browser`);\n    }\n\n    if (!isSameDomain(win)) {\n      throw new Error(\n        `Post message through global disabled between different domain windows`\n      );\n    }\n\n    if (isSameTopWindow(window, win) !== false) {\n      throw new Error(\n        `Can only use global to communicate between two different windows, not between frames`\n      );\n    }\n\n    // $FlowFixMe\n    const foreignGlobal = getGlobal(win);\n\n    if (!foreignGlobal) {\n      throw new Error(`Can not find postRobot global on foreign window`);\n    }\n\n    foreignGlobal.receiveMessage({\n      source: window,\n      origin: getDomain(),\n      data: serializedMessage,\n    });\n  };\n}\n","import { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport { isWindowClosed } from \"@krakenjs/cross-domain-utils\";\nimport { stringifyError, noop } from \"@krakenjs/belter\";\nimport { serializeMessage } from \"../../serialize\";\nimport { windowStore, getGlobalKey } from \"../../global\";\nimport type { Message, PackedMessages } from \"../types\";\nimport type { OnType, SendType } from \"../../types\";\nimport { SEND_MESSAGE_STRATEGIES } from \"./strategies\";\n\nfunction packMessages(messages: readonly Message[]): PackedMessages {\n  return {\n    [getGlobalKey()]: messages,\n  };\n}\n\nexport function sendMessage(\n  win: CrossDomainWindowType,\n  domain: string,\n  message: Message,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): ZalgoPromise<void> {\n  return ZalgoPromise.try(() => {\n    const messageBuffer = windowStore();\n    const domainBuffer = messageBuffer.getOrSet(win, () => ({}));\n    domainBuffer.buffer = domainBuffer.buffer || [];\n    domainBuffer.buffer.push(message);\n    domainBuffer.flush =\n      domainBuffer.flush ||\n      ZalgoPromise.flush().then(() => {\n        if (isWindowClosed(win)) {\n          throw new Error(\"Window is closed\");\n        }\n\n        const serializedMessage = serializeMessage(\n          win,\n          domain,\n          packMessages(domainBuffer.buffer || []),\n          {\n            on,\n            send,\n          }\n        );\n        delete domainBuffer.buffer;\n        const strategies = Object.keys(SEND_MESSAGE_STRATEGIES);\n        const errors = [];\n\n        for (const strategyName of strategies) {\n          try {\n            SEND_MESSAGE_STRATEGIES[strategyName](\n              win,\n              serializedMessage,\n              domain\n            );\n          } catch (err) {\n            errors.push(err);\n          }\n        }\n\n        if (errors.length === strategies.length) {\n          throw new Error(\n            `All post-robot messaging strategies failed:\\n\\n${errors\n              .map((err, i) => `${i}. ${stringifyError(err)}`)\n              .join(\"\\n\\n\")}`\n          );\n        }\n      });\n    return domainBuffer.flush.then(() => {\n      delete domainBuffer.flush;\n    });\n  }).then(noop);\n}\n","import type { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport { matchDomain } from \"@krakenjs/cross-domain-utils\";\nimport { isRegex, getOrSet, noop } from \"@krakenjs/belter\";\nimport type { WildCard } from \"../global\";\nimport { getWildcard, globalStore, windowStore } from \"../global\";\nimport { WILDCARD } from \"../conf\";\nimport { ProxyWindow } from \"../serialize/window\";\nexport function resetListeners() {\n  const responseListeners = globalStore(\"responseListeners\");\n  const erroredResponseListeners = globalStore(\"erroredResponseListeners\");\n  responseListeners.reset();\n  erroredResponseListeners.reset();\n}\n\nconst __DOMAIN_REGEX__ = \"__domain_regex__\";\nexport type RequestListenerType = {\n  handler: (arg0: {\n    source: CrossDomainWindowType;\n    origin: string;\n    data: unknown;\n  }) => unknown | ZalgoPromise<unknown>;\n  handleError: (err: unknown) => void;\n};\nexport type ResponseListenerType = {\n  name: string;\n  win: CrossDomainWindowType;\n  domain: DomainMatcher;\n  promise: ZalgoPromise<any>;\n  ack?: boolean | null | undefined;\n  cancelled?: boolean | null | undefined;\n};\nexport function addResponseListener(\n  hash: string,\n  listener: ResponseListenerType\n) {\n  const responseListeners = globalStore(\"responseListeners\");\n  responseListeners.set(hash, listener);\n}\n\nexport function getResponseListener(\n  hash: string\n): ResponseListenerType | null | undefined {\n  const responseListeners = globalStore(\"responseListeners\");\n  return responseListeners.get(hash);\n}\n\nexport function deleteResponseListener(hash: string) {\n  const responseListeners = globalStore(\"responseListeners\");\n  responseListeners.del(hash);\n}\n\nexport function cancelResponseListeners() {\n  const responseListeners = globalStore(\"responseListeners\");\n\n  for (const hash of responseListeners.keys()) {\n    const listener = responseListeners.get(hash);\n\n    if (listener) {\n      listener.cancelled = true;\n    }\n\n    responseListeners.del(hash);\n  }\n}\n\nexport function markResponseListenerErrored(hash: string) {\n  const erroredResponseListeners = globalStore(\"erroredResponseListeners\");\n  erroredResponseListeners.set(hash, true);\n}\n\nexport function isResponseListenerErrored(hash: string): boolean {\n  const erroredResponseListeners = globalStore(\"erroredResponseListeners\");\n  return erroredResponseListeners.has(hash);\n}\n\nexport function getRequestListener({\n  name,\n  win,\n  domain,\n}: {\n  name: string;\n  win: (CrossDomainWindowType | WildCard) | null | undefined;\n  domain: (string | RegExp) | null | undefined;\n}): RequestListenerType | null | undefined {\n  const requestListeners = windowStore(\"requestListeners\");\n\n  if (win === WILDCARD) {\n    win = null;\n  }\n\n  if (domain === WILDCARD) {\n    domain = null;\n  }\n\n  if (!name) {\n    throw new Error(`Name required to get request listener`);\n  }\n\n  for (const winQualifier of [win, getWildcard()]) {\n    if (!winQualifier) {\n      continue;\n    }\n\n    const nameListeners = requestListeners.get(winQualifier);\n\n    if (!nameListeners) {\n      continue;\n    }\n\n    const domainListeners = nameListeners[name];\n\n    if (!domainListeners) {\n      continue;\n    }\n\n    if (domain && typeof domain === \"string\") {\n      if (domainListeners[domain]) {\n        return domainListeners[domain];\n      }\n\n      if (domainListeners[__DOMAIN_REGEX__]) {\n        for (const { regex, listener } of domainListeners[__DOMAIN_REGEX__]) {\n          if (matchDomain(regex, domain)) {\n            return listener;\n          }\n        }\n      }\n    }\n\n    if (domainListeners[WILDCARD]) {\n      return domainListeners[WILDCARD];\n    }\n  }\n}\n\n// eslint-disable-next-line complexity\nexport function addRequestListener(\n  {\n    name,\n    win: winCandidate,\n    domain,\n  }: {\n    name: string;\n    win: (CrossDomainWindowType | WildCard | ProxyWindow) | null | undefined;\n    domain: DomainMatcher | null | undefined;\n  },\n  listener: RequestListenerType\n): {\n  cancel: () => void;\n} {\n  const requestListeners = windowStore(\"requestListeners\");\n\n  if (!name || typeof name !== \"string\") {\n    throw new Error(`Name required to add request listener`);\n  }\n\n  if (\n    winCandidate &&\n    winCandidate !== WILDCARD && // $FlowFixMe\n    ProxyWindow.isProxyWindow(winCandidate)\n  ) {\n    // $FlowFixMe\n    const proxyWin: ProxyWindow = winCandidate;\n    const requestListenerPromise = proxyWin.awaitWindow().then((actualWin) => {\n      return addRequestListener(\n        {\n          name,\n          win: actualWin,\n          domain,\n        },\n        listener\n      );\n    });\n    return {\n      cancel: () => {\n        requestListenerPromise.then(\n          (requestListener) => requestListener.cancel(),\n          noop\n        );\n      },\n    };\n  }\n\n  // $FlowFixMe\n  let win: (CrossDomainWindowType | WildCard) | null | undefined = winCandidate;\n\n  if (Array.isArray(win)) {\n    const listenersCollection = [];\n\n    for (const item of win) {\n      listenersCollection.push(\n        addRequestListener(\n          {\n            name,\n            domain,\n            win: item,\n          },\n          listener\n        )\n      );\n    }\n\n    return {\n      cancel() {\n        for (const cancelListener of listenersCollection) {\n          cancelListener.cancel();\n        }\n      },\n    };\n  }\n\n  if (Array.isArray(domain)) {\n    const listenersCollection = [];\n\n    for (const item of domain) {\n      listenersCollection.push(\n        addRequestListener(\n          {\n            name,\n            win,\n            domain: item,\n          },\n          listener\n        )\n      );\n    }\n\n    return {\n      cancel() {\n        for (const cancelListener of listenersCollection) {\n          cancelListener.cancel();\n        }\n      },\n    };\n  }\n\n  const existingListener = getRequestListener({\n    name,\n    win,\n    domain,\n  });\n\n  if (!win || win === WILDCARD) {\n    win = getWildcard();\n  }\n\n  domain = domain || WILDCARD;\n  const strDomain = domain.toString();\n\n  if (existingListener) {\n    if (win && domain) {\n      throw new Error(\n        `Request listener already exists for ${name} on domain ${domain.toString()} for ${\n          win === getWildcard() ? \"wildcard\" : \"specified\"\n        } window`\n      );\n    } else if (win) {\n      throw new Error(\n        `Request listener already exists for ${name} for ${\n          win === getWildcard() ? \"wildcard\" : \"specified\"\n        } window`\n      );\n    } else if (domain) {\n      throw new Error(\n        `Request listener already exists for ${name} on domain ${domain.toString()}`\n      );\n    } else {\n      throw new Error(`Request listener already exists for ${name}`);\n    }\n  }\n\n  const winNameListeners = requestListeners.getOrSet(win, () => ({}));\n  const winNameDomainListeners = getOrSet(winNameListeners, name, () => ({}));\n  let winNameDomainRegexListeners;\n  let winNameDomainRegexListener;\n\n  if (isRegex(domain)) {\n    winNameDomainRegexListeners = getOrSet(\n      winNameDomainListeners,\n      __DOMAIN_REGEX__,\n      () => []\n    );\n    winNameDomainRegexListener = {\n      regex: domain,\n      listener,\n    };\n    winNameDomainRegexListeners.push(winNameDomainRegexListener);\n  } else {\n    winNameDomainListeners[strDomain] = listener;\n  }\n\n  return {\n    cancel() {\n      delete winNameDomainListeners[strDomain];\n\n      if (winNameDomainRegexListener) {\n        winNameDomainRegexListeners.splice(\n          winNameDomainRegexListeners.indexOf(winNameDomainRegexListener, 1)\n        );\n\n        if (!winNameDomainRegexListeners.length) {\n          delete winNameDomainListeners[__DOMAIN_REGEX__];\n        }\n      }\n\n      if (!Object.keys(winNameDomainListeners).length) {\n        delete winNameListeners[name];\n      }\n\n      if (win && !Object.keys(winNameListeners).length) {\n        requestListeners.del(win);\n      }\n    },\n  };\n}\n","import type { $Values } from \"utility-types\";\nimport { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport {\n  getDomain,\n  isWindowClosed,\n  matchDomain,\n  stringifyDomainPattern,\n} from \"@krakenjs/cross-domain-utils\";\nimport { noop, stringifyError, uniqueID } from \"@krakenjs/belter\";\nimport { MESSAGE_TYPE, MESSAGE_ACK, MESSAGE_NAME } from \"../../conf\";\nimport { sendMessage } from \"../send\";\nimport {\n  getRequestListener,\n  getResponseListener,\n  deleteResponseListener,\n  isResponseListenerErrored,\n} from \"../listeners\";\nimport type {\n  RequestMessage,\n  AckResponseMessage,\n  ResponseMessage,\n} from \"../types\";\nimport type { OnType, SendType } from \"../../types\";\nexport function handleRequest(\n  source: CrossDomainWindowType,\n  origin: string,\n  message: RequestMessage,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): ZalgoPromise<void> {\n  const options = getRequestListener({\n    name: message.name,\n    win: source,\n    domain: origin,\n  });\n  const logName =\n    message.name === MESSAGE_NAME.METHOD &&\n    message.data &&\n    typeof message.data.name === \"string\"\n      ? `${message.data.name}()`\n      : message.name;\n\n  if (__DEBUG__) {\n    // eslint-disable-next-line no-console\n    console.info(\"receive::req\", logName, origin, \"\\n\\n\", message.data);\n  }\n\n  function sendAck(): ZalgoPromise<void> {\n    return ZalgoPromise.flush().then(() => {\n      if (message.fireAndForget || isWindowClosed(source)) {\n        return;\n      }\n\n      try {\n        return sendMessage(\n          source,\n          origin,\n          {\n            id: uniqueID(),\n            origin: getDomain(window),\n            type: MESSAGE_TYPE.ACK,\n            hash: message.hash,\n            name: message.name,\n          },\n          {\n            on,\n            send,\n          }\n        );\n      } catch (err) {\n        throw new Error(\n          `Send ack message failed for ${logName} in ${getDomain()}\\n\\n${stringifyError(\n            err\n          )}`\n        );\n      }\n    });\n  }\n\n  function sendResponse(\n    ack: $Values<typeof MESSAGE_ACK>,\n    data: Record<string, any> | null | undefined,\n    error: unknown | null | undefined\n  ): ZalgoPromise<void> {\n    return ZalgoPromise.flush().then(() => {\n      if (message.fireAndForget || isWindowClosed(source)) {\n        return;\n      }\n\n      if (__DEBUG__) {\n        if (ack === MESSAGE_ACK.SUCCESS) {\n          console.info(\"respond::res\", logName, origin, \"\\n\\n\", data); // eslint-disable-line no-console\n        } else if (ack === MESSAGE_ACK.ERROR) {\n          console.error(\"respond::err\", logName, origin, \"\\n\\n\", error); // eslint-disable-line no-console\n        }\n      }\n\n      try {\n        return sendMessage(\n          source,\n          origin,\n          {\n            id: uniqueID(),\n            origin: getDomain(window),\n            type: MESSAGE_TYPE.RESPONSE,\n            hash: message.hash,\n            name: message.name,\n            ack,\n            data,\n            error,\n          },\n          {\n            on,\n            send,\n          }\n        );\n      } catch (err) {\n        throw new Error(\n          `Send response message failed for ${logName} in ${getDomain()}\\n\\n${stringifyError(\n            err\n          )}`\n        );\n      }\n    });\n  }\n\n  return ZalgoPromise.all([\n    sendAck(),\n    ZalgoPromise.try(() => {\n      if (!options) {\n        throw new Error(\n          `No handler found for post message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`\n        );\n      }\n\n      const data = message.data;\n      return options.handler({\n        source,\n        origin,\n        data,\n      });\n    }).then(\n      (data) => {\n        return sendResponse(MESSAGE_ACK.SUCCESS, data);\n      },\n      (error) => {\n        return sendResponse(MESSAGE_ACK.ERROR, null, error);\n      }\n    ),\n  ])\n    .then(noop)\n    .catch((err) => {\n      if (options && options.handleError) {\n        options.handleError(err);\n        return;\n      } else {\n        throw err;\n      }\n    });\n}\n\nexport function handleAck(\n  source: CrossDomainWindowType,\n  origin: string,\n  message: AckResponseMessage\n) {\n  if (isResponseListenerErrored(message.hash)) {\n    return;\n  }\n\n  const options = getResponseListener(message.hash);\n\n  if (!options) {\n    throw new Error(\n      `No handler found for post message ack for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`\n    );\n  }\n\n  try {\n    if (!matchDomain(options.domain, origin)) {\n      throw new Error(\n        `Ack origin ${origin} does not match domain ${options.domain.toString()}`\n      );\n    }\n\n    if (source !== options.win) {\n      throw new Error(`Ack source does not match registered window`);\n    }\n  } catch (err) {\n    options.promise.reject(err);\n  }\n\n  options.ack = true;\n}\n\nexport function handleResponse(\n  source: CrossDomainWindowType,\n  origin: string,\n  message: ResponseMessage\n): void | ZalgoPromise<void> {\n  if (isResponseListenerErrored(message.hash)) {\n    return;\n  }\n\n  const options = getResponseListener(message.hash);\n\n  if (!options) {\n    throw new Error(\n      `No handler found for post message response for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`\n    );\n  }\n\n  if (!matchDomain(options.domain, origin)) {\n    throw new Error(\n      `Response origin ${origin} does not match domain ${stringifyDomainPattern(\n        options.domain\n      )}`\n    );\n  }\n\n  if (source !== options.win) {\n    throw new Error(`Response source does not match registered window`);\n  }\n\n  deleteResponseListener(message.hash);\n  const logName =\n    message.name === MESSAGE_NAME.METHOD &&\n    message.data &&\n    typeof message.data.name === \"string\"\n      ? `${message.data.name}()`\n      : message.name;\n\n  if (message.ack === MESSAGE_ACK.ERROR) {\n    if (__DEBUG__) {\n      console.error(\"receive::err\", logName, origin, \"\\n\\n\", message.error); // eslint-disable-line no-console\n    }\n\n    options.promise.reject(message.error);\n  } else if (message.ack === MESSAGE_ACK.SUCCESS) {\n    if (__DEBUG__) {\n      console.info(\"receive::res\", logName, origin, \"\\n\\n\", message.data); // eslint-disable-line no-console\n    }\n\n    options.promise.resolve({\n      source,\n      origin,\n      data: message.data,\n    });\n  }\n}\n","import { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport {\n  isWindowClosed,\n  getDomain,\n  isSameTopWindow,\n  PROTOCOL,\n} from \"@krakenjs/cross-domain-utils\";\nimport { addEventListener, noop } from \"@krakenjs/belter\";\nimport type { Message } from \"../types\";\nimport { MESSAGE_TYPE } from \"../../conf\";\nimport { markWindowKnown, needsGlobalMessagingForBrowser } from \"../../lib\";\nimport { deserializeMessage } from \"../../serialize\";\nimport { getGlobal, globalStore, getGlobalKey } from \"../../global\";\nimport type {\n  OnType,\n  SendType,\n  MessageEvent,\n  CancelableType,\n} from \"../../types\";\nimport { handleRequest, handleResponse, handleAck } from \"./types\";\n\nfunction deserializeMessages(\n  message: string,\n  source: CrossDomainWindowType,\n  origin: string,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n): readonly Message[] | null | undefined {\n  let parsedMessage;\n\n  try {\n    parsedMessage = deserializeMessage(source, origin, message, {\n      on,\n      send,\n    });\n  } catch (err) {\n    return;\n  }\n\n  if (!parsedMessage) {\n    return;\n  }\n\n  if (typeof parsedMessage !== \"object\" || parsedMessage === null) {\n    return;\n  }\n\n  const parseMessages = parsedMessage[getGlobalKey()];\n\n  if (!Array.isArray(parseMessages)) {\n    return;\n  }\n\n  return parseMessages;\n}\n\nexport function receiveMessage(\n  event: MessageEvent,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n) {\n  const receivedMessages = globalStore(\"receivedMessages\");\n\n  try {\n    if (!window || window.closed || !event.source) {\n      return;\n    }\n  } catch (err) {\n    return;\n  }\n\n  let { source, origin, data } = event;\n\n  if (__TEST__) {\n    if (isWindowClosed(source)) {\n      return;\n    }\n\n    // $FlowFixMe\n    origin = getDomain(source);\n  }\n\n  const messages = deserializeMessages(data, source, origin, {\n    on,\n    send,\n  });\n\n  if (!messages) {\n    return;\n  }\n\n  markWindowKnown(source);\n\n  for (const message of messages) {\n    if (receivedMessages.has(message.id)) {\n      return;\n    }\n\n    receivedMessages.set(message.id, true);\n\n    if (isWindowClosed(source) && !message.fireAndForget) {\n      return;\n    }\n\n    if (message.origin.startsWith(PROTOCOL.FILE)) {\n      origin = `${PROTOCOL.FILE}//`;\n    }\n\n    try {\n      if (message.type === MESSAGE_TYPE.REQUEST) {\n        handleRequest(source, origin, message, {\n          on,\n          send,\n        });\n      } else if (message.type === MESSAGE_TYPE.RESPONSE) {\n        handleResponse(source, origin, message);\n      } else if (message.type === MESSAGE_TYPE.ACK) {\n        handleAck(source, origin, message);\n      }\n    } catch (err) {\n      setTimeout(() => {\n        throw err;\n      }, 0);\n    }\n  }\n}\n\nexport function setupGlobalReceiveMessage({\n  on,\n  send,\n}: {\n  on: OnType;\n  send: SendType;\n}) {\n  const global = getGlobal();\n\n  global.receiveMessage =\n    global.receiveMessage ||\n    ((message) => {\n      receiveMessage(message, {\n        on,\n        send,\n      });\n    });\n}\n\ntype ListenerEvent = {\n  source: CrossDomainWindowType;\n  origin: string;\n  data: string;\n  sourceElement: CrossDomainWindowType;\n  originalEvent?: {\n    origin: string;\n  };\n};\nexport function messageListener(\n  event: ListenerEvent,\n  {\n    on,\n    send,\n  }: {\n    on: OnType;\n    send: SendType;\n  }\n) {\n  ZalgoPromise.try(() => {\n    try {\n      noop(event.source);\n    } catch (err) {\n      return;\n    }\n\n    const source = event.source || event.sourceElement;\n    let origin =\n      event.origin || (event.originalEvent && event.originalEvent.origin);\n    const data = event.data;\n\n    if (origin === \"null\") {\n      origin = `${PROTOCOL.FILE}//`;\n    }\n\n    if (!source) {\n      return;\n    }\n\n    if (!origin) {\n      throw new Error(`Post message did not have origin domain`);\n    }\n\n    if (__TEST__) {\n      if (\n        needsGlobalMessagingForBrowser() &&\n        isSameTopWindow(source, window) === false\n      ) {\n        return;\n      }\n    }\n\n    receiveMessage(\n      {\n        source,\n        origin,\n        data,\n      },\n      {\n        on,\n        send,\n      }\n    );\n  });\n}\n\nexport function listenForMessages({\n  on,\n  send,\n}: {\n  on: OnType;\n  send: SendType;\n}): CancelableType {\n  return globalStore().getOrSet(\"postMessageListener\", () => {\n    return addEventListener(window, \"message\", (event) => {\n      // $FlowFixMe\n      messageListener(event, {\n        on,\n        send,\n      });\n    });\n  });\n}\n\nexport function stopListenForMessages() {\n  const listener = globalStore().get(\"postMessageListener\");\n\n  if (listener) {\n    listener.cancel();\n  }\n}\n","import { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport { addRequestListener } from \"../drivers\";\nimport { WILDCARD } from \"../conf\";\nimport type { ServerOptionsType, HandlerType, CancelableType } from \"../types\";\n\nconst getDefaultServerOptions = (): ServerOptionsType => {\n  // $FlowFixMe\n  return {};\n};\n\nexport function on(\n  name: string,\n  options: ServerOptionsType | HandlerType,\n  handler?: HandlerType\n): CancelableType {\n  if (!name) {\n    throw new Error(\"Expected name\");\n  }\n\n  options = options || getDefaultServerOptions();\n\n  if (typeof options === \"function\") {\n    handler = options;\n    options = getDefaultServerOptions();\n  }\n\n  if (!handler) {\n    throw new Error(\"Expected handler\");\n  }\n\n  const winOrProxyWin = options.window;\n  const domain = options.domain || WILDCARD;\n  const successHandler = handler || options.handler;\n\n  const errorHandler =\n    options.errorHandler ||\n    ((err) => {\n      throw err;\n    });\n\n  const requestListener = addRequestListener(\n    {\n      name,\n      win: winOrProxyWin,\n      domain,\n    },\n    {\n      handler: successHandler,\n      handleError: errorHandler,\n    }\n  );\n  return {\n    cancel() {\n      requestListener.cancel();\n    },\n  };\n}\n\ntype CancelableZalgoPromise<T> = ZalgoPromise<T> & {\n  cancel: () => void;\n};\nexport function once(\n  name: string,\n  options?: ServerOptionsType | HandlerType,\n  handler?: HandlerType\n): CancelableZalgoPromise<{\n  source: unknown;\n  origin: string;\n  data: Record<string, any>;\n}> {\n  options = options || getDefaultServerOptions();\n\n  if (typeof options === \"function\") {\n    handler = options;\n    options = getDefaultServerOptions();\n  }\n\n  const promise = new ZalgoPromise();\n  let listener; // eslint-disable-line prefer-const\n\n  options.errorHandler = (err) => {\n    listener.cancel();\n    promise.reject(err);\n  };\n\n  listener = on(name, options, (event) => {\n    listener.cancel();\n    promise.resolve(event);\n\n    if (handler) {\n      return handler(event);\n    }\n  });\n  // $FlowFixMe\n  promise.cancel = listener.cancel;\n  // $FlowFixMe\n  return promise;\n}\n","import { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport {\n  isAncestor,\n  isWindowClosed,\n  getDomain,\n  matchDomain,\n} from \"@krakenjs/cross-domain-utils\";\nimport {\n  uniqueID,\n  isRegex,\n  noop,\n  safeInterval,\n  stringify,\n  stringifyError,\n} from \"@krakenjs/belter\";\nimport {\n  CHILD_WINDOW_TIMEOUT,\n  MESSAGE_TYPE,\n  WILDCARD,\n  MESSAGE_NAME,\n  ACK_TIMEOUT,\n  RES_TIMEOUT,\n  ACK_TIMEOUT_KNOWN,\n  RESPONSE_CYCLE_TIME,\n} from \"../conf\";\nimport type { ResponseListenerType } from \"../drivers\";\nimport {\n  sendMessage,\n  addResponseListener,\n  deleteResponseListener,\n  markResponseListenerErrored,\n} from \"../drivers\";\nimport { awaitWindowHello, sayHello, isWindowKnown } from \"../lib\";\nimport { windowStore } from \"../global\";\nimport { ProxyWindow } from \"../serialize/window\";\nimport type { SendType } from \"../types\";\nimport { on } from \"./on\";\n\nfunction validateOptions(\n  name: string,\n  win: CrossDomainWindowType,\n  domain: DomainMatcher | null | undefined\n) {\n  if (!name) {\n    throw new Error(\"Expected name\");\n  }\n\n  if (domain) {\n    if (\n      typeof domain !== \"string\" &&\n      !Array.isArray(domain) &&\n      !isRegex(domain)\n    ) {\n      throw new TypeError(\n        `Can not send ${name}. Expected domain ${JSON.stringify(\n          domain\n        )} to be a string, array, or regex`\n      );\n    }\n  }\n\n  if (isWindowClosed(win)) {\n    throw new Error(`Can not send ${name}. Target window is closed`);\n  }\n}\n\nfunction normalizeDomain(\n  win: CrossDomainWindowType,\n  targetDomain: DomainMatcher,\n  actualDomain: string | null | undefined,\n  {\n    send,\n  }: {\n    send: SendType;\n  }\n): ZalgoPromise<string> {\n  return ZalgoPromise.try(() => {\n    if (typeof targetDomain === \"string\") {\n      return targetDomain;\n    }\n\n    return ZalgoPromise.try(() => {\n      return (\n        actualDomain ||\n        sayHello(win, {\n          send,\n        }).then(({ domain }) => domain)\n      );\n    }).then((normalizedDomain) => {\n      if (!matchDomain(targetDomain, targetDomain)) {\n        throw new Error(\n          `Domain ${stringify(targetDomain)} does not match ${stringify(\n            targetDomain\n          )}`\n        );\n      }\n\n      return normalizedDomain;\n    });\n  });\n}\n\nexport const send: SendType = (winOrProxyWin, name, data, options) => {\n  options = options || {};\n  const domainMatcher = options.domain || WILDCARD;\n  const responseTimeout = options.timeout || RES_TIMEOUT;\n  const childTimeout = options.timeout || CHILD_WINDOW_TIMEOUT;\n  const fireAndForget = options.fireAndForget || false;\n  return ProxyWindow.toProxyWindow(winOrProxyWin, {\n    send,\n  })\n    .awaitWindow()\n    .then((win) => {\n      // $FlowFixMe\n      return ZalgoPromise.try(() => {\n        validateOptions(name, win, domainMatcher);\n\n        if (isAncestor(window, win)) {\n          return awaitWindowHello(win, childTimeout);\n        }\n      })\n        .then(({ domain: actualDomain } = {}) => {\n          return normalizeDomain(win, domainMatcher, actualDomain, {\n            send,\n          });\n        })\n        .then((targetDomain) => {\n          const domain = targetDomain;\n          const logName =\n            name === MESSAGE_NAME.METHOD &&\n            data &&\n            typeof data.name === \"string\"\n              ? `${data.name}()`\n              : name;\n\n          if (__DEBUG__) {\n            console.info(\"send::req\", logName, domain, \"\\n\\n\", data); // eslint-disable-line no-console\n          }\n\n          const promise = new ZalgoPromise();\n          const hash = `${name}_${uniqueID()}`;\n\n          if (!fireAndForget) {\n            const responseListener: ResponseListenerType = {\n              name,\n              win,\n              domain,\n              promise,\n            };\n            addResponseListener(hash, responseListener);\n            const reqPromises = windowStore(\"requestPromises\").getOrSet(\n              win,\n              () => []\n            );\n            reqPromises.push(promise);\n            promise.catch(() => {\n              markResponseListenerErrored(hash);\n              deleteResponseListener(hash);\n            });\n            const totalAckTimeout = isWindowKnown(win)\n              ? ACK_TIMEOUT_KNOWN\n              : ACK_TIMEOUT;\n            const totalResTimeout = responseTimeout;\n            let ackTimeout = totalAckTimeout;\n            let resTimeout = totalResTimeout;\n            const interval = safeInterval(() => {\n              if (isWindowClosed(win)) {\n                return promise.reject(\n                  new Error(\n                    `Window closed for ${name} before ${\n                      responseListener.ack ? \"response\" : \"ack\"\n                    }`\n                  )\n                );\n              }\n\n              if (responseListener.cancelled) {\n                return promise.reject(\n                  new Error(`Response listener was cancelled for ${name}`)\n                );\n              }\n\n              ackTimeout = Math.max(ackTimeout - RESPONSE_CYCLE_TIME, 0);\n\n              if (resTimeout !== -1) {\n                resTimeout = Math.max(resTimeout - RESPONSE_CYCLE_TIME, 0);\n              }\n\n              if (!responseListener.ack && ackTimeout === 0) {\n                return promise.reject(\n                  new Error(\n                    `No ack for postMessage ${logName} in ${getDomain()} in ${totalAckTimeout}ms`\n                  )\n                );\n              } else if (resTimeout === 0) {\n                return promise.reject(\n                  new Error(\n                    `No response for postMessage ${logName} in ${getDomain()} in ${totalResTimeout}ms`\n                  )\n                );\n              }\n            }, RESPONSE_CYCLE_TIME);\n            promise\n              .finally(() => {\n                interval.cancel();\n                reqPromises.splice(reqPromises.indexOf(promise, 1));\n              })\n              .catch(noop);\n          }\n\n          return sendMessage(\n            win,\n            domain,\n            {\n              id: uniqueID(),\n              origin: getDomain(window),\n              type: MESSAGE_TYPE.REQUEST,\n              hash,\n              name,\n              data,\n              fireAndForget,\n            },\n            {\n              on,\n              send,\n            }\n          ).then(\n            () => {\n              return fireAndForget ? promise.resolve() : promise;\n            },\n            (err) => {\n              throw new Error(\n                `Send request message failed for ${logName} in ${getDomain()}\\n\\n${stringifyError(\n                  err\n                )}`\n              );\n            }\n          );\n        });\n    });\n};\n","export const BRIDGE_TIMEOUT = 5000;\nexport const CHILD_WINDOW_TIMEOUT = 5000;\nexport const ACK_TIMEOUT = 2000;\nexport const ACK_TIMEOUT_KNOWN = 10000;\nexport const RES_TIMEOUT: number = __TEST__ ? 2000 : -1;\nexport const RESPONSE_CYCLE_TIME = 500;\n","import type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport { initHello } from \"./lib\";\nimport {\n  listenForMessages,\n  stopListenForMessages,\n  receiveMessage,\n  setupGlobalReceiveMessage,\n  cancelResponseListeners,\n} from \"./drivers\";\nimport { getGlobal, deleteGlobal } from \"./global\";\nimport { on, send } from \"./public\";\nimport { setupBridge } from \"./bridge\";\nimport {\n  serializeMessage as internalSerializeMessage,\n  deserializeMessage as internalDeserializeMessage,\n  ProxyWindow,\n} from \"./serialize\";\nexport function serializeMessage<T>(\n  destination: CrossDomainWindowType | ProxyWindow,\n  domain: DomainMatcher,\n  obj: T\n): string {\n  return internalSerializeMessage(destination, domain, obj, {\n    on,\n    send,\n  });\n}\n\nexport function deserializeMessage<T extends unknown>(\n  source: CrossDomainWindowType | ProxyWindow,\n  origin: string,\n  message: string\n): T {\n  return internalDeserializeMessage(source, origin, message, {\n    on,\n    send,\n  });\n}\n\nexport function createProxyWindow(win?: CrossDomainWindowType): ProxyWindow {\n  return new ProxyWindow({\n    send,\n    win,\n  });\n}\n\nexport function toProxyWindow(\n  win: CrossDomainWindowType | ProxyWindow\n): ProxyWindow {\n  return ProxyWindow.toProxyWindow(win, {\n    send,\n  });\n}\n\nexport function setup() {\n  if (!getGlobal().initialized) {\n    getGlobal().initialized = true;\n    setupGlobalReceiveMessage({\n      on,\n      send,\n    });\n    listenForMessages({\n      on,\n      send,\n    });\n\n    if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n      setupBridge({\n        on,\n        send,\n        receiveMessage,\n      });\n    }\n\n    initHello({\n      on,\n      send,\n    });\n  }\n}\n\nexport function destroy() {\n  cancelResponseListeners();\n  stopListenForMessages();\n  deleteGlobal();\n}\n","import type { ZalgoPromise } from \"@krakenjs/zalgo-promise\";\nimport type {\n  CrossDomainWindowType,\n  DomainMatcher,\n} from \"@krakenjs/cross-domain-utils\";\nimport type { ProxyWindow } from \"./serialize/window\";\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CancelableType = {\n  cancel: () => void;\n};\nexport type ErrorHandlerType = (err: unknown) => void;\nexport type HandlerType = (arg0: {\n  source: CrossDomainWindowType;\n  origin: string;\n  data: any; // eslint-disable-line flowtype/no-weak-types\n}) => void | any | ZalgoPromise<any>;\n// eslint-disable-line flowtype/no-weak-types\nexport type ServerOptionsType = {\n  handler?: HandlerType | null | undefined;\n  errorHandler?: ErrorHandlerType | null | undefined;\n  window?: CrossDomainWindowType | ProxyWindow;\n  name?: string | null | undefined;\n  domain?: DomainMatcher | null | undefined;\n  once?: boolean | null | undefined;\n  errorOnClose?: boolean | null | undefined;\n};\nexport type OnType = (\n  name: string,\n  options: ServerOptionsType | HandlerType,\n  handler: HandlerType | null | undefined\n) => CancelableType;\ntype RegularRequestOptionsType = {\n  domain?: DomainMatcher | null | undefined;\n  fireAndForget?: false;\n  timeout?: number | null | undefined;\n};\ntype FireAndForgetRequestOptionsType = {\n  domain?: DomainMatcher | null | undefined;\n  fireAndForget: true;\n  timeout?: number | null | undefined;\n};\nexport type RequestOptionsType =\n  | RegularRequestOptionsType\n  | FireAndForgetRequestOptionsType;\nexport type ResponseMessageEvent = {\n  source: CrossDomainWindowType;\n  origin: string;\n  data: Record<string, any>;\n};\ntype RegularSendType = (\n  win: CrossDomainWindowType | ProxyWindow,\n  name: string,\n  data?: Record<string, any>,\n  options?: RegularRequestOptionsType\n) => ZalgoPromise<ResponseMessageEvent>;\ntype FireAndForgetSendType = (\n  win: CrossDomainWindowType | ProxyWindow,\n  name: string,\n  data?: Record<string, any>,\n  options?: FireAndForgetRequestOptionsType\n) => ZalgoPromise<void>;\nexport type SendType = RegularSendType & FireAndForgetSendType;\nexport type MessageEvent = {\n  source: CrossDomainWindowType;\n  origin: string;\n  data: string;\n};\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CrossDomainFunctionType<A, R> = {\n  (...args: A): ZalgoPromise<R>;\n  fireAndForget: (...args: A) => ZalgoPromise<void>;\n  __id__?: string;\n  __name__?: string;\n};\nexport type ReceiveMessageType = (\n  arg0: MessageEvent,\n  arg1: {\n    on: OnType;\n    send: SendType;\n  }\n) => void;\n","import type { CrossDomainWindowType } from \"@krakenjs/cross-domain-utils\";\nimport { isWindowClosed } from \"@krakenjs/cross-domain-utils\";\nimport { noop } from \"@krakenjs/belter\";\nimport { windowStore } from \"./global\";\nexport function cleanUpWindow(win: CrossDomainWindowType) {\n  const requestPromises = windowStore(\"requestPromises\");\n\n  for (const promise of requestPromises.get(win, [])) {\n    promise\n      .reject(\n        new Error(\n          `Window ${\n            isWindowClosed(win) ? \"closed\" : \"cleaned up\"\n          } before response`\n        )\n      )\n      .catch(noop);\n  }\n}\n","import { setup } from \"./setup\";\nimport {\n  setupBridge,\n  openBridge,\n  linkWindow,\n  linkUrl,\n  isBridge,\n  needsBridge,\n  needsBridgeForBrowser,\n  hasBridge,\n  needsBridgeForWin,\n  needsBridgeForDomain,\n  destroyBridges,\n} from \"./bridge\";\nexport { ZalgoPromise as Promise } from \"@krakenjs/zalgo-promise\";\nexport * from \"./types\";\nexport { ProxyWindow } from \"./serialize\";\nexport {\n  setup,\n  destroy,\n  serializeMessage,\n  deserializeMessage,\n  createProxyWindow,\n  toProxyWindow,\n} from \"./setup\";\nexport { on, once, send } from \"./public\";\nexport { markWindowKnown } from \"./lib\";\nexport { cleanUpWindow } from \"./clean\";\n// @ts-expect-error\nexport let bridge;\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n  bridge = {\n    setupBridge,\n    openBridge,\n    linkWindow,\n    linkUrl,\n    isBridge,\n    needsBridge,\n    needsBridgeForBrowser,\n    hasBridge,\n    needsBridgeForWin,\n    needsBridgeForDomain,\n    destroyBridges,\n  };\n}\n\nif (__POST_ROBOT__.__AUTO_SETUP__) {\n  setup();\n}\n"],"sourceRoot":""}