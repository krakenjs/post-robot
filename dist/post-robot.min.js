!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("postRobot",[],r):"object"==typeof exports?exports.postRobot=r():e.postRobot=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=25)}([function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(21);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=t(10);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,r,t){"use strict";function n(e){var r=e.location;if(!r)throw new Error("Can not read window location");var t=r.protocol;if(!t)throw new Error("Can not read window protocol");if(t===Y.FILE_PROTOCOL)return"file://";var n=r.host;if(!n)throw new Error("Can not read window host");return t+"//"+n}function o(e){e=e||window;var r=n(e);return r&&e.mockDomain&&0===e.mockDomain.indexOf(Y.MOCK_PROTOCOL)?e.mockDomain:r}function i(e){try{if(!e.location.href)return!0;if("about:blank"===e.location.href)return!0}catch(e){}return!1}function a(e){try{var r=Object.getOwnPropertyDescriptor(e,"location");if(r&&!1===r.enumerable)return!1}catch(e){}try{if(i(e))return!0;if(n(e)===n(window))return!0}catch(e){}return!1}function s(e){if(!a(e))return!1;try{if(i(e))return!0;if(o(window)===o(e))return!0}catch(e){}return!1}function u(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){return}}function c(e){if(e&&!u(e))try{return e.opener}catch(e){return}}function f(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(e){}return r}function l(e,r){if(!e||!r)return!1;var t=u(r);return t?t===e:-1!==f(r).indexOf(e)}function d(e){var r=[],t=void 0;try{t=e.frames}catch(r){t=e}var n=void 0;try{n=t.length}catch(e){}if(0===n)return r;if(n){for(var o=0;o<n;o++){var i=void 0;try{i=t[o]}catch(e){continue}r.push(i)}return r}for(var a=0;a<100;a++){var s=void 0;try{s=t[a]}catch(e){return r}if(!s)return r;r.push(s)}return r}function v(e){for(var r=[],t=d(e),n=Array.isArray(t),o=0,t=n?t:t[Symbol.iterator]();;){var i;if(n){if(o>=t.length)break;i=t[o++]}else{if(o=t.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var s=v(a),u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var f;if(u){if(c>=s.length)break;f=s[c++]}else{if(c=s.next(),c.done)break;f=c.value}var l=f;r.push(l)}}return r}function p(e){var r=v(e);r.push(e);for(var t=f(e),n=Array.isArray(t),o=0,t=n?t:t[Symbol.iterator]();;){var i;if(n){if(o>=t.length)break;i=t[o++]}else{if(o=t.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var s=d(a),u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var l;if(u){if(c>=s.length)break;l=s[c++]}else{if(c=s.next(),c.done)break;l=c.value}var p=l;-1===r.indexOf(p)&&r.push(p)}}return r}function h(e){if(e){try{if(e.top)return e.top}catch(e){}if(u(e)===e)return e;try{if(l(window,e))return window.top}catch(e){}try{if(l(e,window))return window.top}catch(e){}for(var r=v(e),t=Array.isArray(r),n=0,r=t?r:r[Symbol.iterator]();;){var o;if(t){if(n>=r.length)break;o=r[n++]}else{if(n=r.next(),n.done)break;o=n.value}var i=o;try{if(i.top)return i.top}catch(e){}if(u(i)===i)return i}}}function y(e){return e===h(e)}function m(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var r=e.ownerDocument;return!(!r||!r.body||r.body.contains(e))}function S(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||"Call was rejected by callee.\r\n"!==e.message}if(r&&s(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}try{var t=Z.indexOf(e);if(-1!==t){var n=B[t];if(n&&m(n))return!0}}catch(e){}return!1}function w(){for(var e=0;e<B.length;e++)m(B[e])&&(B.splice(e,1),Z.splice(e,1));for(var r=0;r<Z.length;r++)S(Z[r])&&(B.splice(r,1),Z.splice(r,1))}function O(e){if(w(),e&&e.contentWindow)try{Z.push(e.contentWindow),B.push(e)}catch(e){}}function g(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function E(e,r){for(var t=d(e),n=t,o=Array.isArray(n),i=0,n=o?n:n[Symbol.iterator]();;){var a;if(o){if(i>=n.length)break;a=n[i++]}else{if(i=n.next(),i.done)break;a=i.value}var u=a;try{if(s(u)&&u.name===r&&-1!==t.indexOf(u))return u}catch(e){}}try{if(-1!==t.indexOf(e.frames[r]))return e.frames[r]}catch(e){}try{if(-1!==t.indexOf(e[r]))return e[r]}catch(e){}}function b(e,r){var t=E(e,r);if(t)return t;for(var n=d(e),o=Array.isArray(n),i=0,n=o?n:n[Symbol.iterator]();;){var a;if(o){if(i>=n.length)break;a=n[i++]}else{if(i=n.next(),i.done)break;a=i.value}var s=a,u=b(s,r);if(u)return u}}function _(e,r){return E(e,r)||b(h(e),r)}function T(e,r){var t=u(r);if(t)return t===e;for(var n=d(e),o=Array.isArray(n),i=0,n=o?n:n[Symbol.iterator]();;){var a;if(o){if(i>=n.length)break;a=n[i++]}else{if(i=n.next(),i.done)break;a=i.value}if(a===r)return!0}return!1}function A(e,r){return e===c(r)}function P(e){e=e||window;var r=c(e);if(r)return r;var t=u(e);return t||void 0}function N(e){for(var r=[],t=e;t;)(t=P(t))&&r.push(t);return r}function M(e,r){var t=P(r);if(t)return t===e;if(r===e)return!1;if(h(r)===r)return!1;for(var n=d(e),o=Array.isArray(n),i=0,n=o?n:n[Symbol.iterator]();;){var a;if(o){if(i>=n.length)break;a=n[i++]}else{if(i=n.next(),i.done)break;a=i.value}if(a===r)return!0}return!1}function C(){return Boolean(c(window))}function j(){return Boolean(u(window))}function R(){return Boolean(!j()&&!C())}function k(e,r){for(var t=e,n=Array.isArray(t),o=0,t=n?t:t[Symbol.iterator]();;){var i;if(n){if(o>=t.length)break;i=t[o++]}else{if(o=t.next(),o.done)break;i=o.value}for(var a=i,s=r,u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var f;if(u){if(c>=s.length)break;f=s[c++]}else{if(c=s.next(),c.done)break;f=c.value}if(a===f)return!0}}}function W(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,r=0;e;)(e=u(e))&&(r+=1);return r}function L(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=0;t<r;t++)e=u(e);return e}function D(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return L(e,W(e)-r)}function I(e,r){var t=h(e),n=h(r);try{if(t&&n)return t===n}catch(e){}var o=p(e),i=p(r);if(k(o,i))return!0;var a=c(t),s=c(n);return(!a||!k(p(a),i))&&((!s||!k(p(s),o))&&void 0)}function x(e,r){if("string"==typeof e){if("string"==typeof r)return e===Y.WILDCARD||r===e;if((0,q.isRegex)(r))return!1;if(Array.isArray(r))return!1}return(0,q.isRegex)(e)?(0,q.isRegex)(r)?e.toString()===r.toString():!Array.isArray(r)&&Boolean(r.match(e)):!!Array.isArray(e)&&(Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):!(0,q.isRegex)(r)&&e.some(function(e){return x(e,r)}))}function G(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):o()}function F(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,o=void 0;return function i(){if(S(e))return o&&clearTimeout(o),r();n<=0?clearTimeout(o):(n-=t,o=setTimeout(i,t))}(),{cancel:function(){o&&clearTimeout(o)}}}function U(e){try{if(e&&e.self===e)return!0}catch(e){}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.getActualDomain=n,r.getDomain=o,r.isBlankDomain=i,r.isActuallySameDomain=a,r.isSameDomain=s,r.getParent=u,r.getOpener=c,r.getParents=f,r.isAncestorParent=l,r.getFrames=d,r.getAllChildFrames=v,r.getAllFramesInWindow=p,r.getTop=h,r.isTop=y,r.isFrameWindowClosed=m,r.isWindowClosed=S,r.linkFrameWindow=O,r.getUserAgent=g,r.getFrameByName=E,r.findChildFrameByName=b,r.findFrameByName=_,r.isParent=T,r.isOpener=A,r.getAncestor=P,r.getAncestors=N,r.isAncestor=M,r.isPopup=C,r.isIframe=j,r.isFullpage=R,r.getDistanceFromTop=W,r.getNthParent=L,r.getNthParentFromTop=D,r.isSameTopWindow=I,r.matchDomain=x,r.getDomainFromUrl=G,r.onCloseWindow=F,r.isWindow=U;var q=t(16),Y={MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",WILDCARD:"*"},Z=[],B=[]},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(18);Object.defineProperty(r,"ZalgoPromise",{enumerable:!0,get:function(){return n.ZalgoPromise}})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.global=void 0;var n=t(0);(r.global=window[n.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[n.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{}).registerSelf=function(){}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(7);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=t(9);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(26);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=t(27);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(13);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(n);r.default=o},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(22);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=t(12);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(11);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,r,t){"use strict";function n(e){if(!e)return"<unknown error: "+Object.prototype.toString.call(e)+">";if("string"==typeof e)return e;if(e instanceof Error){var r=e&&e.stack,t=e&&e.message;if(r&&t)return-1!==r.indexOf(t)?r:t+"\n"+r;if(r)return r;if(t)return t}return"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e)}function o(){}function i(e,r,t){return e.addEventListener?e.addEventListener(r,t):e.attachEvent("on"+r,t),{cancel:function(){e.removeEventListener?e.removeEventListener(r,t):e.detachEvent("on"+r,t)}}}function a(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})}function s(e,r){for(var t=0;t<e.length;t++)r(e[t],t)}function u(e,r){for(var t in e)e.hasOwnProperty(t)&&r(e[t],t)}function c(e,r){Array.isArray(e)?s(e,r):"object"===(void 0===e?"undefined":y(e))&&null!==e&&u(e,r)}function f(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t>=100)throw new Error("Self-referential object passed, or object contained too many layers");var n=void 0;if("object"!==(void 0===e?"undefined":y(e))||null===e||Array.isArray(e)){if(!Array.isArray(e))throw new Error("Invalid type: "+(void 0===e?"undefined":y(e)));n=[]}else n={};return c(e,function(e,o){var i=r(e,o);void 0!==i?n[o]=i:"object"===(void 0===e?"undefined":y(e))&&null!==e?n[o]=f(e,r,t+1):n[o]=e}),n}function l(e,r){function t(){n=setTimeout(t,r),e.call()}var n=void 0;return n=setTimeout(t,r),{cancel:function(){clearTimeout(n)}}}function d(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function v(){return(0,S.isPopup)()?w.CONSTANTS.WINDOW_TYPES.POPUP:(0,S.isIframe)()?w.CONSTANTS.WINDOW_TYPES.IFRAME:w.CONSTANTS.WINDOW_TYPES.FULLPAGE}function p(e,r,t){var n=void 0,o=void 0;try{if("{}"!==JSON.stringify({})&&(n=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(o=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var i=JSON.stringify.call(this,e,r,t);try{n&&(Object.prototype.toJSON=n),o&&(Array.prototype.toJSON=o)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return i}function h(e){return JSON.parse(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.weakMapMemoize=r.once=void 0;var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.stringifyError=n,r.noop=o,r.addEventListener=i,r.uniqueID=a,r.eachArray=s,r.eachObject=u,r.each=c,r.replaceObject=f,r.safeInterval=l,r.isRegex=d,r.getWindowType=v,r.jsonStringify=p,r.jsonParse=h;var m=t(5),S=t(1),w=t(0);r.once=function(e){if(!e)return e;var r=!1;return function(){if(!r)return r=!0,e.apply(this,arguments)}},r.weakMapMemoize=function(e){var r=new m.WeakMap;return function(t){var n=r.get(t);return void 0!==n?n:(n=e.call(this,t),void 0!==n&&r.set(t,n),n)}}},function(e,r,t){"use strict";function n(){c.global.initialized||((0,u.listenForMessages)(),(0,s.initOnReady)(),(0,s.listenForMethods)()),c.global.initialized=!0}Object.defineProperty(r,"__esModule",{value:!0}),r.Promise=r.cleanUpWindow=void 0;var o=t(20);Object.defineProperty(r,"cleanUpWindow",{enumerable:!0,get:function(){return o.cleanUpWindow}}),r.init=n;var i=t(30);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=t(2);Object.defineProperty(r,"Promise",{enumerable:!0,get:function(){return a.ZalgoPromise}});var s=t(4),u=t(6),c=t(3);n()},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.log=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=t(7),i=t(0),a=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===n(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var s=r.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),i.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode&&e.parentNode.removeChild(e)}},writeToPage:function(e,r){setTimeout(function(){var t=document.getElementById("postRobotLogs");t||(t=document.createElement("div"),t.id="postRobotLogs",t.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body&&document.body.appendChild(t));var n=document.createElement("div"),i=(new Date).toString().split(" ")[4],a=Array.prototype.slice.call(r).map(function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var r=void 0;try{r=(0,o.jsonStringify)(e,null,2)}catch(e){r="[object]"}return"\n\n"+r+"\n\n"}).join(" "),s=i+" "+e+" "+a;n.innerHTML=s;var u={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];n.style.cssText="margin-top: 10px; color: "+u+";",t.childNodes.length?t.insertBefore(n,t.childNodes[0]):t.appendChild(n)})},logLevel:function(e,r){setTimeout(function(){try{var t=window.LOG_LEVEL||i.CONFIG.LOG_LEVEL;if(a.indexOf(e)<a.indexOf(t))return;if(r=Array.prototype.slice.call(r),r.unshift(""+window.location.host+window.location.pathname),r.unshift("::"),r.unshift(""+(0,o.getWindowType)().toLowerCase()),r.unshift("[post-robot]"),i.CONFIG.LOG_TO_PAGE&&s.writeToPage(e,r),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,r)}catch(e){}},1)},debug:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];s.logLevel("debug",r)},info:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];s.logLevel("info",r)},warn:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];s.logLevel("warn",r)},error:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];s.logLevel("error",r)}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=r.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error",PROMISE:"postrobot_promise"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"};r.POST_MESSAGE_NAMES_LIST=Object.keys(n.POST_MESSAGE_NAMES).map(function(e){return n.POST_MESSAGE_NAMES[e]})},function(e,r,t){"use strict";function n(){l.global.responseListeners={},l.global.requestListeners={}}function o(e,r){l.global.responseListeners[e]=r}function i(e){return l.global.responseListeners[e]}function a(e){delete l.global.responseListeners[e]}function s(e){var r=e.name,t=e.win,n=e.domain;if(t===v.CONSTANTS.WILDCARD&&(t=null),n===v.CONSTANTS.WILDCARD&&(n=null),!r)throw new Error("Name required to get request listener");var o=l.global.requestListeners[r];if(o)for(var i=[t,l.global.WINDOW_WILDCARD],a=0;a<i.length;a++){var s=i[a],u=s&&o.get(s);if(u){for(var c=[n,v.CONSTANTS.WILDCARD],d=0;d<c.length;d++){var h=c[d];if(h&&(h=h.toString(),u[h]))return u[h]}if(u[p])for(var y=u[p],m=Array.isArray(y),S=0,y=m?y:y[Symbol.iterator]();;){var w;if(m){if(S>=y.length)break;w=y[S++]}else{if(S=y.next(),S.done)break;w=S.value}var O=w,g=O.regex,E=O.listener;if((0,f.matchDomain)(g,n))return E}}}}function u(e,r){var t=e.name,n=e.win,o=e.domain;if(!t||"string"!=typeof t)throw new Error("Name required to add request listener");if(Array.isArray(n)){for(var i=[],a=n,f=Array.isArray(a),h=0,a=f?a:a[Symbol.iterator]();;){var y;if(f){if(h>=a.length)break;y=a[h++]}else{if(h=a.next(),h.done)break;y=h.value}var m=y;i.push(u({name:t,domain:o,win:m},r))}return{cancel:function(){for(var e=i,r=Array.isArray(e),t=0,e=r?e:e[Symbol.iterator]();;){var n;if(r){if(t>=e.length)break;n=e[t++]}else{if(t=e.next(),t.done)break;n=t.value}n.cancel()}}}}if(Array.isArray(o)){for(var S=[],w=o,O=Array.isArray(w),g=0,w=O?w:w[Symbol.iterator]();;){var E;if(O){if(g>=w.length)break;E=w[g++]}else{if(g=w.next(),g.done)break;E=g.value}var b=E;S.push(u({name:t,win:n,domain:b},r))}return{cancel:function(){for(var e=S,r=Array.isArray(e),t=0,e=r?e:e[Symbol.iterator]();;){var n;if(r){if(t>=e.length)break;n=e[t++]}else{if(t=e.next(),t.done)break;n=t.value}n.cancel()}}}}var _=s({name:t,win:n,domain:o});if(n&&n!==v.CONSTANTS.WILDCARD||(n=l.global.WINDOW_WILDCARD),o=o||v.CONSTANTS.WILDCARD,_)throw n&&o?new Error("Request listener already exists for "+t+" on domain "+o+" for specified window"):n?new Error("Request listener already exists for "+t+" for specified window"):o?new Error("Request listener already exists for "+t+" on domain "+o):new Error("Request listener already exists for "+t);var T=l.global.requestListeners,A=T[t];A||(A=new c.WeakMap,T[t]=A);var P=A.get(n);P||(P={},A.set(n,P));var N=o.toString();P[N]=r;var M=P[p],C=void 0;return(0,d.isRegex)(o)&&(M||(M=[],P[p]=M),C={regex:o,listener:r},M.push(C)),{cancel:function(){P&&(delete P[N],n&&0===Object.keys(P).length&&A.delete(n),C&&M.splice(M.indexOf(C,1)))}}}Object.defineProperty(r,"__esModule",{value:!0}),r.resetListeners=n,r.addResponseListener=o,r.getResponseListener=i,r.deleteResponseListener=a,r.getRequestListener=s,r.addRequestListener=u,t(2);var c=t(5),f=t(1),l=t(3),d=t(4),v=t(0);l.global.responseListeners=l.global.responseListeners||{},l.global.requestListeners=l.global.requestListeners||{},l.global.WINDOW_WILDCARD=l.global.WINDOW_WILDCARD||new function(){};var p="__domain_regex__"},function(e,r,t){"use strict";function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(0,f.uniqueID)(),o=(0,f.getWindowType)(),i=(0,s.getDomain)(window);return a({},r,t,{sourceDomain:i,id:r.id||n,windowType:o})}function i(e,r,t){return u.ZalgoPromise.try(function(){r=o(e,r,{data:(0,f.serializeMethods)(e,t,r.data),domain:t});var i=void 0;if(i=-1!==c.POST_MESSAGE_NAMES_LIST.indexOf(r.name)||r.type===c.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===r.ack?"error":"info",f.log.logLevel(i,["\n\n\t","#send",r.type.replace(/^postrobot_message_/,""),"::",r.name,"::",t||c.CONSTANTS.WILDCARD,"\n\n",r]),e===window)throw new Error("Attemping to send message to self");if((0,s.isWindowClosed)(e))throw new Error("Window is closed");f.log.debug("Running send message strategies",r);var a=[],d=(0,f.jsonStringify)(n({},c.CONSTANTS.WINDOW_PROPS.POSTROBOT,r),null,2);return u.ZalgoPromise.map(Object.keys(l.SEND_MESSAGE_STRATEGIES),function(r){return u.ZalgoPromise.try(function(){if(!c.CONFIG.ALLOWED_POST_MESSAGE_METHODS[r])throw new Error("Strategy disallowed: "+r);return l.SEND_MESSAGE_STRATEGIES[r](e,d,t)}).then(function(){return a.push(r+": success"),!0},function(e){return a.push(r+": "+(0,f.stringifyError)(e)+"\n"),!1})}).then(function(e){var t=e.some(Boolean),n=r.type+" "+r.name+" "+(t?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(f.log.debug(n),!t)throw new Error(n)})})}Object.defineProperty(r,"__esModule",{value:!0});var a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};r.sendMessage=i;var s=t(1),u=t(2),c=t(0),f=t(4),l=t(24)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(15);Object.defineProperty(r,"WeakMap",{enumerable:!0,get:function(){return n.CrossDomainSafeWeakMap}})},function(e,r,t){"use strict";function n(){if(!window.WeakMap)return!1;if(!window.Object.freeze)return!1;try{var e=new window.WeakMap,r={};return window.Object.freeze(r),e.set(r,"__testvalue__"),"__testvalue__"===e.get(r)}catch(e){return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.hasNativeWeakMap=n},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.CrossDomainSafeWeakMap=void 0;var o=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),i=t(1),a=t(14),s=Object.defineProperty,u=Date.now()%1e9;r.CrossDomainSafeWeakMap=function(){function e(){if(n(this,e),u+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+u,(0,a.hasNativeWeakMap)())try{this.weakmap=new window.WeakMap}catch(e){}this.keys=[],this.values=[]}return o(e,[{key:"_cleanupClosedWindows",value:function(){for(var e=this.weakmap,r=this.keys,t=0;t<r.length;t++){var n=r[t];if((0,i.isWindowClosed)(n)){if(e)try{e.delete(n)}catch(e){}r.splice(t,1),this.values.splice(t,1),t-=1}}}},{key:"isSafeToReadWrite",value:function(e){if((0,i.isWindow)(e))return!1;try{e&&e.self,e&&e[this.name]}catch(e){return!1}return!0}},{key:"set",value:function(e,r){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{t.set(e,r)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=this.name,o=e[n];o&&o[0]===e?o[1]=r:s(e,n,{value:[e,r],writable:!0})}else{this._cleanupClosedWindows();var i=this.keys,a=this.values,u=i.indexOf(e);-1===u?(i.push(e),a.push(r)):a[u]=r}}},{key:"get",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{if(r.has(e))return r.get(e)}catch(e){delete this.weakmap}if(!this.isSafeToReadWrite(e)){var t=this.keys,n=t.indexOf(e);if(-1===n)return;return this.values[n]}var o=e[this.name];if(o&&o[0]===e)return o[1]}},{key:"delete",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var t=e[this.name];t&&t[0]===e&&(t[0]=t[1]=void 0)}else{this._cleanupClosedWindows();var n=this.keys,o=n.indexOf(e);-1!==o&&(n.splice(o,1),this.values.splice(o,1))}}},{key:"has",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{return r.has(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var t=e[this.name];return!(!t||t[0]!==e)}return this._cleanupClosedWindows(),-1!==this.keys.indexOf(e)}}]),e}()},function(e,r,t){"use strict";function n(e){return"[object RegExp]"===Object.prototype.toString.call(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.isRegex=n},function(e,r,t){"use strict";function n(e){if(-1===a.indexOf(e)){a.push(e),setTimeout(function(){throw e},1);for(var r=0;r<i.length;r++)i[r](e)}}function o(e){return i.push(e),{cancel:function(){i.splice(i.indexOf(e),1)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.dispatchPossiblyUnhandledError=n,r.onPossiblyUnhandledException=o;var i=[],a=[]},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ZalgoPromise=void 0;var o=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),i=t(19),a=t(17),s=function(){function e(r){var t=this;if(n(this,e),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var o=void 0,i=void 0,a=!1,s=!1,u=!1;try{r(function(e){u?t.resolve(e):(a=!0,o=e)},function(e){u?t.reject(e):(s=!0,i=e)})}catch(e){return void this.reject(e)}u=!0,a?this.resolve(o):s&&this.reject(i)}}return o(e,[{key:"resolve",value:function(e){if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this}},{key:"reject",value:function(e){var r=this;if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not reject promise with another promise");if(!e){var t=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+t)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){r.errorHandled||(0,a.dispatchPossiblyUnhandledError)(e)},1),this.dispatch(),this}},{key:"asyncReject",value:function(e){this.errorHandled=!0,this.reject(e)}},{key:"dispatch",value:function(){var r=this,t=this.dispatching,n=this.resolved,o=this.rejected,a=this.handlers;if(!t&&(n||o)){this.dispatching=!0;for(var s=0;s<a.length;s++){(function(t){var s=a[t],u=s.onSuccess,c=s.onError,f=s.promise,l=void 0;if(n)try{l=u?u(r.value):r.value}catch(e){return f.reject(e),"continue"}else if(o){if(!c)return f.reject(r.error),"continue";try{l=c(r.error)}catch(e){return f.reject(e),"continue"}}l instanceof e&&(l.resolved||l.rejected)?(l.resolved?f.resolve(l.value):f.reject(l.error),l.errorHandled=!0):(0,i.isPromise)(l)?l.then(function(e){f.resolve(e)},function(e){f.reject(e)}):f.resolve(l)})(s)}a.length=0,this.dispatching=!1}}},{key:"then",value:function(r,t){if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for success handler");if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for error handler");var n=new e;return this.handlers.push({promise:n,onSuccess:r,onError:t}),this.errorHandled=!0,this.dispatch(),n}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"finally",value:function(r){return this.then(function(t){return e.try(r).then(function(){return t})},function(t){return e.try(r).then(function(){throw t})})}},{key:"timeout",value:function(e,r){var t=this;if(this.resolved||this.rejected)return this;var n=setTimeout(function(){t.resolved||t.rejected||t.reject(r||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(n),e})}},{key:"toPromise",value:function(){if(!window.Promise)throw new Error("Could not find window.Promise");return window.Promise.resolve(this)}}],[{key:"resolve",value:function(r){return r instanceof e||(0,i.isPromise)(r)?r:(new e).resolve(r)}},{key:"reject",value:function(r){return(new e).reject(r)}},{key:"all",value:function(r){var t=new e,n=r.length,o=[];if(!n)return t.resolve(o),t;for(var i=0;i<r.length;i++)!function(i){e.resolve(r[i]).then(function(e){o[i]=e,0===(n-=1)&&t.resolve(o)},function(e){t.reject(e)})}(i);return t}},{key:"map",value:function(r,t){var n=new e,o=r.length,i=[];if(!o)return n.resolve(i),n;for(var a=0;a<r.length;a++)!function(a){e.try(function(){return t(r[a])}).then(function(e){i[a]=e,0===(o-=1)&&n.resolve(i)},function(e){n.reject(e)})}(a);return n}},{key:"onPossiblyUnhandledException",value:function(e){return(0,a.onPossiblyUnhandledException)(e)}},{key:"try",value:function(r,t,n){var o=void 0;try{o=r.apply(t,n||[])}catch(r){return e.reject(r)}return e.resolve(o)}},{key:"delay",value:function(r){return new e(function(e){setTimeout(e,r)})}},{key:"hash",value:function(r){var t={},n=[];for(var o in r)!function(o){r.hasOwnProperty(o)&&n.push(e.resolve(r[o]).then(function(e){t[o]=e}))}(o);return e.all(n).then(function(){return t})}},{key:"isPromise",value:function(r){return!!(r&&r instanceof e)||(0,i.isPromise)(r)}}]),e}();r.ZalgoPromise=s},function(e,r,t){"use strict";function n(e){try{if(!e)return!1;if(window.Promise&&e instanceof window.Promise)return!0;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(o){var r=o.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if(e.then instanceof Function)return!0}catch(e){return!1}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=n;var o={}.toString},function(e,r,t){"use strict";function n(e){var r=o.global.requestPromises.get(e);if(r)for(var t=r,n=Array.isArray(t),i=0,t=n?t:t[Symbol.iterator]();;){var a;if(n){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a;s.reject(new Error("No response from window - cleaned up"))}o.global.popupWindowsByWin&&o.global.popupWindowsByWin.delete(e),o.global.remoteWindows&&o.global.remoteWindows.delete(e),o.global.requestPromises.delete(e),o.global.methods.delete(e),o.global.readyPromises.delete(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.cleanUpWindow=n;var o=t(3)},function(e,r,t){"use strict";function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0;var o,i=t(10),a=r.CONFIG={ALLOW_POSTMESSAGE_POPUP:!0,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,RES_TIMEOUT:1/0,LOG_TO_PAGE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},n(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),n(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),n(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,r,t){"use strict";function n(e){var r=void 0;try{r=(0,f.jsonParse)(e)}catch(e){return}if(r&&"object"===(void 0===r?"undefined":s(r))&&null!==r&&(r=r[c.CONSTANTS.WINDOW_PROPS.POSTROBOT])&&"object"===(void 0===r?"undefined":s(r))&&null!==r&&r.type&&"string"==typeof r.type&&d.RECEIVE_MESSAGE_TYPES[r.type])return r}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(e){return}var r=e.source,t=e.origin,o=e.data,i=n(o);if(i){if(!i.sourceDomain||"string"!=typeof i.sourceDomain)throw new Error("Expected message to have sourceDomain");if(0!==i.sourceDomain.indexOf(c.CONSTANTS.MOCK_PROTOCOL)&&0!==i.sourceDomain.indexOf(c.CONSTANTS.FILE_PROTOCOL)||(t=i.sourceDomain),-1===l.global.receivedMessages.indexOf(i.id)){l.global.receivedMessages.push(i.id);var a=void 0;if(a=-1!==c.POST_MESSAGE_NAMES_LIST.indexOf(i.name)||i.type===c.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===i.ack?"error":"info",f.log.logLevel(a,["\n\n\t","#receive",i.type.replace(/^postrobot_message_/,""),"::",i.name,"::",t,"\n\n",i]),(0,u.isWindowClosed)(r))return void f.log.debug("Source window is closed - can not send "+i.type+" "+i.name);i.data&&(i.data=(0,f.deserializeMethods)(r,t,i.data)),d.RECEIVE_MESSAGE_TYPES[i.type](r,t,i)}}}function i(e){try{e.source}catch(e){return}var r={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent&&e.originalEvent.origin,data:e.data};o(r)}function a(){(0,f.addEventListener)(window,"message",i)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.receiveMessage=o,r.messageListener=i,r.listenForMessages=a;var u=t(1),c=t(0),f=t(4),l=t(3),d=t(23);l.global.receivedMessages=l.global.receivedMessages||[]},function(e,r,t){"use strict";function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Object.defineProperty(r,"__esModule",{value:!0}),r.RECEIVE_MESSAGE_TYPES=void 0;var o,i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},a=t(2),s=t(1),u=t(0),c=t(4),f=t(12),l=t(11);r.RECEIVE_MESSAGE_TYPES=(o={},n(o,u.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,r,t){var n=(0,l.getResponseListener)(t.hash);if(!n)throw new Error("No handler found for post message ack for message: "+t.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(n.domain,r))throw new Error("Ack origin "+r+" does not match domain "+n.domain);n.ack=!0}),n(o,u.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,r,t){function n(n){return t.fireAndForget||(0,s.isWindowClosed)(e)?a.ZalgoPromise.resolve():(0,f.sendMessage)(e,i({target:t.originalSource,hash:t.hash,name:t.name},n),r)}var o=(0,l.getRequestListener)({name:t.name,win:e,domain:r});return a.ZalgoPromise.all([n({type:u.CONSTANTS.POST_MESSAGE_TYPE.ACK}),a.ZalgoPromise.try(function(){if(!o)throw new Error("No handler found for post message: "+t.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(o.domain,r))throw new Error("Request origin "+r+" does not match domain "+o.domain);var n=t.data;return o.handler({source:e,origin:r,data:n})}).then(function(e){return n({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){var r=(0,c.stringifyError)(e).replace(/^Error: /,"");return n({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:r})})]).then(c.noop).catch(function(e){if(o&&o.handleError)return o.handleError(e);c.log.error((0,c.stringifyError)(e))})}),n(o,u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,r,t){var n=(0,l.getResponseListener)(t.hash);if(!n)throw new Error("No handler found for post message response for message: "+t.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(n.domain,r))throw new Error("Response origin "+r+" does not match domain "+n.domain);if((0,l.deleteResponseListener)(t.hash),t.ack===u.CONSTANTS.POST_MESSAGE_ACK.ERROR)return n.respond(new Error(t.error),null);if(t.ack===u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var o=t.data||t.response;return n.respond(null,{source:e,origin:r,data:o})}}),o)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SEND_MESSAGE_STRATEGIES=void 0;var n=t(1),o=t(0),i=r.SEND_MESSAGE_STRATEGIES={};i[o.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE]=function(e,r,t){var i=void 0;i=Array.isArray(t)?t:t?[t]:[o.CONSTANTS.WILDCARD],i=i.map(function(r){if(0===r.indexOf(o.CONSTANTS.MOCK_PROTOCOL)){if(window.location.protocol===o.CONSTANTS.FILE_PROTOCOL)return o.CONSTANTS.WILDCARD;if(!(0,n.isActuallySameDomain)(e))throw new Error("Attempting to send messsage to mock domain "+r+", but window is actually cross-domain");return(0,n.getActualDomain)(e)}return 0===r.indexOf(o.CONSTANTS.FILE_PROTOCOL)?o.CONSTANTS.WILDCARD:r}),i.forEach(function(t){return e.postMessage(r,t)})}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(8);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(n);r.default=o},function(e,r,t){"use strict";function n(e,r){return"object"===(void 0===e?"undefined":d(e))&&null!==e&&e.__type__===r}function o(e,r,t,n){var o=(0,m.uniqueID)(),i=O.global.methods.get(e);return i||(i={},O.global.methods.set(e,i)),i[o]={domain:r,method:t},{__type__:y.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:n}}function i(e){return{__type__:y.CONSTANTS.SERIALIZATION_TYPES.ERROR,__message__:(0,m.stringifyError)(e)}}function a(e,r,t,n){return{__type__:y.CONSTANTS.SERIALIZATION_TYPES.PROMISE,__then__:o(e,r,function(e,r){return t.then(e,r)},n+".then")}}function s(e,r,t){return(0,m.replaceObject)({obj:t},function(t,n){return"function"==typeof t?o(e,r,t,n.toString()):t instanceof Error?i(t):h.ZalgoPromise.isPromise(t)?a(e,r,t,n.toString()):void 0}).obj}function u(e,r,t){function n(){var n=Array.prototype.slice.call(arguments);return w.log.debug("Call foreign method",t.__name__,n),(0,S.send)(e,y.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:t.__id__,name:t.__name__,args:n},{domain:r,timeout:1/0}).then(function(e){var r=e.data;return w.log.debug("Got foreign method result",t.__name__,r.result),r.result},function(e){throw w.log.debug("Got foreign method error",(0,m.stringifyError)(e)),e})}return n.__name__=t.__name__,n.__xdomain__=!0,n.source=e,n.origin=r,n}function c(e,r,t){return new Error(t.__message__)}function f(e,r,t){return new h.ZalgoPromise(function(n,o){return u(e,r,t.__then__)(n,o)})}function l(e,r,t){return(0,m.replaceObject)({obj:t},function(t,o){return"object"===(void 0===t?"undefined":d(t))&&null!==t&&n(t,y.CONSTANTS.SERIALIZATION_TYPES.METHOD)?u(e,r,t):"object"===(void 0===t?"undefined":d(t))&&null!==t&&n(t,y.CONSTANTS.SERIALIZATION_TYPES.ERROR)?c(e,r,t):"object"===(void 0===t?"undefined":d(t))&&null!==t&&n(t,y.CONSTANTS.SERIALIZATION_TYPES.PROMISE)?f(e,r,t):void 0}).obj}Object.defineProperty(r,"__esModule",{value:!0}),r.listenForMethods=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.serializeMethod=o,r.serializeMethods=s,r.deserializeMethod=u,r.deserializeError=c,r.deserializePromise=f,r.deserializeMethods=l;var v=t(5),p=t(1),h=t(2),y=t(0),m=t(7),S=t(8),w=t(9),O=t(3);O.global.methods=O.global.methods||new v.WeakMap;r.listenForMethods=(0,m.once)(function(){(0,S.on)(y.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{window:y.CONSTANTS.WILDCARD,origin:y.CONSTANTS.WILDCARD},function(e){var r=e.source,t=e.origin,n=e.data,o=O.global.methods.get(r);if(!o)throw new Error("Could not find any methods this window has privileges to call");var i=o[n.id];if(!i)throw new Error("Could not find method with id: "+n.id);if(!(0,p.matchDomain)(i.domain,t))throw new Error("Method domain "+i.domain+" does not match origin "+t);return w.log.debug("Call local method",n.name,n.args),h.ZalgoPromise.try(function(){return i.method.apply({source:r,origin:t,data:n},n.args)}).then(function(e){return{result:e,id:n.id,name:n.name}})})})},function(e,r,t){"use strict";function n(){(0,c.on)(u.CONSTANTS.POST_MESSAGE_NAMES.READY,{window:u.CONSTANTS.WILDCARD,domain:u.CONSTANTS.WILDCARD},function(e){var r=e.source,t=l.global.readyPromises.get(r);t?t.resolve(e):(t=(new s.ZalgoPromise).resolve(e),l.global.readyPromises.set(r,t))});var e=(0,a.getAncestor)();e&&(0,c.send)(e,u.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:u.CONSTANTS.WILDCARD,timeout:1/0}).catch(function(e){f.log.debug((0,d.stringifyError)(e))})}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",n=l.global.readyPromises.get(e);return n||(n=new s.ZalgoPromise,l.global.readyPromises.set(e,n),setTimeout(function(){return n.reject(new Error(t+" did not load after "+r+"ms"))},r),n)}Object.defineProperty(r,"__esModule",{value:!0}),r.initOnReady=n,r.onWindowReady=o;var i=t(5),a=t(1),s=t(2),u=t(0),c=t(8),f=t(9),l=t(3),d=t(7);l.global.readyPromises=l.global.readyPromises||new i.WeakMap},function(e,r,t){"use strict";function n(e){return u.ZalgoPromise.try(function(){if(!e.name)throw new Error("Expected options.name");var r=e.name,t=e.window,n=void 0;if("string"==typeof t){var o=document.getElementById(t);if(!o)throw new Error("Expected options.window "+Object.prototype.toString.call(t)+" to be a valid element id");if("iframe"!==o.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(t)+" to be an iframe");if(!o.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");t=o.contentWindow}else if(t instanceof HTMLElement){if("iframe"!==t.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(t)+" to be an iframe");if(t&&!t.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");t&&t.contentWindow&&(t=t.contentWindow)}if(!t)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");n=e.domain||f.CONSTANTS.WILDCARD;var i=e.name+"_"+(0,d.uniqueID)();if((0,c.isWindowClosed)(t))throw new Error("Target window is closed");var a=!1,s=v.global.requestPromises.get(t);s||(s=[],v.global.requestPromises.set(t,s));var p=u.ZalgoPromise.try(function(){if((0,c.isAncestor)(window,t))return u.ZalgoPromise.resolve((0,d.onWindowReady)(t))}).then(function(){return new u.ZalgoPromise(function(o,u){var d={name:r,window:t,domain:n,respond:function(e,r){e||(a=!0,s.splice(s.indexOf(p,1))),e?u(e):o(r)}};if((0,l.addResponseListener)(i,d),(0,l.sendMessage)(t,{type:f.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,hash:i,name:r,data:e.data,fireAndForget:e.fireAndForget},n).catch(u),e.fireAndForget)return o();var v=f.CONFIG.ACK_TIMEOUT,h=e.timeout||f.CONFIG.RES_TIMEOUT,y=100,m=function n(){if(!a){if((0,c.isWindowClosed)(t))return u(d.ack?new Error("Window closed for "+r+" before response"):new Error("Window closed for "+r+" before ack"));v-=y,h-=y;if(d.ack){if(h===1/0)return;y=Math.min(h,2e3)}else{if(v<=0)return u(new Error("No ack for postMessage "+r+" in "+f.CONFIG.ACK_TIMEOUT+"ms"));if(h<=0)return u(new Error("No response for postMessage "+r+" in "+(e.timeout||f.CONFIG.RES_TIMEOUT)+"ms"))}setTimeout(n,y)}};setTimeout(m,y)})});return p.catch(function(){(0,l.deleteResponseListener)(i)}),s.push(p),p})}function o(e,r,t,o){return o=o||{},o.window=e,o.name=r,o.data=t,n(o)}function i(e,r,t){var n=(0,c.getAncestor)();return n?o(n,e,r,t):new u.ZalgoPromise(function(e,r){return r(new Error("Window does not have a parent"))})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");return{send:function(r,t){return o(e.window,r,t,e)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.send=void 0,r.request=n,r.sendToParent=i,r.client=a;var s=t(5),u=t(2),c=t(1),f=t(0),l=t(6),d=t(4),v=t(3);v.global.requestPromises=v.global.requestPromises||new s.WeakMap,r.send=o},function(e,r,t){"use strict";function n(){delete window[o.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",i.messageListener)}Object.defineProperty(r,"__esModule",{value:!0}),r.CONSTANTS=r.CONFIG=void 0;var o=t(0);Object.defineProperty(r,"CONFIG",{enumerable:!0,get:function(){return o.CONFIG}}),Object.defineProperty(r,"CONSTANTS",{enumerable:!0,get:function(){return o.CONSTANTS}}),r.disable=n;var i=t(6)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bridge=r.parent=void 0;var n=t(28);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})});var o=t(31);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(29);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=t(1);r.parent=(0,a.getAncestor)(),r.bridge=void 0},function(e,r,t){"use strict";function n(e){if(!e.name)throw new Error("Expected options.name");if(!e.handler)throw new Error("Expected options.handler");var r={handler:e.handler,handleError:e.errorHandler||function(e){throw e},window:e.window,domain:e.domain||l.CONSTANTS.WILDCARD,name:e.name},t=(0,f.addRequestListener)({name:r.name,win:r.window,domain:r.domain},r);if(e.once){var n=r.handler;r.handler=(0,c.once)(function(){return t.cancel(),n.apply(this,arguments)})}if(r.window&&e.errorOnClose)var o=(0,c.safeInterval)(function(){(0,s.isWindowClosed)(r.window)&&(o.cancel(),r.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){t.cancel()}}}function o(e,r,t){return"function"==typeof r&&(t=r,r={}),r=r||{},r.name=e,r.handler=t||r.handler,n(r)}function i(e,r,t){"function"==typeof r&&(t=r,r={}),r=r||{},r.name=e,r.handler=t||r.handler,r.once=!0;var o=new u.ZalgoPromise(function(e,t){r.handler=r.handler||function(r){return e(r)},r.errorHandler=r.errorHandler||t}),i=n(r);return o.cancel=i.cancel,o}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(r,t){return o(r,e,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0,r.listen=n,r.once=i,r.listener=a;var s=t(1),u=t(2),c=t(4),f=t(6),l=t(0);r.on=o}])});
//# sourceMappingURL=post-robot.min.js.map