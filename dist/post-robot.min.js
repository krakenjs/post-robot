!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("postRobot",[],r):"object"==typeof exports?exports.postRobot=r():e.postRobot=r()}(this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.i=function(e){return e},r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=30)}([function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(20);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(10);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(15);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(2);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(9);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(6);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var u=n(24);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(16);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})});var c=n(25);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})});var f=n(13);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return f[e]}})});var l=n(14);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,r,n){"use strict";function t(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function o(e){var r=new a.WeakMap;return function(n){var t=r.get(n);return"undefined"!=typeof t?t:(t=e.call(this,n),"undefined"!=typeof t&&r.set(n,t),t)}}Object.defineProperty(r,"__esModule",{value:!0}),r.util=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.isRegex=t,r.weakMapMemoize=o;var a=n(4),u=n(0),s=r.util={once:function(e){if(!e)return e;var r=!1;return function(){if(!r)return r=!0,e.apply(this,arguments)}},noop:function(){},safeHasProp:function(e,r){try{return!!e[r]}catch(e){return!1}},safeGetProp:function(e,r){try{return e[r]}catch(e){return}},listen:function(e,r,n){return e.addEventListener?e.addEventListener(r,n):e.attachEvent("on"+r,n),{cancel:function(){e.removeEventListener?e.removeEventListener(r,n):e.detachEvent("on"+r,n)}}},apply:function(e,r,n){return"function"==typeof e.apply?e.apply(r,n):e(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9])},find:function(e,r,n){if(!e)return n;for(var t=0;t<e.length;t++)if(r(e[t]))return e[t];return n},map:function(e,r){for(var n=[],t=0;t<e.length;t++)n.push(r(e[t]));return n},some:function(e,r){r=r||Boolean;for(var n=0;n<e.length;n++)if(r(e[n]))return!0;return!1},keys:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(n);return r},values:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return r},getByValue:function(e,r){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===r)return n},uniqueID:function(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})},memoize:function(e){var r={};return function(){var n=JSON.stringify(Array.prototype.slice.call(arguments));return r.hasOwnProperty(n)||(r[n]=e.apply(this,arguments)),r[n]}},extend:function(e,r){if(!r)return e;for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},each:function(e,r){if(Array.isArray(e))for(var n=0;n<e.length;n++)r(e[n],n);else if("object"===("undefined"==typeof e?"undefined":i(e))&&null!==e)for(var t in e)e.hasOwnProperty(t)&&r(e[t],t)},replaceObject:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(n>=100)throw new Error("Self-referential object passed, or object contained too many layers");var t=Array.isArray(e)?[]:{};return s.each(e,function(e,o){var a=r(e,o);void 0!==a?t[o]=a:"object"===("undefined"==typeof e?"undefined":i(e))&&null!==e?t[o]=s.replaceObject(e,r,n+1):t[o]=e}),t},safeInterval:function(e,r){function n(){t=setTimeout(n,r),e.call()}var t=void 0;return t=setTimeout(n,r),{cancel:function(){clearTimeout(t)}}},intervalTimeout:function(e,r,n){var t=s.safeInterval(function(){e-=r,e=e<=0?0:e,0===e&&t.cancel(),n(e)},r);return t},getActualDomain:function(e){return e.location.protocol+"//"+e.location.host},getDomain:function(e){if(e=e||window,e.mockDomain&&0===e.mockDomain.indexOf(u.CONSTANTS.MOCK_PROTOCOL))return e.mockDomain;if(!e.location.protocol)throw new Error("Can not read window protocol");if(e.location.protocol===u.CONSTANTS.FILE_PROTOCOL)return s.getActualDomain(e);if(!e.location.host)throw new Error("Can not read window host");return s.getActualDomain(e)},getDomainFromUrl:function(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):this.getDomain()},safeGet:function(e,r){var n=void 0;try{n=e[r]}catch(e){}return n}}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.global=void 0;var t=n(0),o=n(13),i=r.global=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{};i.clean=i.clean||(0,o.cleanup)(i),i.registerSelf=function(){}},function(e,r,n){function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}Object.defineProperty(r,"__esModule",{value:!0});var o=n(17);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(o);r.default=i},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(21);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(12);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(11);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,r,n){"use strict";function t(e){if(D.global.domainMatches.has(e))return D.global.domainMatches.get(e);var r=void 0;try{r=R.util.getDomain(window)===R.util.getDomain(e)}catch(e){r=!1}return D.global.domainMatches.set(e,r),L||(L=setTimeout(function(){D.global.domainMatches=new j.WeakMap,L=null},1)),r}function o(e){try{if(e&&e.location&&e.location.href)return!0}catch(r){return D.global.clean.push(D.global.domainMatches,{win:e,match:!1}),!1}return!0}function i(e){if(e)try{return e.opener}catch(e){return}}function a(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){return}}function u(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(e){}return r}function s(e,r){if(!e||!r)return!1;var n=a(r);return n?n===e:u(r).indexOf(e)!==-1}function c(e){var r=[],n=void 0;try{n=e.frames}catch(r){n=e}var t=void 0;try{t=n.length}catch(e){}if(0===t)return r;if(t){for(var o=0;o<t;o++){var i=void 0;try{i=n[o]}catch(e){continue}r.push(i)}return r}for(var a=0;a<100;a++){var u=void 0;try{u=n[a]}catch(e){return r}if(!u)return r;r.push(u)}return r}function f(e){for(var r=[],n=c(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var u=f(a),s=Array.isArray(u),l=0,u=s?u:u[Symbol.iterator]();;){var d;if(s){if(l>=u.length)break;d=u[l++]}else{if(l=u.next(),l.done)break;d=l.value}var p=d;r.push(p)}}return r}function l(e){var r=f(e);r.push(e);for(var n=u(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var s=c(a),l=Array.isArray(s),d=0,s=l?s:s[Symbol.iterator]();;){var p;if(l){if(d>=s.length)break;p=s[d++]}else{if(d=s.next(),d.done)break;p=d.value}var h=p;r.indexOf(h)===-1&&r.push(h)}}return r}function d(e){if(e){try{if(e.top)return e.top}catch(e){}if(a(e)===e)return e;try{if(s(window,e))return window.top}catch(e){}try{if(s(e,window))return window.top}catch(e){}for(var r=f(e),n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}var i=o;try{if(i.top)return i.top}catch(e){}if(a(i)===i)return i}}}function p(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||"Call was rejected by callee.\r\n"!==e.message}return!!(r&&t(e)&&R.util.safeGet(e,"mockclosed"))}function h(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function v(e,r){for(var n=c(e),o=n,i=Array.isArray(o),a=0,o=i?o:o[Symbol.iterator]();;){var u;if(i){if(a>=o.length)break;u=o[a++]}else{if(a=o.next(),a.done)break;u=a.value}var s=u;try{if(t(s)&&s.name===r&&n.indexOf(s)!==-1)return s}catch(e){}}try{if(n.indexOf(e.frames[r])!==-1)return e.frames[r]}catch(e){}try{if(n.indexOf(e[r])!==-1)return e[r]}catch(e){}}function S(e,r){var n=v(e,r);if(n)return n;for(var t=c(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a,s=S(u,r);if(s)return s}}function y(e,r){var n=void 0;return n=v(e,r),n?n:S(d(e),r)}function m(e,r){var n=a(r);if(n)return n===e;for(var t=c(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var u;if(o){if(i>=t.length)break;u=t[i++]}else{if(i=t.next(),i.done)break;u=i.value}var s=u;if(s===r)return!0}return!1}function O(e,r){return e===i(r)}function w(e){e=e||window;var r=i(e);if(r)return r;var n=a(e);return n?n:void 0}function g(e){for(var r=[],n=e;n;)n=w(n),n&&r.push(n);return r}function _(e,r){var n=w(r);if(n)return n===e;if(r===e)return!1;if(d(r)===r)return!1;for(var t=c(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a;if(u===r)return!0}return!1}function b(){return Boolean(i(window))}function E(){return Boolean(a(window))}function T(){return Boolean(!E()&&!b())}function A(){return b()?k.CONSTANTS.WINDOW_TYPES.POPUP:E()?k.CONSTANTS.WINDOW_TYPES.IFRAME:k.CONSTANTS.WINDOW_TYPES.FULLPAGE}function P(e,r){for(var n=e,t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}for(var a=i,u=r,s=Array.isArray(u),c=0,u=s?u:u[Symbol.iterator]();;){var f;if(s){if(c>=u.length)break;f=u[c++]}else{if(c=u.next(),c.done)break;f=c.value}var l=f;if(a===l)return!0}}}function N(e,r){var n=d(e),t=d(r);try{if(n&&t)return n===t}catch(e){}var o=l(e),a=l(r);if(P(o,a))return!0;var u=i(n),s=i(t);return(!u||!P(l(u),a))&&((!s||!P(l(s),o))&&void 0)}function M(){var e=void 0,r=void 0;try{if("{}"!==JSON.stringify({})&&(e=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(r=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var n=JSON.stringify.apply(this,arguments);try{e&&(Object.prototype.toJSON=e),r&&(Array.prototype.toJSON=r)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return n}function C(){return JSON.parse.apply(this,arguments)}Object.defineProperty(r,"__esModule",{value:!0}),r.isSameDomain=t,r.isActuallySameDomain=o,r.getOpener=i,r.getParent=a,r.getParents=u,r.isAncestorParent=s,r.getFrames=c,r.getAllChildFrames=f,r.getAllFramesInWindow=l,r.getTop=d,r.isWindowClosed=p,r.getUserAgent=h,r.getFrameByName=v,r.findChildFrameByName=S,r.findFrameByName=y,r.isParent=m,r.isOpener=O,r.getAncestor=w,r.getAncestors=g,r.isAncestor=_,r.isPopup=b,r.isIframe=E,r.isFullpage=T,r.getWindowType=A,r.isSameTopWindow=N,r.jsonStringify=M,r.jsonParse=C;var j=n(4),R=n(2),D=n(3),k=n(0);D.global.domainMatches=D.global.domainMatches||new j.WeakMap;var L=void 0},function(e,r,n){"use strict";function t(){s.global.initialized||((0,u.listenForMessages)(),(0,a.initOnReady)(),(0,a.listenForMethods)()),s.global.initialized=!0}function o(){return s.global.clean.all().then(function(){return s.global.initialized=!1,t()})}Object.defineProperty(r,"__esModule",{value:!0}),r.Promise=void 0,r.init=t,r.reset=o;var i=n(28);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(1);Object.defineProperty(r,"Promise",{enumerable:!0,get:function(){return a.Promise}});var u=n(5),s=n(3);t()},function(e,r,n){"use strict";function t(e,r,n){function t(){if(o){if(a)return n(u);if(i)return r(s)}}var o=!1,i=!1,a=!1,u=void 0,s=void 0;try{e(function(e){s=e,i=!0,t()},function(e){u=e,a=!0,t()})}catch(e){return n(e)}o=!0,t()}function o(e){f.push(e),l=l||setTimeout(i,1)}function i(){l=null;var e=f;f=[];for(var r=function(r){var n=e[r];return n.silentReject?"continue":(n.handlers.push({onError:function(e){n.silentReject||a(e)}}),void n.dispatch())},n=0;n<e.length;n++){r(n)}}function a(e){if(d.indexOf(e)===-1){d.push(e),setTimeout(function(){throw e},1);for(var r=0;r<c.length;r++)c[r](e)}}function u(e){try{if(!e)return!1;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(p){var r=p.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if(e&&e.then instanceof Function)return!0}catch(e){return!1}return!1}function s(){window.Promise=h}Object.defineProperty(r,"__esModule",{value:!0}),r.patchPromise=s;var c=[],f=[],l=void 0,d=[],p={}.toString,h=r.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.silentReject=!1,this.handlers=[],o(this),e){var r=this;t(e,function(e){return r.resolve(e)},function(e){return r.reject(e)})}};h.resolve=function(e){return u(e)?e:(new h).resolve(e)},h.reject=function(e){return(new h).reject(e)},h.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(u(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},h.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(u(e))throw new Error("Can not reject promise with another promise");return this.rejected=!0,this.value=e,this.dispatch(),this},h.prototype.asyncReject=function(e){this.silentReject=!0,this.reject(e)},h.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var r=function(){var r=e.handlers.shift(),n=void 0,t=void 0;try{e.resolved?n=r.onSuccess?r.onSuccess(e.value):e.value:e.rejected&&(r.onError?n=r.onError(e.value):t=e.value)}catch(e){t=e}if(n===e)throw new Error("Can not return a promise from the the then handler of the same promise");return r.promise?void(t?r.promise.reject(t):u(n)?n.then(function(e){r.promise.resolve(e)},function(e){r.promise.reject(e)}):r.promise.resolve(n)):"continue"};this.handlers.length;){r()}},h.prototype.then=function(e,r){if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var n=new h(null,this);return this.handlers.push({promise:n,onSuccess:e,onError:r}),this.silentReject=!0,this.dispatch(),n},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.finally=function(e){return this.then(function(r){return h.try(e).then(function(){return r})},function(r){return h.try(e).then(function(){throw r})})},h.all=function(e){for(var r=new h,n=e.length,t=[],o=function(o){var i=u(e[o])?e[o]:h.resolve(e[o]);i.then(function(e){t[o]=e,n-=1,0===n&&r.resolve(t)},function(e){r.reject(e)})},i=0;i<e.length;i++)o(i);return n||r.resolve(t),r},h.onPossiblyUnhandledException=function(e){c.push(e)},h.try=function(e){return h.resolve().then(e)},h.delay=function(e){return new h(function(r){setTimeout(r,e)})},h.hash=function(e){var r={},n=[],t=function(t){e.hasOwnProperty(t)&&n.push(h.resolve(e[t]).then(function(e){r[t]=e}))};for(var o in e)t(o);return h.all(n).then(function(){return r})},h.promisifyCall=function(){var e=Array.prototype.slice.call(arguments),r=e.shift();if("function"!=typeof r)throw new Error("Expected promisifyCall to be called with a function");return new h(function(n,t){return e.push(function(e,r){return e?t(e):n(r)}),r.apply(null,e)})}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.log=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(2),i=n(6),a=n(0),u=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===t(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var s=r.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),a.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode.removeChild(e)}},writeToPage:function(e,r){setTimeout(function(){var n=document.getElementById("postRobotLogs");n||(n=document.createElement("div"),n.id="postRobotLogs",n.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body.appendChild(n));var t=document.createElement("div"),a=(new Date).toString().split(" ")[4],u=o.util.map(r,function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var r=void 0;try{r=(0,i.jsonStringify)(e,0,2)}catch(e){r="[object]"}return"\n\n"+r+"\n\n"}).join(" "),s=a+" "+e+" "+u;t.innerHTML=s;var c={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];t.style.cssText="margin-top: 10px; color: "+c+";",n.childNodes.length?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)})},logLevel:function(e,r){setTimeout(function(){try{if(u.indexOf(e)<u.indexOf(a.CONFIG.LOG_LEVEL))return;if(r=Array.prototype.slice.call(r),r.unshift(""+window.location.host+window.location.pathname),r.unshift("::"),r.unshift(""+(0,i.getWindowType)().toLowerCase()),r.unshift("[post-robot]"),a.CONFIG.LOG_TO_PAGE&&s.writeToPage(e,r),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,r)}catch(e){}},1)},debug:function(){s.logLevel("debug",arguments)},info:function(){s.logLevel("info",arguments)},warn:function(){s.logLevel("warn",arguments)},error:function(){s.logLevel("error",arguments)}}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=r.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"};r.POST_MESSAGE_NAMES_LIST=Object.keys(t.POST_MESSAGE_NAMES).map(function(e){return t.POST_MESSAGE_NAMES[e]})},function(e,r,n){"use strict";function t(){f.global.responseListeners={},f.global.requestListeners={}}function o(e,r){f.global.responseListeners[e]=r}function i(e){return f.global.responseListeners[e]}function a(e){delete f.global.responseListeners[e]}function u(e){var r=e.name,n=e.win,t=e.domain;if(n===d.CONSTANTS.WILDCARD&&(n=null),t===d.CONSTANTS.WILDCARD&&(t=null),!r)throw new Error("Name required to get request listener");var o=f.global.requestListeners[r];if(o)for(var i=[n,f.global.WINDOW_WILDCARD],a=0;a<i.length;a++){var u=i[a],s=u&&o.get(u);if(s){for(var c=[t,d.CONSTANTS.WILDCARD],h=0;h<c.length;h++){var v=c[h];if(v&&(v=v.toString(),s[v]))return s[v]}if(s[p])for(var S=s[p],y=Array.isArray(S),m=0,S=y?S:S[Symbol.iterator]();;){var O;if(y){if(m>=S.length)break;O=S[m++]}else{if(m=S.next(),m.done)break;O=m.value}var w=O,g=w.regex,_=w.listener;if((0,l.matchDomain)(g,t))return _}}}}function s(e,r){var n=e.name,t=e.win,o=e.domain;if(!n||"string"!=typeof n)throw new Error("Name required to add request listener");if(Array.isArray(t))for(var i=t,a=Array.isArray(i),h=0,i=a?i:i[Symbol.iterator]();;){var v;if(a){if(h>=i.length)break;v=i[h++]}else{if(h=i.next(),h.done)break;v=h.value}var S=v;s({name:n,domain:o,win:S},r)}else{if(!Array.isArray(o)){var y=u(e);if(t&&t!==d.CONSTANTS.WILDCARD||(t=f.global.WINDOW_WILDCARD),o=o||d.CONSTANTS.WILDCARD,y)throw t&&o?new Error("Request listener already exists for "+n+" on domain "+o+" for specified window"):t?new Error("Request listener already exists for "+n+" for specified window"):o?new Error("Request listener already exists for "+n+" on domain "+o):new Error("Request listener already exists for "+n);var m=f.global.requestListeners,O=m[n];O||(O=new c.WeakMap,m[n]=O);var w=O.get(t);w||(w={},O.set(t,w));var g=o.toString();w[g]=r;var _=w[p],b=void 0;return(0,l.isRegex)(o)&&(_||(_=[],w[p]=_),b={regex:o,listener:r},_.push(b)),{cancel:function(){delete w[g],0===Object.keys(w).length&&O.delete(t),b&&_.splice(_.indexOf(b,1))}}}for(var E=o,T=Array.isArray(E),A=0,E=T?E:E[Symbol.iterator]();;){var P;if(T){if(A>=E.length)break;P=E[A++]}else{if(A=E.next(),A.done)break;P=A.value}var N=P;s({name:n,win:t,domain:N},r)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.resetListeners=t,r.addResponseListener=o,r.getResponseListener=i,r.deleteResponseListener=a,r.getRequestListener=u,r.addRequestListener=s;var c=n(4),f=n(3),l=n(1),d=n(0);f.global.responseListeners=f.global.responseListeners||{},f.global.requestListeners=f.global.requestListeners||{},f.global.WINDOW_WILDCARD=f.global.WINDOW_WILDCARD||new function(){};var p="__domain_regex__"},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=s.util.uniqueID(),o=(0,s.getWindowType)(),i=s.util.getDomain(window);return a({},r,n,{sourceDomain:i,id:r.id||t,windowType:o})}function i(e,r,n){return s.promise.run(function(){r=o(e,r,{data:(0,s.serializeMethods)(e,n,r.data),domain:n});var i=void 0;if(i=u.POST_MESSAGE_NAMES_LIST.indexOf(r.name)!==-1||r.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===r.ack?"error":"info",s.log.logLevel(i,["\n\n\t","#send",r.type.replace(/^postrobot_message_/,""),"::",r.name,"::",n||u.CONSTANTS.WILDCARD,"\n\n",r]),u.CONFIG.MOCK_MODE)return delete r.target,window[u.CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({origin:s.util.getDomain(window),source:window,data:(0,s.jsonStringify)(r,0,2)});if(e===window)throw new Error("Attemping to send message to self");if((0,s.isWindowClosed)(e))throw new Error("Window is closed");s.log.debug("Running send message strategies",r);var a=[],f=(0,s.jsonStringify)(t({},u.CONSTANTS.WINDOW_PROPS.POSTROBOT,r),0,2);return s.promise.map(Object.keys(c.SEND_MESSAGE_STRATEGIES),function(r){return s.promise.run(function(){if(!u.CONFIG.ALLOWED_POST_MESSAGE_METHODS[r])throw new Error("Strategy disallowed: "+r);return c.SEND_MESSAGE_STRATEGIES[r](e,f,n)}).then(function(){return a.push(r+": success"),!0},function(e){return a.push(r+": "+(e.stack||e.toString())+"\n"),!1})}).then(function(e){var n=s.util.some(e),t=r.type+" "+r.name+" "+(n?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(s.log.debug(t),!n)throw new Error(t)})})}Object.defineProperty(r,"__esModule",{value:!0});var a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};r.buildMessage=o,r.sendMessage=i;var u=n(0),s=n(1),c=n(23)},function(e,r,n){"use strict";function t(e){var r=[];return{getters:{array:function(){return[]},object:function(){return{}}},set:function(r,n){return e[r]=n,this.register(function(){delete e[r]}),n},push:function(e,r){return e.push(r),this.register(function(){var n=e.indexOf(r);n!==-1&&e.splice(n,1)}),r},setItem:function(e,r,n){return"function"==typeof e.set&&"function"==typeof e.delete?(e.set(r,n),this.register(function(){e.delete(r)}),n):(e[r]=n,this.register(function(){delete e[r]}),n)},register:function(e,n){n||(n=e,e=void 0),r.push({complete:!1,name:e,run:function(){if(!this.complete)return this.complete=!0,n()}})},hasTasks:function(){return Boolean(r.filter(function(e){return!e.complete}).length)},all:function(){for(var e=[];r.length;)e.push(r.pop().run());return o.SyncPromise.all(e).then(function(){})},run:function(e){for(var n=[],t=[],i=r,a=Array.isArray(i),u=0,i=a?i:i[Symbol.iterator]();;){var s;if(a){if(u>=i.length)break;s=i[u++]}else{if(u=i.next(),u.done)break;s=u.value}var c=s;c.name===e&&(t.push(c),n.push(c.run()))}for(var f=t,l=Array.isArray(f),d=0,f=l?f:f[Symbol.iterator]();;){var p;if(l){if(d>=f.length)break;p=f[d++]}else{if(d=f.next(),d.done)break;p=d.value}var h=p;r.splice(r.indexOf(h),1)}return o.SyncPromise.all(n).then(function(){})}}}Object.defineProperty(r,"__esModule",{value:!0}),r.cleanup=t;var o=n(8)},function(e,r,n){"use strict";function t(e,r){return"string"==typeof e?!(0,o.isRegex)(r)&&(!Array.isArray(r)&&(e===i.CONSTANTS.WILDCARD||r===e)):(0,o.isRegex)(e)?(0,o.isRegex)(r)?e.toString()===r.toString():!Array.isArray(r)&&r.match(e):!!Array.isArray(e)&&(!(0,o.isRegex)(r)&&(Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):e.indexOf(r)!==-1))}Object.defineProperty(r,"__esModule",{value:!0}),r.matchDomain=t;var o=n(2),i=n(0)},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.promise=r.Promise=void 0;var t=n(8),o=n(16),i=r.Promise=t.SyncPromise,a=r.promise={Promise:i,run:function(e){return i.resolve().then(e)},nextTick:function(e){return new i(function(r,n){(0,o.nextTick)(function(){return a.run(e).then(r,n)})})},method:function(e){return function(){var r=this,n=arguments;return i.resolve().then(function(){return e.apply(r,n)})}},nodeify:function(e,r){return r?void e.then(function(e){r(null,e)},function(e){r(e)}):e},deNodeify:function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),t=1;t<r;t++)n[t-1]=arguments[t];return new i(function(r,t){try{return n.length<e.length?e.apply(void 0,n.concat([function(e,n){return e?t(e):r(n)}])):a.run(function(){return e.apply(void 0,n)}).then(r,t)}catch(e){return t(e)}})},map:function(e,r){for(var n=[],t=function(t){n.push(a.run(function(){return r(e[t])}))},o=0;o<e.length;o++)t(o);return i.all(n)}}},function(e,r,n){"use strict";function t(e){u.push(e),window.postMessage(a,i.CONSTANTS.WILDCARD)}Object.defineProperty(r,"__esModule",{value:!0}),r.nextTick=t;var o=n(2),i=n(0),a="__nextTick__postRobot__"+o.util.uniqueID(),u=[];window.addEventListener("message",function(e){if(e.data===a){var r=u.shift();r.call()}})},function(e,r,n){Object.defineProperty(r,"__esModule",{value:!0});var t=r.WeakMap=void 0;window.WeakMap?r.WeakMap=t=window.WeakMap:r.WeakMap=t=n(19).WeakMap},function(e,r){function n(e){if(t.indexOf(e)!==-1)return!0;try{if(e&&e.self===e)return t.push(e),!0}catch(e){}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isWindow=n;var t=[]},function(e,r,n){function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WeakMap=void 0;var o=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),i=n(18),a=Object.defineProperty,u=Date.now()%1e9;r.WeakMap=function(){function e(){t(this,e),u+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+u,this.keys=[],this.values=[]}return o(e,[{key:"set",value:function(e,r){if((0,i.isWindow)(e))return this.safeSet(e,r);var n=this.name,t=e[n];t&&t[0]===e?t[1]=r:a(e,n,{value:[e,r],writable:!0})}},{key:"get",value:function(e){if((0,i.isWindow)(e))return this.safeGet(e);var r=e[this.name];return r&&r[0]===e?r[1]:void 0}},{key:"delete",value:function(e){if((0,i.isWindow)(e))return this.safeDelete(e);var r=e[this.name];r&&r[0]===e&&(r[0]=r[1]=void 0)}},{key:"has",value:function(e){if((0,i.isWindow)(e))return this.safeHas(e);var r=e[this.name];return!(!r||r[0]!==e)}},{key:"safeSet",value:function(e,r){var n=this.keys,t=this.values,o=n.indexOf(e);return o===-1?(n.push(e),void t.push(r)):void(t[o]=r)}},{key:"safeGet",value:function(e){var r=this.keys,n=r.indexOf(e);if(n!==-1)return this.values[n]}},{key:"safeDelete",value:function(e){var r=this.keys,n=r.indexOf(e);n!==-1&&(r.splice(n,1),this.values.splice(n,1))}},{key:"safeHas",value:function(e){return this.keys.indexOf(e)!==-1}}]),e}()},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0;var o,i=n(10),a=r.CONFIG={ALLOW_POSTMESSAGE_POPUP:!0,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,LOG_TO_PAGE:!1,MOCK_MODE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,r,n){"use strict";function t(e){try{e=(0,s.jsonParse)(e)}catch(e){return}if(e&&(e=e[u.CONSTANTS.WINDOW_PROPS.POSTROBOT],e&&e.type&&f.RECEIVE_MESSAGE_TYPES[e.type]))return e}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(e){return}var r=e.source,n=e.origin,o=e.data,i=t(o);if(i&&(0!==i.sourceDomain.indexOf(u.CONSTANTS.MOCK_PROTOCOL)&&0!==i.sourceDomain.indexOf(u.CONSTANTS.FILE_PROTOCOL)||(n=i.sourceDomain),c.global.receivedMessages.indexOf(i.id)===-1)){c.global.clean.push(c.global.receivedMessages,i.id);var a=void 0;if(a=u.POST_MESSAGE_NAMES_LIST.indexOf(i.name)!==-1||i.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===i.ack?"error":"info",s.log.logLevel(a,["\n\n\t","#receive",i.type.replace(/^postrobot_message_/,""),"::",i.name,"::",n,"\n\n",i]),(0,s.isWindowClosed)(r))return s.log.debug("Source window is closed - can not send "+i.type+" "+i.name);i.data&&(i.data=(0,
s.deserializeMethods)(r,n,i.data)),f.RECEIVE_MESSAGE_TYPES[i.type](r,n,i)}}function i(e){try{e.source}catch(e){return}e={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent.origin,data:e.data},o(e)}function a(){var e=s.util.listen(window,"message",i);c.global.clean.register("listener",function(){e.cancel()})}Object.defineProperty(r,"__esModule",{value:!0}),r.receiveMessage=o,r.messageListener=i,r.listenForMessages=a;var u=n(0),s=n(1),c=n(3),f=n(22);c.global.receivedMessages=c.global.receivedMessages||[]},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.RECEIVE_MESSAGE_TYPES=void 0;var o,i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},a=n(0),u=n(1),s=n(12),c=n(11);r.RECEIVE_MESSAGE_TYPES=(o={},t(o,a.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,r,n){var t=(0,c.getResponseListener)(n.hash);if(!t)throw new Error("No handler found for post message ack for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,u.matchDomain)(t.domain,r))throw new Error("Ack origin "+r+" does not match domain "+t.domain);t.ack=!0}),t(o,a.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,r,n){function t(t){return n.fireAndForget||(0,u.isWindowClosed)(e)?u.promise.Promise.resolve():(0,s.sendMessage)(e,i({target:n.originalSource,hash:n.hash,name:n.name},t),r)}var o=(0,c.getRequestListener)({name:n.name,win:e,domain:r});return u.promise.Promise.all([t({type:a.CONSTANTS.POST_MESSAGE_TYPE.ACK}),u.promise.run(function(){if(!o)throw new Error("No handler found for post message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,u.matchDomain)(o.domain,r))throw new Error("Request origin "+r+" does not match domain "+o.domain);var t=n.data;return u.promise.deNodeify(o.handler,{source:e,origin:r,data:t})}).then(function(e){return t({type:a.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:a.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){return t({type:a.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:a.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:e.stack?e.message+"\n"+e.stack:e.toString()})})]).catch(function(e){return o&&o.handleError?o.handleError(e):void u.log.error(e.stack||e.toString())})}),t(o,a.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,r,n){var t=(0,c.getResponseListener)(n.hash);if(!t)throw new Error("No handler found for post message response for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,u.matchDomain)(t.domain,r))throw new Error("Response origin "+r+" does not match domain "+t.domain);if((0,c.deleteResponseListener)(n.hash),n.ack===a.CONSTANTS.POST_MESSAGE_ACK.ERROR)return t.respond(new Error(n.error));if(n.ack===a.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var o=n.data||n.response;return t.respond(null,{source:e,origin:r,data:o})}}),o)},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SEND_MESSAGE_STRATEGIES=void 0;var t=n(0),o=n(1),i=r.SEND_MESSAGE_STRATEGIES={};i[t.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE]=function(e,r,n){var i=void 0;i=Array.isArray(n)?n:n?[n]:[t.CONSTANTS.WILDCARD],i=i.map(function(r){if(0===r.indexOf(t.CONSTANTS.MOCK_PROTOCOL)){if(window.location.protocol===t.CONSTANTS.FILE_PROTOCOL)return t.CONSTANTS.WILDCARD;if(!(0,o.isActuallySameDomain)(e))throw new Error("Attempting to send messsage to mock domain "+r+", but window is actually cross-domain");return o.util.getActualDomain(e)}return 0===r.indexOf(t.CONSTANTS.FILE_PROTOCOL)?t.CONSTANTS.WILDCARD:r}),i.forEach(function(n){return e.postMessage(r,n)})}},function(e,r,n){"use strict";function t(e,r){return"object"===("undefined"==typeof e?"undefined":f(e))&&null!==e&&e.__type__===r}function o(e,r,n,t){var o=d.util.uniqueID();return y.global.clean.setItem(y.global.methods,o,{destination:e,domain:r,method:n}),{__type__:l.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:t}}function i(e){return{__type__:l.CONSTANTS.SERIALIZATION_TYPES.ERROR,__message__:e.stack||e.message||e.toString()}}function a(e,r,n){return d.util.replaceObject({obj:n},function(n,t){return"function"==typeof n?o(e,r,n,t):n instanceof Error?i(n):void 0}).obj}function u(e,r,n){function t(){var t=Array.prototype.slice.call(arguments);return v.log.debug("Call foreign method",n.__name__,t),(0,h.send)(e,l.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:n.__id__,name:n.__name__,args:t},{domain:r}).then(function(e){var r=e.data;return v.log.debug("Got foreign method result",n.__name__,r.result),r.result},function(e){throw v.log.debug("Got foreign method error",e.stack||e.toString()),e})}return t.__name__=n.__name__,t.source=e,t.origin=r,t}function s(e,r,n){return new Error(n.__message__)}function c(e,r,n){return d.util.replaceObject({obj:n},function(n,o){return t(n,l.CONSTANTS.SERIALIZATION_TYPES.METHOD)?u(e,r,n):t(n,l.CONSTANTS.SERIALIZATION_TYPES.ERROR)?s(e,r,n):void 0}).obj}Object.defineProperty(r,"__esModule",{value:!0}),r.listenForMethods=void 0;var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.serializeMethod=o,r.serializeMethods=a,r.deserializeMethod=u,r.deserializeError=s,r.deserializeMethods=c;var l=n(0),d=n(2),p=n(14),h=n(7),v=n(9),S=n(15),y=n(3);y.global.methods=y.global.methods||{};r.listenForMethods=d.util.once(function(){(0,h.on)(l.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{window:l.CONSTANTS.WILDCARD,origin:l.CONSTANTS.WILDCARD},function(e){var r=e.source,n=e.origin,t=e.data,o=y.global.methods[t.id];if(!o)throw new Error("Could not find method with id: "+t.id);if(o.destination!==r)throw new Error("Method window does not match");if(!(0,p.matchDomain)(o.domain,n))throw new Error("Method domain "+o.domain+" does not match origin "+n);return v.log.debug("Call local method",t.name,t.args),S.promise.run(function(){return o.method.apply({source:r,origin:n,data:t},t.args)}).then(function(e){return{result:e,id:t.id,name:t.name}})})})},function(e,r,n){"use strict";function t(){(0,s.on)(a.CONSTANTS.POST_MESSAGE_NAMES.READY,{window:a.CONSTANTS.WILDCARD,domain:a.CONSTANTS.WILDCARD},function(e){var r=e.source,n=l.global.readyPromises.get(r);n?n.resolve(e):(n=(new f.SyncPromise).resolve(e),l.global.readyPromises.set(r,n))});var e=(0,u.getAncestor)();e&&(0,s.send)(e,a.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:a.CONSTANTS.WILDCARD}).catch(function(e){c.log.debug(e.stack||e.toString())})}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",t=l.global.readyPromises.get(e);return t?t:(t=new f.SyncPromise,l.global.readyPromises.set(e,t),setTimeout(function(){return t.reject(new Error(n+" did not load after "+r+"ms"))},r),t)}Object.defineProperty(r,"__esModule",{value:!0}),r.initOnReady=t,r.onWindowReady=o;var i=n(4),a=n(0),u=n(6),s=n(7),c=n(9),f=n(8),l=n(3);l.global.readyPromises=l.global.readyPromises||new i.WeakMap},function(e,r,n){"use strict";function t(e){return c.promise.nodeify(new c.promise.Promise(function(r,n){if(!e.name)throw new Error("Expected options.name");if(u.CONFIG.MOCK_MODE)e.window=window;else if("string"==typeof e.window){var t=document.getElementById(e.window);if(!t)throw new Error("Expected options.window "+e.window+" to be a valid element id");if("iframe"!==t.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(!t.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window=t.contentWindow}else if(e.window instanceof HTMLElement){if("iframe"!==e.window.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(!e.window.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window=e.window.contentWindow}if(!e.window)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");e.domain=e.domain||u.CONSTANTS.WILDCARD;var o=e.name+"_"+c.util.uniqueID();if((0,s.addResponseListener)(o,e),(0,c.isWindowClosed)(e.window))throw new Error("Target window is closed");var i=!1;return e.respond=function(e,t){return e||(i=!0),e?n(e):r(t)},c.promise.run(function(){if((0,c.isAncestor)(window,e.window))return(0,c.onWindowReady)(e.window)}).then(function(){if((0,s.sendMessage)(e.window,{hash:o,type:u.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,name:e.name,data:e.data,fireAndForget:e.fireAndForget},e.domain).catch(n),e.fireAndForget)return r();var t=c.util.intervalTimeout(u.CONFIG.ACK_TIMEOUT,100,function(r){return e.ack||(0,c.isWindowClosed)(e.window)?t.cancel():r?void 0:n(new Error("No ack for postMessage "+e.name+" in "+u.CONFIG.ACK_TIMEOUT+"ms"))});if(e.timeout)var a=c.util.intervalTimeout(e.timeout,100,function(r){return i||(0,c.isWindowClosed)(e.window)?a.cancel():r?void 0:n(new Error("Post message response timed out after "+e.timeout+" ms"))},e.timeout)}).catch(n)}),e.callback)}function o(e,r,n,o,i){return i||(o||"function"!=typeof n?"function"==typeof o&&(i=o,o={}):(i=n,o={},n={})),o=o||{},o.window=e,o.name=r,o.data=n,o.callback=i,t(o)}function i(e,r,n,t){var i=(0,c.getAncestor)();return i?o(i,e,r,n,t):new c.promise.Promise(function(e,r){return r(new Error("Window does not have a parent"))})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");return{send:function(r,n,t){return o(e.window,r,n,e,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.send=void 0,r.request=t,r.sendToParent=i,r.client=a;var u=n(0),s=n(5),c=n(1);r.send=o},function(e,r,n){"use strict";function t(){a.CONFIG.MOCK_MODE=!0}function o(){a.CONFIG.MOCK_MODE=!1}function i(){delete window[a.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",u.messageListener)}Object.defineProperty(r,"__esModule",{value:!0}),r.CONSTANTS=r.CONFIG=void 0,r.enableMockMode=t,r.disableMockMode=o;var a=n(0);Object.defineProperty(r,"CONFIG",{enumerable:!0,get:function(){return a.CONFIG}}),Object.defineProperty(r,"CONSTANTS",{enumerable:!0,get:function(){return a.CONSTANTS}}),r.disable=i;var u=n(5)},function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}Object.defineProperty(r,"__esModule",{value:!0}),r.winutil=r.util=r.bridge=r.parent=void 0;var o=n(26);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(29);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(27);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var u=n(2);Object.defineProperty(r,"util",{enumerable:!0,get:function(){return u.util}});var s=n(6),c=t(s);r.parent=(0,s.getAncestor)(),r.bridge=void 0,r.winutil=c},function(e,r,n){"use strict";function t(e){if(!e.name)throw new Error("Expected options.name");e.handler=e.handler||u.util.noop,e.errorHandler=e.errorHandler||function(e){throw e},e.source&&(e.window=e.source),e.domain=e.domain||c.CONSTANTS.WILDCARD;var r=(0,s.addRequestListener)({name:e.name,win:e.window,domain:e.domain},e);if(e.once){var n=e.handler;e.handler=u.util.once(function(){return r.cancel(),n.apply(this,arguments)})}if(e.handleError=function(r){e.errorHandler(r)},e.window&&e.errorOnClose)var t=u.util.safeInterval(function(){(0,u.isWindowClosed)(e.window)&&(t.cancel(),e.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){r.cancel()}}}function o(e,r,n,o){return"function"==typeof r&&(o=n,n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,r.errorHandler=o||r.errorHandler,t(r)}function i(e,r,n,o){"function"==typeof r&&(o=n,n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,r.errorHandler=o||r.errorHandler,r.once=!0;var i=new u.promise.Promise(function(e,n){r.handler=r.handler||function(r){return e(r)},r.errorHandler=r.errorHandler||n}),a=t(r);return u.util.extend(i,a),i}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(r,n,t){return o(r,e,n,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0,r.listen=t,r.once=i,r.listener=a;var u=n(1),s=n(5),c=n(0);r.on=o},function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}Object.defineProperty(r,"__esModule",{value:!0});var o=n(7);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(o);r.default=i}])});
//# sourceMappingURL=post-robot.min.js.map