!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("postRobot",[],r):"object"==typeof exports?exports.postRobot=r():e.postRobot=r()}(this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.i=function(e){return e},r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=34)}([function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(30);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(13);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,r,n){"use strict";function t(e){var r=e.location;if(!r)throw new Error("Can not read window location");var n=r.protocol;if(!n)throw new Error("Can not read window protocol");if(n===Y.FILE_PROTOCOL)return"file://";var t=r.host;if(!t)throw new Error("Can not read window host");return n+"//"+t}function o(e){e=e||window;var r=t(e);return r&&e.mockDomain&&0===e.mockDomain.indexOf(Y.MOCK_PROTOCOL)?e.mockDomain:r}function i(e){try{if(!e.location.href)return!0;if("about:blank"===e.location.href)return!0}catch(e){}return!1}function a(e){try{var r=Object.getOwnPropertyDescriptor(e,"location");if(r&&!1===r.enumerable)return!1}catch(e){}try{if(i(e))return!0;if(t(e)===t(window))return!0}catch(e){}return!1}function s(e){if(!a(e))return!1;try{if(i(e))return!0;if(o(window)===o(e))return!0}catch(e){}return!1}function u(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){return}}function c(e){if(e&&!u(e))try{return e.opener}catch(e){return}}function d(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(e){}return r}function l(e,r){if(!e||!r)return!1;var n=u(r);return n?n===e:-1!==d(r).indexOf(e)}function f(e){var r=[],n=void 0;try{n=e.frames}catch(r){n=e}var t=void 0;try{t=n.length}catch(e){}if(0===t)return r;if(t){for(var o=0;o<t;o++){var i=void 0;try{i=n[o]}catch(e){continue}r.push(i)}return r}for(var a=0;a<100;a++){var s=void 0;try{s=n[a]}catch(e){return r}if(!s)return r;r.push(s)}return r}function w(e){for(var r=[],n=f(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var s=w(a),u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var d;if(u){if(c>=s.length)break;d=s[c++]}else{if(c=s.next(),c.done)break;d=c.value}var l=d;r.push(l)}}return r}function m(e){if(e){try{if(e.top)return e.top}catch(e){}if(u(e)===e)return e;try{if(l(window,e)&&window.top)return window.top}catch(e){}try{if(l(e,window)&&window.top)return window.top}catch(e){}for(var r=w(e),n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}var i=o;try{if(i.top)return i.top}catch(e){}if(u(i)===i)return i}}}function p(e){var r=m(e);return w(r).concat(r)}function g(e){return e===m(e)}function v(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var r=e.ownerDocument;return!(!r||!r.body||r.body.contains(e))}function y(e,r){for(var n=0;n<e.length;n++)try{if(e[n]===r)return n}catch(e){}return-1}function h(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||e.message!==q}if(r&&s(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}try{(0,Z.noop)(e===e)}catch(e){return!0}var n=y(z,e);if(-1!==n){var t=H[n];if(t&&v(t))return!0}return!1}function S(){for(var e=0;e<H.length;e++)v(H[e])&&(H.splice(e,1),z.splice(e,1));for(var r=0;r<z.length;r++)h(z[r])&&(H.splice(r,1),z.splice(r,1))}function O(e){if(S(),e&&e.contentWindow)try{z.push(e.contentWindow),H.push(e)}catch(e){}}function b(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function _(e,r){for(var n=f(e),t=n,o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a;try{if(s(u)&&u.name===r&&-1!==n.indexOf(u))return u}catch(e){}}try{if(-1!==n.indexOf(e.frames[r]))return e.frames[r]}catch(e){}try{if(-1!==n.indexOf(e[r]))return e[r]}catch(e){}}function E(e,r){var n=_(e,r);if(n)return n;for(var t=f(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a,u=E(s,r);if(u)return u}}function T(e,r){var n=void 0;return(n=_(e,r))?n:E(m(e)||e,r)}function P(e,r){var n=u(r);if(n)return n===e;for(var t=f(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}if(a===r)return!0}return!1}function A(e,r){return e===c(r)}function N(e){e=e||window;var r=c(e);if(r)return r;var n=u(e);return n||void 0}function M(e){for(var r=[],n=e;n;)(n=N(n))&&r.push(n);return r}function C(e,r){var n=N(r);if(n)return n===e;if(r===e)return!1;if(m(r)===r)return!1;for(var t=f(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}if(a===r)return!0}return!1}function W(){return Boolean(c(window))}function R(){return Boolean(u(window))}function j(){return Boolean(!R()&&!W())}function I(e,r){for(var n=e,t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}for(var a=i,s=r,u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var d;if(u){if(c>=s.length)break;d=s[c++]}else{if(c=s.next(),c.done)break;d=c.value}if(a===d)return!0}}return!1}function k(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,r=0,n=e;n;)(n=u(n))&&(r+=1);return r}function D(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e,t=0;t<r;t++){if(!n)return;n=u(n)}return n}function L(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return D(e,k(e)-r)}function x(e,r){var n=m(e)||e,t=m(r)||r;try{if(n&&t)return n===t}catch(e){}var o=p(e),i=p(r);if(I(o,i))return!0;var a=c(n),s=c(t);return(!a||!I(p(a),i))&&(s&&I(p(s),o),!1)}function G(e,r){if("string"==typeof e){if("string"==typeof r)return e===Y.WILDCARD||r===e;if((0,Z.isRegex)(r))return!1;if(Array.isArray(r))return!1}return(0,Z.isRegex)(e)?(0,Z.isRegex)(r)?e.toString()===r.toString():!Array.isArray(r)&&Boolean(r.match(e)):!!Array.isArray(e)&&(Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):!(0,Z.isRegex)(r)&&e.some(function(e){return G(e,r)}))}function B(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):o()}function F(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,o=void 0;return function i(){if(h(e))return o&&clearTimeout(o),r();t<=0?clearTimeout(o):(t-=n,o=setTimeout(i,n))}(),{cancel:function(){o&&clearTimeout(o)}}}function U(e){try{if(e===window)return!0}catch(e){if(e&&e.message===q)return!0}try{if("[object Window]"===Object.prototype.toString.call(e))return!0}catch(e){if(e&&e.message===q)return!0}try{if(window.Window&&e instanceof window.Window)return!0}catch(e){if(e&&e.message===q)return!0}try{if(e&&e.self===e)return!0}catch(e){if(e&&e.message===q)return!0}try{if(e&&e.parent===e)return!0}catch(e){if(e&&e.message===q)return!0}try{if(e&&e.top===e)return!0}catch(e){if(e&&e.message===q)return!0}try{(0,Z.noop)(e===e)}catch(e){return!0}try{(0,Z.noop)(e&&e.__cross_domain_utils_window_check__)}catch(e){return!0}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.getActualDomain=t,r.getDomain=o,r.isBlankDomain=i,r.isActuallySameDomain=a,r.isSameDomain=s,r.getParent=u,r.getOpener=c,r.getParents=d,r.isAncestorParent=l,r.getFrames=f,r.getAllChildFrames=w,r.getTop=m,r.getAllFramesInWindow=p,r.isTop=g,r.isFrameWindowClosed=v,r.isWindowClosed=h,r.linkFrameWindow=O,r.getUserAgent=b,r.getFrameByName=_,r.findChildFrameByName=E,r.findFrameByName=T,r.isParent=P,r.isOpener=A,r.getAncestor=N,r.getAncestors=M,r.isAncestor=C,r.isPopup=W,r.isIframe=R,r.isFullpage=j,r.getDistanceFromTop=k,r.getNthParent=D,r.getNthParentFromTop=L,r.isSameTopWindow=x,r.matchDomain=G,r.getDomainFromUrl=B,r.onCloseWindow=F,r.isWindow=U;var Z=n(20),Y={MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",WILDCARD:"*"},q="Call was rejected by callee.\r\n",z=[],H=[]},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(22);Object.defineProperty(r,"ZalgoPromise",{enumerable:!0,get:function(){return t.ZalgoPromise}})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.global=void 0;var t=n(0);(r.global=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{}).registerSelf=function(){}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(8);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(11);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(36);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(35);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(16);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(t);r.default=o},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(31);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(15);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(14);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,r,n){"use strict";function t(){c.global.initialized||((0,u.listenForMessages)(),n(10).openTunnelToOpener(),(0,s.initOnReady)(),(0,s.listenForMethods)()),c.global.initialized=!0}Object.defineProperty(r,"__esModule",{value:!0}),r.Promise=r.cleanUpWindow=void 0;var o=n(28);Object.defineProperty(r,"cleanUpWindow",{enumerable:!0,get:function(){return o.cleanUpWindow}}),r.init=t;var i=n(39);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(2);Object.defineProperty(r,"Promise",{enumerable:!0,get:function(){return a.ZalgoPromise}});var s=n(4),u=n(6),c=n(3);t()},function(e,r,n){"use strict";function t(e){if(!e)return"<unknown error: "+Object.prototype.toString.call(e)+">";if("string"==typeof e)return e;if(e instanceof Error){var r=e&&e.stack,n=e&&e.message;if(r&&n)return-1!==r.indexOf(n)?r:n+"\n"+r;if(r)return r;if(n)return n}return"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e)}function o(){}function i(e,r,n){return e.addEventListener?e.addEventListener(r,n):e.attachEvent("on"+r,n),{cancel:function(){e.removeEventListener?e.removeEventListener(r,n):e.detachEvent("on"+r,n)}}}function a(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})}function s(e,r){for(var n=0;n<e.length;n++)r(e[n],n)}function u(e,r){for(var n in e)e.hasOwnProperty(n)&&r(e[n],n)}function c(e,r){Array.isArray(e)?s(e,r):"object"===(void 0===e?"undefined":g(e))&&null!==e&&u(e,r)}function d(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(n>=100)throw new Error("Self-referential object passed, or object contained too many layers");var t=void 0;if("object"!==(void 0===e?"undefined":g(e))||null===e||Array.isArray(e)){if(!Array.isArray(e))throw new Error("Invalid type: "+(void 0===e?"undefined":g(e)));t=[]}else t={};return c(e,function(e,o){var i=r(e,o);void 0!==i?t[o]=i:"object"===(void 0===e?"undefined":g(e))&&null!==e?t[o]=d(e,r,n+1):t[o]=e}),t}function l(e,r){function n(){t=setTimeout(n,r),e.call()}var t=void 0;return t=setTimeout(n,r),{cancel:function(){clearTimeout(t)}}}function f(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function w(){return(0,y.isPopup)()?h.CONSTANTS.WINDOW_TYPES.POPUP:(0,y.isIframe)()?h.CONSTANTS.WINDOW_TYPES.IFRAME:h.CONSTANTS.WINDOW_TYPES.FULLPAGE}function m(e,r,n){var t=void 0,o=void 0;try{if("{}"!==JSON.stringify({})&&(t=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(o=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var i=JSON.stringify.call(this,e,r,n);try{t&&(Object.prototype.toJSON=t),o&&(Array.prototype.toJSON=o)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return i}function p(e){return JSON.parse(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.weakMapMemoize=r.once=void 0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.stringifyError=t,r.noop=o,r.addEventListener=i,r.uniqueID=a,r.eachArray=s,r.eachObject=u,r.each=c,r.replaceObject=d,r.safeInterval=l,r.isRegex=f,r.getWindowType=w,r.jsonStringify=m,r.jsonParse=p;var v=n(5),y=n(1),h=n(0);r.once=function(e){if(!e)return e;var r=!1;return function(){if(!r)return r=!0,e.apply(this,arguments)}},r.weakMapMemoize=function(e){var r=new v.WeakMap;return function(n){var t=r.get(n);return void 0!==t?t:(t=e.call(this,n),void 0!==t&&r.set(n,t),t)}}},function(e,r,n){"use strict";function t(){return!!(0,g.getUserAgent)(window).match(/MSIE|trident|edge/i)||!v.CONFIG.ALLOW_POSTMESSAGE_POPUP}function o(e){return!(0,g.isSameTopWindow)(window,e)}function i(e,r){if(e){if((0,g.getDomain)()!==(0,g.getDomainFromUrl)(e))return!0}else if(r&&!(0,g.isSameDomain)(r))return!0;return!1}function a(e){var r=e.win,n=e.domain;return!!t()&&(!(n&&!i(n,r))&&!(r&&!o(r)))}function s(e){e=e||(0,g.getDomainFromUrl)(e);var r=e.replace(/[^a-zA-Z0-9]+/g,"_");return v.CONSTANTS.BRIDGE_NAME_PREFIX+"_"+r}function u(){return Boolean(window.name&&window.name===s((0,g.getDomain)()))}function c(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.CONFIG.BRIDGE_TIMEOUT;y.global.remoteWindows.set(e,{sendMessagePromise:new p.ZalgoPromise})}function d(e){return y.global.remoteWindows.get(e)}function l(e,r,n){var t=d(e);if(!t)throw new Error("Window not found to register sendMessage to");var o=function(t,o,i){if(t!==e)throw new Error("Remote window does not match window");if(!(0,g.matchDomain)(i,r))throw new Error("Remote domain "+i+" does not match domain "+r);n(o)};t.sendMessagePromise.resolve(o),t.sendMessagePromise=p.ZalgoPromise.resolve(o)}function f(e,r){var n=d(e);if(!n)throw new Error("Window not found on which to reject sendMessage");n.sendMessagePromise.asyncReject(r)}function w(e,r,n){var t=(0,g.isOpener)(window,e),o=(0,g.isOpener)(e,window);if(!t&&!o)throw new Error("Can only send messages to and from parent and popup windows");var i=d(e);if(!i)throw new Error("Window not found to send message to");return i.sendMessagePromise.then(function(t){return t(e,r,n)})}Object.defineProperty(r,"__esModule",{value:!0}),r.documentBodyReady=void 0,r.needsBridgeForBrowser=t,r.needsBridgeForWin=o,r.needsBridgeForDomain=i,r.needsBridge=a,r.getBridgeName=s,r.isBridge=u,r.registerRemoteWindow=c,r.findRemoteWindow=d,r.registerRemoteSendMessage=l,r.rejectRemoteSendMessage=f,r.sendBridgeMessage=w;var m=n(5),p=n(2),g=n(1),v=n(0),y=n(3),h=n(6);r.documentBodyReady=new p.ZalgoPromise(function(e){if(window.document&&window.document.body)return e(window.document.body);var r=setInterval(function(){if(window.document&&window.document.body)return clearInterval(r),e(window.document.body)},10)});y.global.remoteWindows=y.global.remoteWindows||new m.WeakMap,y.global.receiveMessage=function(e){(0,h.receiveMessage)(e)}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(24);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(25);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(9);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(27);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.log=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(8),i=n(0),a=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===t(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var s=r.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),i.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode&&e.parentNode.removeChild(e)}},writeToPage:function(e,r){setTimeout(function(){var n=document.getElementById("postRobotLogs");n||(n=document.createElement("div"),n.id="postRobotLogs",n.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body&&document.body.appendChild(n));var t=document.createElement("div"),i=(new Date).toString().split(" ")[4],a=Array.prototype.slice.call(r).map(function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var r=void 0;try{r=(0,o.jsonStringify)(e,null,2)}catch(e){r="[object]"}return"\n\n"+r+"\n\n"}).join(" "),s=i+" "+e+" "+a;t.innerHTML=s;var u={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];t.style.cssText="margin-top: 10px; color: "+u+";",n.childNodes.length?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)})},logLevel:function(e,r){setTimeout(function(){try{var n=window.LOG_LEVEL||i.CONFIG.LOG_LEVEL;if(a.indexOf(e)<a.indexOf(n))return;if(r=Array.prototype.slice.call(r),r.unshift(""+window.location.host+window.location.pathname),r.unshift("::"),r.unshift(""+(0,o.getWindowType)().toLowerCase()),r.unshift("[post-robot]"),i.CONFIG.LOG_TO_PAGE&&s.writeToPage(e,r),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,r)}catch(e){}},1)},debug:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];s.logLevel("debug",r)},info:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];s.logLevel("info",r)},warn:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];s.logLevel("warn",r)},error:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];s.logLevel("error",r)}}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(29);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=r.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error",PROMISE:"postrobot_promise",ZALGO_PROMISE:"postrobot_zalgo_promise",REGEX:"regex"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"};r.POST_MESSAGE_NAMES_LIST=Object.keys(t.POST_MESSAGE_NAMES).map(function(e){return t.POST_MESSAGE_NAMES[e]})},function(e,r,n){"use strict";function t(){l.global.responseListeners={},l.global.requestListeners={}}function o(e,r){l.global.responseListeners[e]=r}function i(e){return l.global.responseListeners[e]}function a(e){delete l.global.responseListeners[e]}function s(e){var r=e.name,n=e.win,t=e.domain;if(n===w.CONSTANTS.WILDCARD&&(n=null),t===w.CONSTANTS.WILDCARD&&(t=null),!r)throw new Error("Name required to get request listener");var o=l.global.requestListeners[r];if(o)for(var i=[n,l.global.WINDOW_WILDCARD],a=0;a<i.length;a++){var s=i[a],u=s&&o.get(s);if(u){for(var c=[t,w.CONSTANTS.WILDCARD],f=0;f<c.length;f++){var p=c[f];if(p&&(p=p.toString(),u[p]))return u[p]}if(u[m])for(var g=u[m],v=Array.isArray(g),y=0,g=v?g:g[Symbol.iterator]();;){var h;if(v){if(y>=g.length)break;h=g[y++]}else{if(y=g.next(),y.done)break;h=y.value}var S=h,O=S.regex,b=S.listener;if(t&&(0,d.matchDomain)(O,t))return b}}}}function u(e,r){var n=e.name,t=e.win,o=e.domain;if(!n||"string"!=typeof n)throw new Error("Name required to add request listener");if(Array.isArray(t)){for(var i=[],a=t,d=Array.isArray(a),p=0,a=d?a:a[Symbol.iterator]();;){var g;if(d){if(p>=a.length)break;g=a[p++]}else{if(p=a.next(),p.done)break;g=p.value}var v=g;i.push(u({name:n,domain:o,win:v},r))}return{cancel:function(){for(var e=i,r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();;){var t;if(r){if(n>=e.length)break;t=e[n++]}else{if(n=e.next(),n.done)break;t=n.value}t.cancel()}}}}if(Array.isArray(o)){for(var y=[],h=o,S=Array.isArray(h),O=0,h=S?h:h[Symbol.iterator]();;){var b;if(S){if(O>=h.length)break;b=h[O++]}else{if(O=h.next(),O.done)break;b=O.value}var _=b;y.push(u({name:n,win:t,domain:_},r))}return{cancel:function(){for(var e=y,r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();;){var t;if(r){if(n>=e.length)break;t=e[n++]}else{if(n=e.next(),n.done)break;t=n.value}t.cancel()}}}}var E=s({name:n,win:t,domain:o});if(t&&t!==w.CONSTANTS.WILDCARD||(t=l.global.WINDOW_WILDCARD),o=o||w.CONSTANTS.WILDCARD,E)throw t&&o?new Error("Request listener already exists for "+n+" on domain "+o.toString()+" for specified window"):t?new Error("Request listener already exists for "+n+" for specified window"):o?new Error("Request listener already exists for "+n+" on domain "+o.toString()):new Error("Request listener already exists for "+n);var T=l.global.requestListeners,P=T[n];P||(P=new c.WeakMap,T[n]=P);var A=P.get(t);A||(A={},P.set(t,A));var N=o.toString();A[N]=r;var M=A[m],C=void 0;return(0,f.isRegex)(o)&&(M||(M=[],A[m]=M),C={regex:o,listener:r},M.push(C)),{cancel:function(){A&&(delete A[N],t&&0===Object.keys(A).length&&P.delete(t),C&&M.splice(M.indexOf(C,1)))}}}Object.defineProperty(r,"__esModule",{value:!0}),r.resetListeners=t,r.addResponseListener=o,r.getResponseListener=i,r.deleteResponseListener=a,r.getRequestListener=s,r.addRequestListener=u,n(2);var c=n(5),d=n(1),l=n(3),f=n(4),w=n(0);l.global.responseListeners=l.global.responseListeners||{},l.global.requestListeners=l.global.requestListeners||{},l.global.WINDOW_WILDCARD=l.global.WINDOW_WILDCARD||new function(){};var m="__domain_regex__"},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=(0,d.uniqueID)(),o=(0,d.getWindowType)(),i=(0,s.getDomain)(window);return a({},r,n,{sourceDomain:i,id:r.id||t,windowType:o})}function i(e,r,n){return u.ZalgoPromise.try(function(){r=o(e,r,{data:(0,d.serializeMethods)(e,n,r.data),domain:n});var i=void 0;if(i=-1!==c.POST_MESSAGE_NAMES_LIST.indexOf(r.name)||r.type===c.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===r.ack?"error":"info",d.log.logLevel(i,["\n\n\t","#send",r.type.replace(/^postrobot_message_/,""),"::",r.name,"::",n||c.CONSTANTS.WILDCARD,"\n\n",r]),e===window)throw new Error("Attemping to send message to self");if((0,s.isWindowClosed)(e))throw new Error("Window is closed");d.log.debug("Running send message strategies",r);var a=[],f=(0,d.jsonStringify)(t({},c.CONSTANTS.WINDOW_PROPS.POSTROBOT,r),null,2);return u.ZalgoPromise.map(Object.keys(l.SEND_MESSAGE_STRATEGIES),function(r){return u.ZalgoPromise.try(function(){if(!c.CONFIG.ALLOWED_POST_MESSAGE_METHODS[r])throw new Error("Strategy disallowed: "+r);return l.SEND_MESSAGE_STRATEGIES[r](e,f,n)}).then(function(){return a.push(r+": success"),!0},function(e){return a.push(r+": "+(0,d.stringifyError)(e)+"\n"),!1})}).then(function(e){var n=e.some(Boolean),t=r.type+" "+r.name+" "+(n?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(d.log.debug(t),!n)throw new Error(t)})})}Object.defineProperty(r,"__esModule",{value:!0});var a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};r.sendMessage=i;var s=n(1),u=n(2),c=n(0),d=n(4),l=n(33)},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(19);Object.defineProperty(r,"WeakMap",{enumerable:!0,get:function(){return t.CrossDomainSafeWeakMap}})},function(e,r,n){"use strict";function t(){if(!window.WeakMap)return!1;if(!window.Object.freeze)return!1;try{var e=new window.WeakMap,r={};return window.Object.freeze(r),e.set(r,"__testvalue__"),"__testvalue__"===e.get(r)}catch(e){return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.hasNativeWeakMap=t},function(e,r,n){"use strict";function t(e,r){for(var n=0;n<e.length;n++)try{if(e[n]===r)return n}catch(e){}return-1}function o(){}Object.defineProperty(r,"__esModule",{value:!0}),r.safeIndexOf=t,r.noop=o},function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.CrossDomainSafeWeakMap=void 0;var o=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),i=n(1),a=n(17),s=n(18),u=Object.defineProperty,c=Date.now()%1e9;r.CrossDomainSafeWeakMap=function(){function e(){if(t(this,e),c+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+c,(0,a.hasNativeWeakMap)())try{this.weakmap=new window.WeakMap}catch(e){}this.keys=[],this.values=[]}return o(e,[{key:"_cleanupClosedWindows",value:function(){for(var e=this.weakmap,r=this.keys,n=0;n<r.length;n++){var t=r[n];if((0,i.isWindow)(t)&&(0,i.isWindowClosed)(t)){if(e)try{e.delete(t)}catch(e){}r.splice(n,1),this.values.splice(n,1),n-=1}}}},{key:"isSafeToReadWrite",value:function(e){if((0,i.isWindow)(e))return!1;try{(0,s.noop)(e&&e.self),(0,s.noop)(e&&e[this.name])}catch(e){return!1}return!0}},{key:"set",value:function(e,r){if(!e)throw new Error("WeakMap expected key");var n=this.weakmap;if(n)try{n.set(e,r)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var t=this.name,o=e[t];o&&o[0]===e?o[1]=r:u(e,t,{value:[e,r],writable:!0})}else{this._cleanupClosedWindows();var i=this.keys,a=this.values,c=(0,s.safeIndexOf)(i,e);-1===c?(i.push(e),a.push(r)):a[c]=r}}},{key:"get",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{if(r.has(e))return r.get(e)}catch(e){delete this.weakmap}if(!this.isSafeToReadWrite(e)){this._cleanupClosedWindows();var n=this.keys,t=(0,s.safeIndexOf)(n,e);if(-1===t)return;return this.values[t]}var o=e[this.name];if(o&&o[0]===e)return o[1]}},{key:"delete",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=e[this.name];n&&n[0]===e&&(n[0]=n[1]=void 0)}else{this._cleanupClosedWindows();var t=this.keys,o=(0,s.safeIndexOf)(t,e);-1!==o&&(t.splice(o,1),this.values.splice(o,1))}}},{key:"has",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{return r.has(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=e[this.name];return!(!n||n[0]!==e)}return this._cleanupClosedWindows(),-1!==(0,s.safeIndexOf)(this.keys,e)}}]),e}()},function(e,r,n){"use strict";function t(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function o(){}Object.defineProperty(r,"__esModule",{value:!0}),r.isRegex=t,r.noop=o},function(e,r,n){"use strict";function t(e){if(-1===a.indexOf(e)){a.push(e),setTimeout(function(){throw e},1);for(var r=0;r<i.length;r++)i[r](e)}}function o(e){return i.push(e),{cancel:function(){i.splice(i.indexOf(e),1)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.dispatchPossiblyUnhandledError=t,r.onPossiblyUnhandledException=o;var i=[],a=[]},function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ZalgoPromise=void 0;var o=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),i=n(23),a=n(21),s=window.__zalgopromise__=window.__zalgopromise__||{flushPromises:[],activeCount:0},u=function(){function e(r){var n=this;if(t(this,e),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var o=void 0,i=void 0,a=!1,s=!1,u=!1;try{r(function(e){u?n.resolve(e):(a=!0,o=e)},function(e){u?n.reject(e):(s=!0,i=e)})}catch(e){return void this.reject(e)}u=!0,a?this.resolve(o):s&&this.reject(i)}}return o(e,[{key:"resolve",value:function(e){if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this}},{key:"reject",value:function(e){var r=this;if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not reject promise with another promise");if(!e){var n=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+n)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){r.errorHandled||(0,a.dispatchPossiblyUnhandledError)(e)},1),this.dispatch(),this}},{key:"asyncReject",value:function(e){this.errorHandled=!0,this.reject(e)}},{key:"dispatch",value:function(){var r=this,n=this.dispatching,t=this.resolved,o=this.rejected,a=this.handlers;if(!n&&(t||o)){this.dispatching=!0,s.activeCount+=1;for(var u=0;u<a.length;u++){(function(n){var s=a[n],u=s.onSuccess,c=s.onError,d=s.promise,l=void 0;if(t)try{l=u?u(r.value):r.value}catch(e){return d.reject(e),"continue"}else if(o){if(!c)return d.reject(r.error),"continue";try{l=c(r.error)}catch(e){return d.reject(e),"continue"}}l instanceof e&&(l.resolved||l.rejected)?(l.resolved?d.resolve(l.value):d.reject(l.error),l.errorHandled=!0):(0,i.isPromise)(l)?l instanceof e&&(l.resolved||l.rejected)?l.resolved?d.resolve(l.value):d.reject(l.error):l.then(function(e){d.resolve(e)},function(e){d.reject(e)}):d.resolve(l)})(u)}a.length=0,this.dispatching=!1,s.activeCount-=1,0===s.activeCount&&e.flushQueue()}}},{key:"then",value:function(r,n){if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for success handler");if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for error handler");var t=new e;return this.handlers.push({promise:t,onSuccess:r,onError:n}),this.errorHandled=!0,this.dispatch(),t}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"finally",value:function(r){return this.then(function(n){return e.try(r).then(function(){return n})},function(n){return e.try(r).then(function(){throw n})})}},{key:"timeout",value:function(e,r){var n=this;if(this.resolved||this.rejected)return this;var t=setTimeout(function(){n.resolved||n.rejected||n.reject(r||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(t),e})}},{key:"toPromise",value:function(){if(!window.Promise)throw new Error("Could not find window.Promise");return window.Promise.resolve(this)}}],[{key:"resolve",value:function(r){return r instanceof e?r:(0,i.isPromise)(r)?new e(function(e,n){return r.then(e,n)}):(new e).resolve(r)}},{key:"reject",value:function(r){return(new e).reject(r)}},{key:"all",value:function(r){var n=new e,t=r.length,o=[];if(!t)return n.resolve(o),n;for(var a=0;a<r.length;a++){(function(a){var s=r[a];if(s instanceof e){if(s.resolved)return o[a]=s.value,t-=1,"continue"}else if(!(0,i.isPromise)(s))return o[a]=s,t-=1,"continue";e.resolve(s).then(function(e){o[a]=e,0===(t-=1)&&n.resolve(o)},function(e){n.reject(e)})})(a)}return 0===t&&n.resolve(o),n}},{key:"map",value:function(r,n){var t=new e,o=r.length,i=[];if(!o)return t.resolve(i),t;for(var a=0;a<r.length;a++)!function(a){e.try(function(){return n(r[a])}).then(function(e){i[a]=e,0===(o-=1)&&t.resolve(i)},function(e){t.reject(e)})}(a);return t}},{key:"onPossiblyUnhandledException",value:function(e){return(0,a.onPossiblyUnhandledException)(e)}},{key:"try",value:function(r,n,t){var o=void 0;try{o=r.apply(n,t||[])}catch(r){return e.reject(r)}return e.resolve(o)}},{key:"delay",value:function(r){return new e(function(e){setTimeout(e,r)})}},{key:"hash",value:function(r){var n={},t=[];for(var o in r)!function(o){r.hasOwnProperty(o)&&t.push(e.resolve(r[o]).then(function(e){n[o]=e}))}(o);return e.all(t).then(function(){return n})}},{key:"isPromise",value:function(r){return!!(r&&r instanceof e)||(0,i.isPromise)(r)}},{key:"flush",value:function(){var r=new e;return s.flushPromises.push(r),0===s.activeCount&&e.flushQueue(),r}},{key:"flushQueue",value:function(){var e=s.flushPromises;s.flushPromises=[];for(var r=e,n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}o.resolve()}}}]),e}();r.ZalgoPromise=u},function(e,r,n){"use strict";function t(e){try{if(!e)return!1;if(window.Promise&&e instanceof window.Promise)return!0;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(o){var r=o.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=t;var o={}.toString},function(e,r,n){"use strict";function t(e){try{d.global.tunnelWindows[e]&&delete d.global.tunnelWindows[e].source}catch(e){}delete d.global.tunnelWindows[e]}function o(){for(var e=d.global.tunnelWindows,r=Object.keys(e),n=Array.isArray(r),o=0,r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var a=i,s=e[a];try{(0,c.noop)(s.source)}catch(e){t(a);continue}(0,u.isWindowClosed)(s.source)&&t(a)}}function i(e){var r=e.name,n=e.source,t=e.canary,i=e.sendMessage;return o(),d.global.tunnelWindowId+=1,d.global.tunnelWindows[d.global.tunnelWindowId]={name:r,source:n,canary:t,sendMessage:i},d.global.tunnelWindowId}function a(e){return d.global.tunnelWindows[e]}n(2);var s=n(0),u=n(1),c=n(4),d=n(3),l=n(7);d.global.tunnelWindows=d.global.tunnelWindows||{},d.global.tunnelWindowId=0,d.global.openTunnelToParent=function(e){var r=e.name,n=e.source,o=e.canary,d=e.sendMessage,f=(0,u.getParent)(window);if(!f)throw new Error("No parent window found to open tunnel to");var w=i({name:r,source:n,canary:o,sendMessage:d});return(0,l.send)(f,s.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{name:r,sendMessage:function(){var e=a(w);try{(0,c.noop)(e&&e.source)}catch(e){return void t(w)}if(e&&e.source&&!(0,u.isWindowClosed)(e.source)){try{e.canary()}catch(e){return}e.sendMessage.apply(this,arguments)}}},{domain:s.CONSTANTS.WILDCARD})}},function(e,r,n){"use strict";function t(){return o.ZalgoPromise.try(function(){var e=(0,i.getOpener)(window);if(e&&(0,c.needsBridge)({win:e}))return(0,c.registerRemoteWindow)(e),d(e).then(function(r){return r?window.name?r[a.CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(e){try{(0,s.noop)(window)}catch(e){return}window&&!window.closed&&(0,u.receiveMessage)({data:e,origin:this.origin,source:this.source})}}).then(function(r){var n=r.source,t=r.origin,o=r.data;if(n!==e)throw new Error("Source does not match opener");(0,c.registerRemoteSendMessage)(n,t,o.sendMessage)}).catch(function(r){throw(0,c.rejectRemoteSendMessage)(e,r),r}):(0,c.rejectRemoteSendMessage)(e,new Error("Can not register with opener: window does not have a name")):(0,c.rejectRemoteSendMessage)(e,new Error("Can not register with opener: no bridge found in opener"))})})}Object.defineProperty(r,"__esModule",{value:!0}),r.openTunnelToOpener=t;var o=n(2),i=n(1),a=n(0),s=n(4),u=n(6),c=n(9),d=(0,s.weakMapMemoize)(function(e){return o.ZalgoPromise.try(function(){for(var r=(0,i.getFrames)(e),n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var s;if(n){if(t>=r.length)break;s=r[t++]}else{if(t=r.next(),t.done)break;s=t.value}var u=s;try{if(u&&u!==window&&(0,i.isSameDomain)(u)&&u[a.CONSTANTS.WINDOW_PROPS.POSTROBOT])return u}catch(e){continue}}try{var d=(0,i.getFrameByName)(e,(0,c.getBridgeName)((0,i.getDomain)()));if(!d)return;return(0,i.isSameDomain)(d)&&d[a.CONSTANTS.WINDOW_PROPS.POSTROBOT]?d:new o.ZalgoPromise(function(e){var r=void 0,n=void 0;r=setInterval(function(){if(d&&(0,i.isSameDomain)(d)&&d[a.CONSTANTS.WINDOW_PROPS.POSTROBOT])return clearInterval(r),clearTimeout(n),e(d)},100),n=setTimeout(function(){return clearInterval(r),e()},2e3)})}catch(e){return}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=(r.openBridge=void 0,r.linkUrl=void 0,r.isBridge=void 0,r.needsBridge=void 0,r.needsBridgeForBrowser=void 0,r.needsBridgeForWin=void 0,r.needsBridgeForDomain=void 0,r.openTunnelToOpener=void 0,n(10));r.openBridge=t.openBridge,r.linkUrl=t.linkUrl,r.isBridge=t.isBridge,r.needsBridge=t.needsBridge,r.needsBridgeForBrowser=t.needsBridgeForBrowser,r.needsBridgeForWin=t.needsBridgeForWin,r.needsBridgeForDomain=t.needsBridgeForDomain,r.openTunnelToOpener=t.openTunnelToOpener},function(e,r,n){"use strict";function t(e,r){(0,m.on)(l.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{source:e,domain:r},function(e){var n=e.origin,t=e.data;if(n!==r)throw new Error("Domain "+r+" does not match origin "+n);if(!t.name)throw new Error("Register window expected to be passed window name");if(!t.sendMessage)throw new Error("Register window expected to be passed sendMessage method");if(!w.global.popupWindowsByName[t.name])throw new Error("Window with name "+t.name+" does not exist, or was not opened by this window");if(!w.global.popupWindowsByName[t.name].domain)throw new Error("We do not have a registered domain for window "+t.name);if(w.global.popupWindowsByName[t.name].domain!==n)throw new Error("Message origin "+n+" does not matched registered window origin "+w.global.popupWindowsByName[t.name].domain);return(0,g.registerRemoteSendMessage)(w.global.popupWindowsByName[t.name].win,r,t.sendMessage),{sendMessage:function(e){if(window&&!window.closed){var r=w.global.popupWindowsByName[t.name];r&&(0,p.receiveMessage)({data:e,origin:r.domain,source:r.win})}}}})}function o(e,r){f.log.debug("Opening bridge:",e,r);var n=document.createElement("iframe");return n.setAttribute("name",e),n.setAttribute("id",e),n.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),n.setAttribute("frameborder","0"),n.setAttribute("border","0"),n.setAttribute("scrolling","no"),n.setAttribute("allowTransparency","true"),n.setAttribute("tabindex","-1"),n.setAttribute("hidden","true"),n.setAttribute("title",""),n.setAttribute("role","presentation"),n.src=r,n}function i(e,r){return r=r||(0,d.getDomainFromUrl)(e),w.global.bridges[r]?w.global.bridges[r]:(w.global.bridges[r]=c.ZalgoPromise.try(function(){if((0,d.getDomain)()===r)throw new Error("Can not open bridge on the same domain as current domain: "+r);var n=(0,g.getBridgeName)(r);if((0,d.getFrameByName)(window,n))throw new Error("Frame with name "+n+" already exists on page");var i=o(n,e);return g.documentBodyReady.then(function(n){return new c.ZalgoPromise(function(e,r){setTimeout(e,1)}).then(function(){n.appendChild(i);var o=i.contentWindow;return t(o,r),new c.ZalgoPromise(function(e,r){i.onload=e,i.onerror=r}).then(function(){return(0,f.onWindowReady)(o,l.CONFIG.BRIDGE_TIMEOUT,"Bridge "+e)}).then(function(){return o})})})}),w.global.bridges[r])}function a(e,r){var n=w.global.popupWindowsByWin.get(e);n&&(n.domain=(0,d.getDomainFromUrl)(r),(0,g.registerRemoteWindow)(e))}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.openBridge=i,r.linkUrl=a;var u=n(5),c=n(2),d=n(1),l=n(0),f=n(4),w=n(3),m=n(7),p=n(6),g=n(9);w.global.bridges=w.global.bridges||{},w.global.popupWindowsByWin=w.global.popupWindowsByWin||new u.WeakMap,w.global.popupWindowsByName=w.global.popupWindowsByName||{};var v=window.open;window.open=function(e,r,n,t){var o=e;if(e&&0===e.indexOf(l.CONSTANTS.MOCK_PROTOCOL)){var i=e.split("|"),a=s(i,2);o=a[0],e=a[1]}o&&(o=(0,d.getDomainFromUrl)(o));var u=v.call(this,e,r,n,t);if(!u)return u;e&&(0,g.registerRemoteWindow)(u);for(var c=Object.keys(w.global.popupWindowsByName),f=Array.isArray(c),m=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(m>=c.length)break;p=c[m++]}else{if(m=c.next(),m.done)break;p=m.value}var y=p;(0,d.isWindowClosed)(w.global.popupWindowsByName[y].win)&&delete w.global.popupWindowsByName[y]}if(r&&u){var h=w.global.popupWindowsByWin.get(u)||w.global.popupWindowsByName[r]||{};h.name=h.name||r,h.win=h.win||u,h.domain=h.domain||o,w.global.popupWindowsByWin.set(u,h),w.global.popupWindowsByName[r]=h}return u}},function(e,r,n){"use strict";function t(e){var r=o.global.requestPromises.get(e);if(r)for(var n=r,t=Array.isArray(n),i=0,n=t?n:n[Symbol.iterator]();;){var a;if(t){if(i>=n.length)break;a=n[i++]}else{if(i=n.next(),i.done)break;a=i.value}var s=a;s.reject(new Error("No response from window - cleaned up"))}o.global.popupWindowsByWin&&o.global.popupWindowsByWin.delete(e),o.global.remoteWindows&&o.global.remoteWindows.delete(e),o.global.requestPromises.delete(e),o.global.methods.delete(e),o.global.readyPromises.delete(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.cleanUpWindow=t;var o=n(3)},function(e,r,n){"use strict";function t(e,r){if(!i.CONFIG.ALLOW_POSTMESSAGE_POPUP&&!1===(0,o.isSameTopWindow)(e,r))throw new Error("Can not send and receive post messages between two different windows (disabled to emulate IE)")}Object.defineProperty(r,"__esModule",{value:!0}),r.emulateIERestrictions=t;var o=n(1),i=n(0)},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0;var o,i=n(13),a=r.CONFIG={ALLOW_POSTMESSAGE_POPUP:!0,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,RES_TIMEOUT:1/0,LOG_TO_PAGE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,r,n){"use strict";function t(e){var r=void 0;try{r=(0,d.jsonParse)(e)}catch(e){return}if(r&&"object"===(void 0===r?"undefined":s(r))&&null!==r&&(r=r[c.CONSTANTS.WINDOW_PROPS.POSTROBOT])&&"object"===(void 0===r?"undefined":s(r))&&null!==r&&r.type&&"string"==typeof r.type&&f.RECEIVE_MESSAGE_TYPES[r.type])return r}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(e){return}var r=e.source,n=e.origin,o=e.data,i=t(o);if(i){if(!i.sourceDomain||"string"!=typeof i.sourceDomain)throw new Error("Expected message to have sourceDomain");if(0!==i.sourceDomain.indexOf(c.CONSTANTS.MOCK_PROTOCOL)&&0!==i.sourceDomain.indexOf(c.CONSTANTS.FILE_PROTOCOL)||(n=i.sourceDomain),-1===l.global.receivedMessages.indexOf(i.id)){l.global.receivedMessages.push(i.id);var a=void 0;if(a=-1!==c.POST_MESSAGE_NAMES_LIST.indexOf(i.name)||i.type===c.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===i.ack?"error":"info",d.log.logLevel(a,["\n\n\t","#receive",i.type.replace(/^postrobot_message_/,""),"::",i.name,"::",n,"\n\n",i]),(0,u.isWindowClosed)(r))return void d.log.debug("Source window is closed - can not send "+i.type+" "+i.name);i.data&&(i.data=(0,d.deserializeMethods)(r,n,i.data)),f.RECEIVE_MESSAGE_TYPES[i.type](r,n,i)}}}function i(e){try{e.source}catch(e){return}var r={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent&&e.originalEvent.origin,data:e.data};try{n(12).emulateIERestrictions(r.source,window)}catch(e){return}o(r)}function a(){(0,d.addEventListener)(window,"message",i)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.receiveMessage=o,r.messageListener=i,r.listenForMessages=a;var u=n(1),c=n(0),d=n(4),l=n(3),f=n(32);l.global.receivedMessages=l.global.receivedMessages||[]},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.RECEIVE_MESSAGE_TYPES=void 0;var o,i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},a=n(2),s=n(1),u=n(0),c=n(4),d=n(15),l=n(14);r.RECEIVE_MESSAGE_TYPES=(o={},t(o,u.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,r,n){var t=(0,l.getResponseListener)(n.hash);if(!t)throw new Error("No handler found for post message ack for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(t.domain,r))throw new Error("Ack origin "+r+" does not match domain "+t.domain.toString());t.ack=!0}),t(o,u.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,r,n){function t(t){return n.fireAndForget||(0,s.isWindowClosed)(e)?a.ZalgoPromise.resolve():(0,d.sendMessage)(e,i({target:n.originalSource,hash:n.hash,name:n.name},t),r)}var o=(0,l.getRequestListener)({name:n.name,win:e,domain:r});return a.ZalgoPromise.all([t({type:u.CONSTANTS.POST_MESSAGE_TYPE.ACK}),a.ZalgoPromise.try(function(){if(!o)throw new Error("No handler found for post message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(o.domain,r))throw new Error("Request origin "+r+" does not match domain "+o.domain.toString());var t=n.data;return o.handler({source:e,origin:r,data:t})}).then(function(e){return t({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){var r=(0,c.stringifyError)(e).replace(/^Error: /,"");return t({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:r})})]).then(c.noop).catch(function(e){if(o&&o.handleError)return o.handleError(e);c.log.error((0,c.stringifyError)(e))})}),t(o,u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,r,n){var t=(0,l.getResponseListener)(n.hash);if(!t)throw new Error("No handler found for post message response for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,s.matchDomain)(t.domain,r))throw new Error("Response origin "+r+" does not match domain "+t.domain);if((0,l.deleteResponseListener)(n.hash),n.ack===u.CONSTANTS.POST_MESSAGE_ACK.ERROR)return t.respond(new Error(n.error),null);if(n.ack===u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var o=n.data||n.response;return t.respond(null,{source:e,origin:r,data:o})}}),o)},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SEND_MESSAGE_STRATEGIES=void 0;var t=n(1),o=n(0),i=r.SEND_MESSAGE_STRATEGIES={};i[o.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE]=function(e,r,i){try{n(12).emulateIERestrictions(window,e)}catch(e){return}var a=void 0;a=Array.isArray(i)?i:i?[i]:[o.CONSTANTS.WILDCARD],a=a.map(function(r){if(0===r.indexOf(o.CONSTANTS.MOCK_PROTOCOL)){if(window.location.protocol===o.CONSTANTS.FILE_PROTOCOL)return o.CONSTANTS.WILDCARD;if(!(0,t.isActuallySameDomain)(e))throw new Error("Attempting to send messsage to mock domain "+r+", but window is actually cross-domain");return(0,t.getActualDomain)(e)}return 0===r.indexOf(o.CONSTANTS.FILE_PROTOCOL)?o.CONSTANTS.WILDCARD:r}),a.forEach(function(n){return e.postMessage(r,n)})};var a=n(10).sendBridgeMessage;i[o.CONSTANTS.SEND_STRATEGIES.BRIDGE]=function(e,r,n){if((0,t.isSameDomain)(e))throw new Error("Post message through bridge disabled between same domain windows");if(!1!==(0,t.isSameTopWindow)(window,e))throw new Error("Can only use bridge to communicate between two different windows, not between frames");return a(e,r,n)},i[o.CONSTANTS.SEND_STRATEGIES.GLOBAL]=function(e,r,n){if(!(0,t.isSameDomain)(e))throw new Error("Post message through global disabled between different domain windows");if(!1!==(0,t.isSameTopWindow)(window,e))throw new Error("Can only use global to communicate between two different windows, not between frames");var i=e[o.CONSTANTS.WINDOW_PROPS.POSTROBOT];if(!i)throw new Error("Can not find postRobot global on foreign window");return i.receiveMessage({source:window,origin:(0,t.getDomain)(),data:r})}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(7);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(t);r.default=o},function(e,r,n){"use strict";function t(){(0,c.on)(u.CONSTANTS.POST_MESSAGE_NAMES.READY,{domain:u.CONSTANTS.WILDCARD},function(e){var r=e.source,n=l.global.readyPromises.get(r);n?n.resolve(e):(n=(new s.ZalgoPromise).resolve(e),l.global.readyPromises.set(r,n))});var e=(0,a.getAncestor)();e&&(0,c.send)(e,u.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:u.CONSTANTS.WILDCARD,timeout:1/0}).catch(function(e){d.log.debug((0,f.stringifyError)(e))})}function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",t=l.global.readyPromises.get(e);return t||(t=new s.ZalgoPromise,l.global.readyPromises.set(e,t),setTimeout(function(){return t.reject(new Error(n+" did not load after "+r+"ms"))},r),t)}Object.defineProperty(r,"__esModule",{value:!0}),r.initOnReady=t,r.onWindowReady=o;var i=n(5),a=n(1),s=n(2),u=n(0),c=n(7),d=n(11),l=n(3),f=n(8);l.global.readyPromises=l.global.readyPromises||new i.WeakMap},function(e,r,n){"use strict";function t(e,r){return"object"===(void 0===e?"undefined":g(e))&&null!==e&&e.__type__===r}function o(e,r,n,t){var o=(0,O.uniqueID)(),i=E.global.methods.get(e);return i||(i={},E.global.methods.set(e,i)),i[o]={domain:r,method:n},{__type__:S.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:t}}function i(e){return{__type__:S.CONSTANTS.SERIALIZATION_TYPES.ERROR,__message__:(0,O.stringifyError)(e)}}function a(e,r,n,t){return{__type__:S.CONSTANTS.SERIALIZATION_TYPES.PROMISE,__then__:o(e,r,function(e,r){return n.then(e,r)},t+".then")}}function s(e,r,n,t){return{__type__:S.CONSTANTS.SERIALIZATION_TYPES.ZALGO_PROMISE,__then__:o(e,r,function(e,r){return n.then(e,r)},t+".then")}}function u(e){return{__type__:S.CONSTANTS.SERIALIZATION_TYPES.REGEX,__source__:e.source}}function c(e,r,n){return(0,O.replaceObject)({obj:n},function(n,t){return"function"==typeof n?o(e,r,n,t.toString()):n instanceof Error?i(n):window.Promise&&n instanceof window.Promise?a(e,r,n,t.toString()):h.ZalgoPromise.isPromise(n)?s(e,r,n,t.toString()):(0,O.isRegex)(n)?u(n):void 0}).obj}function d(e,r,n){function t(){var t=Array.prototype.slice.call(arguments);return _.log.debug("Call foreign method",n.__name__,t),(0,b.send)(e,S.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:n.__id__,name:n.__name__,args:t},{domain:r,timeout:1/0}).then(function(e){var r=e.data;return _.log.debug("Got foreign method result",n.__name__,r.result),r.result},function(e){throw _.log.debug("Got foreign method error",(0,O.stringifyError)(e)),e})}return t.__name__=n.__name__,t.__xdomain__=!0,t.source=e,t.origin=r,t}function l(e,r,n){return new Error(n.__message__)}function f(e,r,n){return new h.ZalgoPromise(function(t,o){return d(e,r,n.__then__)(t,o)})}function w(e,r,n){return window.Promise?new window.Promise(function(t,o){return d(e,r,n.__then__)(t,o)}):f(e,r,n)}function m(e,r,n){return new RegExp(n.__source__)}function p(e,r,n){return(0,O.replaceObject)({obj:n},function(n,o){if("object"===(void 0===n?"undefined":g(n))&&null!==n)return t(n,S.CONSTANTS.SERIALIZATION_TYPES.METHOD)?d(e,r,n):t(n,S.CONSTANTS.SERIALIZATION_TYPES.ERROR)?l(e,r,n):t(n,S.CONSTANTS.SERIALIZATION_TYPES.PROMISE)?w(e,r,n):t(n,S.CONSTANTS.SERIALIZATION_TYPES.ZALGO_PROMISE)?f(e,r,n):t(n,S.CONSTANTS.SERIALIZATION_TYPES.REGEX)?m(e,r,n):void 0}).obj}Object.defineProperty(r,"__esModule",{value:!0}),r.listenForMethods=void 0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.serializeMethod=o,r.serializeMethods=c,r.deserializeMethod=d,r.deserializeError=l,r.deserializeZalgoPromise=f,r.deserializePromise=w,r.deserializeRegex=m,r.deserializeMethods=p;var v=n(5),y=n(1),h=n(2),S=n(0),O=n(8),b=n(7),_=n(11),E=n(3);E.global.methods=E.global.methods||new v.WeakMap;r.listenForMethods=(0,O.once)(function(){(0,b.on)(S.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{origin:S.CONSTANTS.WILDCARD},function(e){var r=e.source,n=e.origin,t=e.data,o=E.global.methods.get(r);if(!o)throw new Error("Could not find any methods this window has privileges to call");var i=o[t.id];if(!i)throw new Error("Could not find method with id: "+t.id);if(!(0,y.matchDomain)(i.domain,n))throw new Error("Method domain "+i.domain+" does not match origin "+n);return _.log.debug("Call local method",t.name,t.args),h.ZalgoPromise.try(function(){return i.method.apply({source:r,origin:n,data:t},t.args)}).then(function(e){return{result:e,id:t.id,name:t.name}})})})},function(e,r,n){"use strict";function t(e){return u.ZalgoPromise.try(function(){if(!e.name)throw new Error("Expected options.name");var r=e.name,n=void 0,t=void 0;if("string"==typeof e.window){var o=document.getElementById(e.window);if(!o)throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be a valid element id");if("iframe"!==o.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(!o.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");n=o.contentWindow}else if(e.window instanceof HTMLIFrameElement){if("iframe"!==e.window.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(e.window&&!e.window.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window&&e.window.contentWindow&&(n=e.window.contentWindow)}else n=e.window;if(!n)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");var i=n;t=e.domain||d.CONSTANTS.WILDCARD;var a=e.name+"_"+(0,f.uniqueID)();if((0,c.isWindowClosed)(i))throw new Error("Target window is closed");var s=!1,m=w.global.requestPromises.get(i);m||(m=[],w.global.requestPromises.set(i,m));var p=u.ZalgoPromise.try(function(){if((0,c.isAncestor)(window,i))return u.ZalgoPromise.resolve((0,f.onWindowReady)(i))}).then(function(){return new u.ZalgoPromise(function(n,o){var u={name:r,window:i,domain:t,respond:function(e,r){e||(s=!0,m.splice(m.indexOf(p,1))),e?o(e):n(r)}};if((0,l.addResponseListener)(a,u),(0,l.sendMessage)(i,{type:d.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,hash:a,name:r,data:e.data,fireAndForget:e.fireAndForget},t).catch(o),e.fireAndForget)return n();var f=d.CONFIG.ACK_TIMEOUT,w=e.timeout||d.CONFIG.RES_TIMEOUT,g=100,v=function n(){if(!s){if((0,c.isWindowClosed)(i))return o(u.ack?new Error("Window closed for "+r+" before response"):new Error("Window closed for "+r+" before ack"));f-=g,w-=g;if(u.ack){if(w===1/0)return;g=Math.min(w,2e3)}else{if(f<=0)return o(new Error("No ack for postMessage "+r+" in "+d.CONFIG.ACK_TIMEOUT+"ms"));if(w<=0)return o(new Error("No response for postMessage "+r+" in "+(e.timeout||d.CONFIG.RES_TIMEOUT)+"ms"))}setTimeout(n,g)}};setTimeout(v,g)})});return p.catch(function(){(0,l.deleteResponseListener)(a)}),m.push(p),p})}function o(e,r,n,o){return o=o||{},o.window=e,o.name=r,o.data=n,t(o)}function i(e,r,n){var t=(0,c.getAncestor)();return t?o(t,e,r,n):new u.ZalgoPromise(function(e,r){return r(new Error("Window does not have a parent"))})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");var r=e.window;return{send:function(n,t){return o(r,n,t,e)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.send=void 0,r.request=t,r.sendToParent=i,r.client=a;var s=n(5),u=n(2),c=n(1),d=n(0),l=n(6),f=n(4),w=n(3);w.global.requestPromises=w.global.requestPromises||new s.WeakMap,r.send=o},function(e,r,n){"use strict";function t(){delete window[o.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",i.messageListener)}Object.defineProperty(r,"__esModule",{value:!0}),r.CONSTANTS=r.CONFIG=void 0;var o=n(0);Object.defineProperty(r,"CONFIG",{enumerable:!0,get:function(){return o.CONFIG}}),Object.defineProperty(r,"CONSTANTS",{enumerable:!0,get:function(){return o.CONSTANTS}}),r.disable=t;var i=n(6)},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bridge=r.parent=void 0;var t=n(37);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(40);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(38);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(1);r.parent=(0,a.getAncestor)(),r.bridge=void 0;r.bridge=n(26)},function(e,r,n){"use strict";function t(e){if(!e.name)throw new Error("Expected options.name");if(!e.handler)throw new Error("Expected options.handler");var r=e.name,n=e.window,t=e.domain,o={handler:e.handler,handleError:e.errorHandler||function(e){throw e},window:n,domain:t||f.CONSTANTS.WILDCARD,name:r},i=(0,l.addRequestListener)({name:r,win:n,domain:t},o);if(e.once){var a=o.handler;o.handler=(0,d.once)(function(){return i.cancel(),a.apply(this,arguments)})}if(o.window&&e.errorOnClose)var c=(0,d.safeInterval)(function(){n&&"object"===(void 0===n?"undefined":s(n))&&(0,u.isWindowClosed)(n)&&(c.cancel(),o.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){i.cancel()}}}function o(e,r,n){return"function"==typeof r&&(n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,t(r)}function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];"function"==typeof r&&(n=r,r={}),r=r||{},n=n||r.handler;var o=r.errorHandler,i=new c.ZalgoPromise(function(t,i){r=r||{},r.name=e,r.once=!0,r.handler=function(e){if(t(e),n)return n(e)},r.errorHandler=function(e){if(i(e),o)return o(e)}}),a=t(r);return i.cancel=a.cancel,i}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(r,n){return o(r,e,n)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.listen=t,r.once=i,r.listener=a;var u=n(1),c=n(2),d=n(4),l=n(6),f=n(0);r.on=o}])});
//# sourceMappingURL=post-robot.ie.min.js.map